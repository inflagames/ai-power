(()=>{"use strict";(()=>{const t=3/4,e=1024,i=768,s=85.25,n="0",o="8",r="10",h="11";class a{constructor(){this.subscriptions=[],this.open=!0}emit(t={}){for(let e=0;e<this.subscriptions.length;e++)this.callFunction(this.subscriptions[e],t)}async callFunction(t,e){t(e)}pipe(...t){let e=this;for(const i of t){const t=new a;e.on((e=>i(e,t))),e=t}return e}unsub(t){this.subscriptions=this.subscriptions.filter((e=>e!==t))}on(t){this.subscriptions.push(t)}}class y{constructor(t,e=0,i=0,s=0,n=0){this.destroy=new a,this.eventEmitter=t,this.x=e,this.y=i,this.width=s,this.height=n,this.lastMousePosition=null,this.isMouseHover=!1,this.id=1e6*Math.random()}set eventEmitter(t){this._eventEmitter=t?t.pipe(function(t){let e=!1;const i=()=>{e=!0,t.unsub(i)};return t.on(i),(t,i)=>{e&&(i.subscriptions=[]),i.emit(t)}}(this.destroy)):t}get eventEmitter(){return this._eventEmitter}render(t){}listenerEvent(t,e){var i;this.eventEmitter.pipe((i=e=>e.event===t,(t,e)=>{i(t)&&e.emit(t)})).on((t=>{(t&&this.validateMouseEventPropagation(t.position,t.event)||this.validateKeyboardEventPropagation(t.event))&&e(t)}))}validateKeyboardEventPropagation(t){return t===r||t===h||"9"===t}validateMouseEventPropagation(t,e){return"5"===e||e===o||"7"===e||"9"===e||(this.isPositionInside(this.lastMousePosition)&&!this.isPositionInside(t)&&this.eventEmitter.emit({event:o}),this.lastMousePosition=t,this.isMouseHover=this.isPositionInside(t))}isPositionInside(t){return t&&t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}}class c extends y{constructor(t,e){super(e),this.navigator=t,this.backgroundColor="#f00",this.elements=[]}render(t){this.cleanCanvas(t);for(const e of this.elements)e.render(t)}cleanCanvas(t){t.rect(0,0,this.width,this.height),t.fillStyle=this.backgroundColor,t.fill()}validateEventPropagation(t,e){const i=super.validateEventPropagation(t,e);if(i)for(const i of this.elements)if(i.validateEventPropagation(t,e))return!1;return i}}function x(t,e){return{x:t.x+e.x,y:t.y+e.y}}function l(t,e,i){const s=function(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}(t,i);return{x:e.x+s.x,y:e.y-s.y}}function d(t){return t*window.currentWidth/e}function u(t){return t*e/window.currentWidth}function p(t,e){if(t.length<3||e.length<3)return!1;const i=[...g(t),...g(e)];for(const s of i){const i=v(t,s),n=v(e,s);if(!(i.min>n.min&&i.min<n.max||i.max>n.min&&i.max<n.max||n.min>i.min&&n.min<i.max||n.max>i.min&&n.max<i.max||i.min===n.min&&i.max===n.max))return!1}return!0}function m(t){if(0===t.x&&0===t.y)return{x:0,y:0};const e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}}function g(t){if(t.length<=1)return[];const e=[];for(let i=1;i<t.length;i++)e.push({x:t[i].x-t[i-1].x,y:t[i-1].y-t[i].y});return e.push({x:t[0].x-t[t.length-1].x,y:t[t.length-1].y-t[0].y}),e}function v(t,e){let i=k(e,t[0]),s=i;for(let n=1;n<t.length;n++){const o=k(e,t[n]);i=Math.min(i,o),s=Math.max(s,o)}return{min:i,max:s}}function k(t,e){return(e.x*t.x+e.y*t.y)/(t.x*t.x+t.y*t.y)}class f extends y{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.backgroundColor="#00f",this.rotation=0,this.directionVector={x:1,y:0},this.scaleShape=3.3,this.brakedShape=null}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}render(t){const e=this.getProjection();for(const i of e){const e=i.points;if(0!==e.length){t.beginPath(),t.moveTo(d(e[0].x),d(e[0].y));for(let i=1;i<e.length;i++)t.lineTo(d(e[i].x),d(e[i].y));t.closePath(),t.fillStyle=i.background,Boolean(i.stroke)&&(t.stroke(),t.strokeStyle=i.stroke,t.lineWidth=5*i.strokeWidth),t.fill()}}}animate(){this.moveBrakedPiece()}brakeShapes(){const t=this.shipShape().shapes;this.brakedShape={shapes:[]};for(const e of t)this.brakedShape={shapes:[...this.brakedShape.shapes,...this.brakeShape(e)]};for(const t of this.brakedShape.shapes){const e=this.shapeCenter(t.points),i=(Math.random()+.5)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));t.vector={x:e.x*i,y:e.y*i}}}brakeShape(t){if(0===t.points.length)return t.points;const{min:e,max:i}=this.coverBox(t.points),s=[];let n=Math.ceil((i.x-e.x)*(i.y-e.y)/2);n=Math.min(n,150);for(let o=0;o<n;o++){const n={x:(i.x-e.x)*Math.random()+e.x,y:(i.y-e.y)*Math.random()+e.y};s.push({points:new Array(3).fill(null).map((()=>({x:n.x+2.5*Math.random(),y:n.y+2.5*Math.random()}))),background:t.background})}return s}shapeCenter(t){const{min:e,max:i}=this.coverBox(t);return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}coverBox(t){const e={x:t[0].x,y:t[0].y},i={...e};for(let s=1;s<t.length;s++)e.x=Math.min(e.x,t[s].x),e.y=Math.min(e.y,t[s].y),i.x=Math.max(i.x,t[s].x),i.y=Math.max(i.y,t[s].y);return{min:e,max:i}}moveBrakedPiece(){if(this.brakedShape)for(const t of this.brakedShape.shapes)t.points=t.points.map((e=>({x:e.x+t.vector.x,y:e.y+t.vector.y}))),t.background=this.reduceOpacity(t.background,30)}reduceOpacity(t,e){let i=this.getOpacity(t);return i=Math.min(255,Math.max(i-e,0)),i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getOpacity(t){return t.length>7?parseInt(t.substr(7,2),16):255}getProjection(){const t=(e=this.directionVector,Math.atan2(e.y,e.x)+Math.PI/2);var e;const i=this.currentShape().shapes,s=this.getPosition(),n=[];for(const e of i){const i=e.points.map((t=>({x:t.x*this.scaleShape,y:t.y*this.scaleShape})));for(let e=0;e<i.length;e++)i[e]=l(i[e],s,t);n.push({...e,points:i})}return n}getPosition(){return{x:this.x,y:this.y}}currentShape(){return{shapes:[]}}}const b=JSON.parse('{"shapes":[{"id":"foot-r","background":"#523e35","stroke":"#000000","strokeWidth":0.165,"points":[{"x":4.562043795620436,"y":-2.0072992700730055},{"x":3.892944038929425,"y":-5.900243309002441},{"x":5.109489051094872,"y":-7.116788321167892},{"x":7.299270072992698,"y":-7.116788321167892},{"x":8.941605839416084,"y":-6.690997566909989},{"x":9.610705596107024,"y":-5.474452554744541},{"x":9.24574209245744,"y":-3.345498783454996},{"x":8.759124087591225,"y":-1.3381995133820048},{"x":7.907542579075425,"y":2.250608272506067},{"x":5.109489051094872,"y":2.0681265206812505}]},{"id":"foot-l","background":"#523e35","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-4.805352798053512,"y":-2.0072992700730055},{"x":-4.136253041362501,"y":-5.900243309002441},{"x":-5.413625304136236,"y":-7.116788321167892},{"x":-7.542579075425774,"y":-7.116788321167892},{"x":-9.245742092457442,"y":-6.690997566909989},{"x":-9.914841849148385,"y":-5.474452554744541},{"x":-9.549878345498804,"y":-3.345498783454996},{"x":-9.002433090024297,"y":-1.3381995133820048},{"x":-8.211678832116785,"y":2.250608272506067},{"x":-5.352798053527948,"y":2.0681265206812505}]},{"id":"path132294-9","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.5547445255474734,"y":-19.282238442822386},{"x":-3.7712895377129207,"y":-20.74209245742093},{"x":-7.42092457420927,"y":-22.262773722627742},{"x":-13.017031630170294,"y":-22.445255474452555},{"x":-16.970802919708007,"y":-23.96593673965937},{"x":-17.822384428223806,"y":-25},{"x":-17.76155717761559,"y":-23.175182481751825},{"x":-16.60583941605836,"y":-21.411192214111924},{"x":-18.004866180048666,"y":-20.924574209245744},{"x":-16.05839416058392,"y":-20.012165450121657},{"x":-17.274939172749367,"y":-18.734793187347936},{"x":-15.936739659367415,"y":-17.82238442822385},{"x":-16.423357664233567,"y":-16.24087591240876},{"x":-12.22627737226278,"y":-15.81508515815086},{"x":-6.812652068126546,"y":-15.632603406326039},{"x":-2.1897810218978258,"y":-16.24087591240876}]},{"id":"path132294","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.1897810218978258,"y":-19.282238442822386},{"x":3.3454987834549854,"y":-20.74209245742093},{"x":7.0559610705596185,"y":-22.262773722627742},{"x":12.652068126520646,"y":-22.445255474452555},{"x":16.54501216545014,"y":-23.96593673965937},{"x":17.45742092457423,"y":-25},{"x":17.335766423357654,"y":-23.175182481751825},{"x":16.240875912408775,"y":-21.411192214111924},{"x":17.579075425790727,"y":-20.924574209245744},{"x":15.693430656934268,"y":-20.012165450121657},{"x":16.909975669099722,"y":-18.734793187347936},{"x":15.51094890510948,"y":-17.82238442822385},{"x":15.997566909975632,"y":-16.24087591240876},{"x":11.800486618004847,"y":-15.81508515815086},{"x":6.447688564476895,"y":-15.632603406326039},{"x":1.7639902676398869,"y":-16.24087591240876}]},{"id":"path70565","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":3.588807785888058,"y":-18.79562043795621},{"x":2.128953771289538,"y":-19.403892944038933},{"x":-0.3649635036496477,"y":-19.76885644768857},{"x":-2.7980535279805494,"y":-19.403892944038933},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-3.5888077858880614,"y":-18.187347931873482},{"x":-2.372262773722614,"y":-18.79562043795621},{"x":-0.3041362530413636,"y":-18.79562043795621},{"x":1.3990267639902427,"y":-17.944038929440396}]},{"id":"path166293-4","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":-20.49878345498785,"y":-5.048661800486631},{"x":-18.856447688564465,"y":-12.104622871046237},{"x":-18.79562043795618,"y":-14.233576642335773},{"x":-18.917274939172753,"y":-16.849148418491488},{"x":-19.221411192214113,"y":-18.187347931873482},{"x":-21.41119221411194,"y":-18.673965936739663},{"x":-22.992700729926966,"y":-17.639902676399032},{"x":-23.600973236009693,"y":-14.111922141119226},{"x":-23.78345498783455,"y":-10.401459854014607},{"x":-23.78345498783455,"y":-7.785888077858889},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path166293-4-5","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":20.49878345498785,"y":-5.9610705596107145},{"x":18.856447688564465,"y":-13.077858880778596},{"x":18.79562043795618,"y":-15.14598540145986},{"x":18.91727493917275,"y":-17.82238442822385},{"x":19.221411192214113,"y":-19.09975669099757},{"x":21.472019464720155,"y":-19.58637469586375},{"x":22.992700729926966,"y":-18.55231143552312},{"x":23.661800486617977,"y":-15.024330900243314},{"x":23.783454987834553,"y":-11.313868613138695},{"x":23.783454987834553,"y":-8.698296836982976},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165,"points":[{"x":17.396593673965945,"y":-5.231143552311444},{"x":18.004866180048666,"y":2.3114355231143406},{"x":21.046228710462287,"y":3.832116788321155},{"x":22.810218978102178,"y":3.1630170316301545},{"x":24.270072992700705,"y":1.399026763990257},{"x":25,"y":-2.128953771289545},{"x":24.513381995133777,"y":-4.68369829683699},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189-7","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-17.39659367396594,"y":-4.31873479318736},{"x":-18.004866180048666,"y":3.2238442822384314},{"x":-21.046228710462287,"y":4.744525547445242},{"x":-22.810218978102178,"y":4.075425790754238},{"x":-24.2700729927007,"y":2.3114355231143406},{"x":-25,"y":-1.1557177615571916},{"x":-24.513381995133777,"y":-3.771289537712903},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path71384","background":"#7b7959","stroke":"#000000","strokeWidth":0.175779,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.90997566909972,"y":-13.321167883211686},{"x":-20.802919708029215,"y":-9.914841849148425},{"x":-21.77615571776152,"y":-6.690997566909989},{"x":-19.951338199513344,"y":4.562043795620426},{"x":-14.233576642335745,"y":8.515815085158138},{"x":-3.163017031630197,"y":11.800486618004847},{"x":6.5085158150851825,"y":11.43552311435522},{"x":15.024330900243328,"y":7.968369829683681},{"x":19.464720194647192,"y":4.379562043795605},{"x":21.59367396593673,"y":-6.447688564476898},{"x":19.951338199513344,"y":-11.009732360097333},{"x":16.42335766423357,"y":-13.38199513381996},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path71384-1","background":"#7b7959","stroke":"#000000","strokeWidth":0.160998,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.301703163016995,"y":-11.131386861313878},{"x":-18.673965936739677,"y":-8.819951338199523},{"x":-20.37712895377128,"y":-6.204379562043805},{"x":-18.61313868613139,"y":3.892944038929425},{"x":-13.321167883211658,"y":7.420924574209224},{"x":-2.9805352798053377,"y":10.340632603406313},{"x":6.082725060827247,"y":10.097323600973219},{"x":14.05109489051096,"y":6.934306569343047},{"x":18.187347931873454,"y":3.710462287104612},{"x":20.133819951338197,"y":-6.0218978102189915},{"x":17.94403892944038,"y":-9.610705596107064},{"x":15.328467153284691,"y":-11.982968369829688},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path65968-1","background":"#ba6560","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-16.24087591240878,"y":3.2238442822384314},{"x":-18.61313868613139,"y":2.3114355231143406},{"x":-19.951338199513344,"y":-7.105427357601002e-15},{"x":-19.82968369829684,"y":-3.2238442822384563},{"x":-18.004866180048666,"y":-5.231143552311444},{"x":-14.598540145985393,"y":-5.6569343065693545},{"x":-14.781021897810183,"y":3.4063260340632446}]},{"id":"path65968","background":"#ba6560","stroke":"#000000","strokeWidth":0.165,"points":[{"x":15.632603406326048,"y":3.2238442822384314},{"x":18.004866180048666,"y":2.3114355231143406},{"x":19.282238442822404,"y":-7.105427357601002e-15},{"x":19.221411192214113,"y":-3.2238442822384563},{"x":17.396593673965945,"y":-5.231143552311444},{"x":13.929440389294385,"y":-5.6569343065693545},{"x":14.172749391727457,"y":3.4063260340632446}]},{"id":"path63330-3","background":"#ab5552","stroke":"#000000","strokeWidth":0.100969,"points":[{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":6.326034063260323,"y":-19.221411192214116},{"x":10.462287104622888,"y":-17.639902676399032},{"x":12.226277372262778,"y":-15.328467153284675},{"x":12.591240875912426,"y":-11.982968369829688},{"x":11.070559610705615,"y":-8.51581508515816},{"x":6.630170316301687,"y":-6.630170316301715},{"x":3.1021897810219095,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171},{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":-6.630170316301687,"y":-19.221411192214116},{"x":-10.766423357664257,"y":-17.639902676399032},{"x":-12.530413625304144,"y":-15.328467153284675},{"x":-12.895377128953792,"y":-11.982968369829688},{"x":-11.435523114355197,"y":-8.51581508515816},{"x":-6.93430656934305,"y":-6.630170316301715},{"x":-3.406326034063273,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171}]},{"id":"path70563-6","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-12.895377128953792,"y":-18.24817518248176},{"x":-12.77372262773722,"y":-16.605839416058398},{"x":-3.5888077858880614,"y":-17.457420924574212},{"x":-3.7104622871046367,"y":-18.917274939172756}]},{"id":"path70563","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":12.530413625304142,"y":-18.3698296836983},{"x":12.469586374695858,"y":-16.727493917274945},{"x":3.2238442822384137,"y":-17.396593673965945},{"x":3.3454987834549854,"y":-18.917274939172756}]},{"id":"path66083","background":"#c56057","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-3.2238442822384137,"y":-14.841849148418497},{"x":-4.501216545012149,"y":-16.90997566909976},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-2.7980535279805494,"y":-20.012165450121657},{"x":-2.493917274939186,"y":-21.411192214111924},{"x":-1.520681265206811,"y":-22.019464720194648},{"x":-0.3041362530413636,"y":-22.08029197080292},{"x":0.9124087591240908,"y":-22.019464720194648},{"x":1.8856447688564586,"y":-21.411192214111924},{"x":2.128953771289538,"y":-20.012165450121657},{"x":3.588807785888058,"y":-18.79562043795621},{"x":3.8321167883211373,"y":-16.90997566909976},{"x":2.55474452554747,"y":-14.841849148418497},{"x":-0.3041362530413636,"y":-14.598540145985409}]},{"id":"path119374","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.55474452554747,"y":-16.849148418491488},{"x":3.8321167883211373,"y":-18.430656934306572},{"x":7.116788321167903,"y":-18.30900243309003},{"x":9.732360097323593,"y":-18.065693430656935},{"x":10.827250608272472,"y":-18.430656934306572},{"x":9.732360097323593,"y":-17.03163017031631},{"x":6.934306569343047,"y":-16.66666666666667}]},{"id":"path119374-2","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.91970802919705,"y":-16.727493917274945},{"x":-4.257907542579073,"y":-18.3698296836983},{"x":-7.542579075425774,"y":-18.24817518248176},{"x":-10.15815085158153,"y":-18.004866180048666},{"x":-11.253041362530409,"y":-18.3698296836983},{"x":-10.15815085158153,"y":-16.970802919708035},{"x":-7.360097323600982,"y":-16.605839416058398}]},{"id":"path63330","background":"#ab5552","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":8.39416058394157,"y":-16.66666666666667},{"x":13.80778588807788,"y":-13.503649635036503},{"x":16.18004866180049,"y":-8.819951338199523},{"x":16.60583941605836,"y":-2.0681265206812753},{"x":14.65936739659368,"y":5.048661800486602},{"x":8.759124087591225,"y":8.880778588807772},{"x":4.1362530413625045,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113},{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":-8.637469586374717,"y":-16.66666666666667},{"x":-14.111922141119242,"y":-13.503649635036503},{"x":-16.423357664233567,"y":-8.819951338199523},{"x":-16.849148418491502,"y":-2.0681265206812753},{"x":-14.902676399026756,"y":5.048661800486602},{"x":-9.002433090024297,"y":8.880778588807772},{"x":-4.440389294403861,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113}]},{"id":"path132989","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-15.51094890510948,"y":-9.367396593673973},{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-3.5279805352797773,"y":-16.484184914841855},{"x":3.2846715328467013,"y":-16.484184914841855},{"x":9.24574209245744,"y":-14.781021897810225},{"x":14.963503649635044,"y":-9.063260340632612},{"x":16.484184914841855,"y":-2.6763990267640025},{"x":15.632603406326048,"y":2.433090024330891},{"x":12.591240875912426,"y":10.03649635036495},{"x":10.827250608272472,"y":14.051094890510932},{"x":9.48905109489052,"y":10.94890510948904},{"x":8.69829683698294,"y":12.652068126520668},{"x":7.968369829683709,"y":14.111922141119202},{"x":7.360097323600982,"y":15.571776155717743},{"x":5.9610705596106754,"y":13.564476885644751},{"x":5.352798053527952,"y":10.5839416058394},{"x":3.8321167883211373,"y":12.165450121654487},{"x":1.9464720194647462,"y":15.936739659367369},{"x":-0.9124087591240873,"y":10.827250608272486},{"x":-1.4598540145985233,"y":13.442822384428204},{"x":-2.372262773722614,"y":16.1192214111922},{"x":-4.379562043795644,"y":14.659367396593652},{"x":-4.683698296837008,"y":12.591240875912384},{"x":-5.47445255474452,"y":9.610705596107039},{"x":-6.386861313868611,"y":12.773722627737207},{"x":-7.603406326034058,"y":15.81508515815083},{"x":-8.698296836982937,"y":12.591240875912384},{"x":-9.245742092457442,"y":9.245742092457398},{"x":-9.914841849148385,"y":11.253041362530396},{"x":-11.800486618004847,"y":15.145985401459832},{"x":-12.469586374695856,"y":11.6788321167883},{"x":-14.29440389294403,"y":7.968369829683681},{"x":-16.90997566909972,"y":-2.128953771289545}]}]}');class S extends f{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.rotation=Math.PI/2,this.directionVector={x:0,y:1},this.scaleShape=1.5,this.shape=b,this.updateCoordinates()}updateCoordinates({x:t,y:e}={}){this.x=t||this.x,this.y=e||this.y}updateDirectionVector(t){this.directionVector=t}animate(){super.animate()}currentShape(){return this.brakedShape||this.shape}}class E extends y{constructor(t,e,i){super(t,e,i),this.score=0,this.textSize=30,this.backgroundColor="#000",this.textColor="#fff",this.lastTime=0}render(t){t.font=`${d(this.textSize)}px Arial`;const e=t.measureText(this.score+""),i=e.width,s=e.actualBoundingBoxAscent+e.actualBoundingBoxDescent;t.beginPath(),t.rect(d(this.x-i-10),d(this.y),d(i+10),d(s+10)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${d(this.textSize)}px Arial`,t.fillStyle=this.textColor,t.fillText(this.score+"",d(this.x-i-5),d(this.y+s+5))}}class w extends y{constructor(t,e,i,s,n,r){super(t,e,i,s,n),this.text=r,this.textSize=10,this.backgroundColor="#000",this.textColor="#fff",this.textColorHover="#9a9a9a",this.listenerEvent("3",(t=>{this.isPositionInside(t.position)&&(document.body.style.cursor="pointer")})),this.listenerEvent(o,(t=>{document.body.style.cursor="default"}))}render(t){t.beginPath(),t.rect(d(this.x),d(this.y),d(this.width),d(this.height)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${d(this.textSize)}px Arial`;const e=t.measureText(this.text),i=u(e.width),s=u(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle=this.isMouseHover?this.textColorHover:this.textColor,t.fillText(this.text,d(this.x+this.width/2-i/2),d(this.y+this.height/2+s/2))}}class P extends y{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.textSize=90,this.text2Size=30,this.text="RECORD",this.score=1e3;const o=15;this.createCredits(this.x+o,this.y,40,30),this.createPlayButton(this.x+(this.width-40-120-o)/2,this.y+this.height-30-o,40,30),this.createShareButton(this.x+(this.width-40-120-o)/2+40+o,this.y+this.height-30-o,120,30)}createPlayButton(t,e,i,s){this.buttonPlay=new w(this.eventEmitter,t,e,i,s,"PLAY")}createCredits(t,e,i,s){this.buttonCredits=new w(this.eventEmitter,t,e,i,s,"@ggjnez92"),this.buttonCredits.backgroundColor="#00000000",this.buttonCredits.textColor="#000",this.buttonCredits.textColorHover="#0048ff",this.buttonCredits.listenerEvent(n,(()=>window.open("https://twitter.com/ggjnez92","_blank").focus()))}createShareButton(t,e,i,s){this.buttonShareRecord=new w(this.eventEmitter,t,e,i,s,"SHARE ON TWITTER"),this.buttonShareRecord.listenerEvent(n,(()=>{const t=`https://twitter.com/intent/tweet?text=${`I%20just%20make%20a%20new%20record%20of%20${this.score}%20points%20in%20the%20%23azetz%20%23game%20developed%20for%20the%20%40js13kGames%20competition.%0A%0A%23js13k%20%23gamedev%0A%0AIf%20you%20want%20to%20check%20it%20out%2C%20here%20is%20the%20link%20to%20the%20%23github%20repository%0Ahttps%3A%2F%2Fgithub.com%2Finflagames%2Fazetz`}`;window.open(t,"_blank").focus()}))}render(t){t.beginPath(),t.rect(0,0,d(e),d(i)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(d(this.x),d(this.y),d(this.width),d(this.height)),t.fillStyle=this.backgroundColor,t.fill(),this.buttonPlay.render(t),this.buttonCredits.render(t),this.buttonShareRecord.render(t),this.renderScore(t)}renderScore(t){t.beginPath(),t.font=`${d(this.textSize)}px Arial`;const e=t.measureText(this.score+""),i=u(e.width),s=u(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.score+"",d(this.x+this.width/2-i/2),d(this.y+this.height/2+s/2)),t.beginPath(),t.font=`${d(this.text2Size)}px Arial`;const n=t.measureText(this.text),o=u(n.width),r=u(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.text,d(this.x+this.width/2-o/2),d(this.y+this.height/2+s/2-s-r/2))}}const C="azetzv1_game_score";let M=null;class W{static getInstance(){return M||(M=new W),M}saveScore(t){localStorage.setItem(C,t+"")}getScore(){const t=localStorage.getItem(C);return t?+t:0}}const B={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return B.Android()||B.BlackBerry()||B.iOS()||B.Opera()||B.Windows()}};class I{constructor(){this.presedKeys=[]}clear(){this.presedKeys=[]}addKey(t){this.isDirectionKey(t)&&!this.presedKeys.includes(t)&&this.presedKeys.push(t)}removeKey(t){this.presedKeys=this.presedKeys.filter((e=>e!==t))}isDirectionKey(t){return"a"===t||"w"===t||"s"===t||"d"===t}hasPressedKeys(){return this.presedKeys.length>0}directionVector(){let t={x:0,y:0};const e=this.direction();return 1&e?t.y=-1:2&e&&(t.y=1),4&e?t.x=-1:8&e&&(t.x=1),m(t)}direction(){let t=0;if(this.presedKeys.length>0){t=this.directionMap(this.presedKeys[0]);let e=1;for(;e<this.presedKeys.length;){let i=this.consumeNextDirection(1,4,8,t,this.directionMap(this.presedKeys[e]));if(i|=this.consumeNextDirection(2,4,8,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(4,1,2,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(8,1,2,t,this.directionMap(this.presedKeys[e])),i){t|=i;break}e++}}return t}consumeNextDirection(t,e,i,s,n){return t!==s||n!==e&&n!==i?0:n}directionMap(t){return"w"===t?1:"s"===t?2:"a"===t?4:"d"===t?8:0}}class K{constructor(t){this.score=null,this.time=0,this.directionKeys=new I,this.level=null,this.player={position:t,rotation:Math.PI/2,directionVector:{x:0,y:1},expectedRotation:0,velocity:0,minVelocity:10,acceleration:20,deceleration:-1.5,status:["3"],component:void 0},this.enemies=[],this.objects=[],this.configs={}}destroy(){this.enemies.forEach((t=>t.component.destroy.emit())),this.objects.forEach((t=>t.component.destroy.emit())),this.player.component.destroy.emit()}play(){this.movePlayer(),this.animateComponents()}movePlayer(){if(this.directionKeys.hasPressedKeys()){const o=(i=this.player.directionVector,s=this.directionKeys.directionVector(),n=.95,{x:i.x+(s.x-i.x)*n,y:i.y+(s.y-i.y)*n});this.player.directionVector=(t=m(o),e=10,{x:t.x*e,y:t.y*e});const r=this.player.position;this.player.position=x(this.player.directionVector,this.player.position),this.checkCollisionWithMap()&&(this.player.position=r)}var t,e,i,s,n;this.player.component.updateCoordinates(this.player.position),this.player.component.updateDirectionVector({...this.player.directionVector,y:-this.player.directionVector.y})}checkCollisionWithMap(){for(const t of this.level.components)if(this.checkCollisionInProjections(this.player.component.getProjection(),t.getProjection()))return!0;return!1}canPauseGame(){return!0}animateComponents(){}pause(){}unpause(){}updateSpaces(){}updateScore(){}getScore(){}checkCollision(){}checkCollisionInProjections(t,e){for(const i of t)for(const t of e)if(p(i.points,t.points))return!0;return!1}}const A=JSON.parse('{"shapes":[{"id":"path40916-9-3","background":"#b85c54","stroke":"#000000","strokeWidth":0.115301,"points":[{"x":-25,"y":-0.9528130671506325},{"x":-25,"y":-23.729582577132486},{"x":-24.092558983666063,"y":-25},{"x":-11.388384754990923,"y":-25},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-11.388384754990923,"y":0.04537205081669882},{"x":-24.092558983666063,"y":0.04537205081669882}]},{"id":"path40916","background":"#c56057","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-24.909255898366606,"y":24.09255898366606},{"x":-24.909255898366606,"y":1.3157894736842088},{"x":-24.001814882032665,"y":0.04537205081669882},{"x":-1.0435571687840195,"y":0.04537205081669882},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-1.1343012704174242,"y":25},{"x":-24.274047186932844,"y":25}]},{"id":"path40916-9","background":"#be7063","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":0.6805807622504538,"y":0.04537205081669882},{"x":23.638838475499107,"y":0.04537205081669882},{"x":24.63702359346643,"y":1.3157894736842088},{"x":24.63702359346643,"y":24.09255898366606},{"x":23.548094373865702,"y":25},{"x":0.4083484573502787,"y":25}]},{"id":"path40916-9-7","background":"#c55f56","stroke":"#000000","strokeWidth":0.178584,"points":[{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-9.210526315789465,"y":-25},{"x":23.729582577132497,"y":-25},{"x":24.63702359346643,"y":-23.729582577132486},{"x":24.63702359346643,"y":-0.9528130671506325},{"x":23.638838475499107,"y":0.04537205081669882},{"x":-9.210526315789465,"y":0.04537205081669882}]}]}'),T=JSON.parse('{"shapes":[{"id":"path40916-0","background":"#c56057","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-25,"y":23.0072463768116},{"x":-25,"y":-22.463768115942017},{"x":-23.18840579710145,"y":-25},{"x":22.64492753623189,"y":-25},{"x":24.275362318840592,"y":-22.463768115942017},{"x":24.275362318840592,"y":23.0072463768116},{"x":22.463768115942045,"y":25},{"x":-23.73188405797101,"y":25}]}]}');class z extends f{constructor(t,e=0,i=0,n){super(t,e,i,n*s,n*s),this.directionVector=this.getRotation(),this.size=n,this.tileShape=1===n?{...T}:{...A},this.positionCorrection={x:0,y:0},this.setupTile()}getRotation(){switch(function(t,e=0){return Math.floor(Math.random()*t)+e}(4)){case 0:return{x:1,y:0};case 1:return{x:0,y:1};case 2:return{x:-1,y:0};case 3:return{x:0,y:-1}}}setupTile(){let t={...this.tileShape.shapes[0].points[0]},e={...this.tileShape.shapes[0].points[0]};for(let i of this.tileShape.shapes)for(let s of i.points)s.x<t.x&&(t.x=s.x),s.y<t.y&&(t.y=s.y),s.x>e.x&&(e.x=s.x),s.y>e.y&&(e.y=s.y);const i=s*this.size/((e.x-t.x)*this.scaleShape),n=s*this.size/((e.y-t.y)*this.scaleShape);this.positionCorrection={x:s*this.size*.5,y:s*this.size*.5},this.tileShape.shapes=this.tileShape.shapes.map((t=>({...t,points:t.points.map((t=>({x:t.x*i,y:t.y*n})))})))}getPosition(){return x(super.getPosition(),this.positionCorrection)}currentShape(){return this.tileShape}animate(){}}const G=JSON.parse('{"name":"first level","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,0,0,0,1],[1,1,0,0,0,0,1,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,1,0,1],[1,0,0,0,1,1,1,0,1,1,0,1],[1,0,0,0,1,1,0,0,1,1,0,1],[1,0,8,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]]}');class D extends y{constructor(t,e=0,i=0,s=0,n=0,o=""){super(t,e,i,s,n),this.backgroundColor=o,this.components=[],this.currentLevel={...G},this.playerInitialPosition={x:0,y:0},this.loadLevel(this.currentLevel.map)}loadLevel(t){const e=new Array(t.length).fill(1).map((()=>new Array(t[0].length).fill(!0)));for(let i=0;i<t.length;i++)for(let n=0;n<t[i].length;n++){const o=t[i][n];if(e[i][n]&&!0&o){let o=1;i+1<t.length&&n+1<t[i].length&&1&t[i][n+1]&&1&t[i+1][n]&&1&t[i+1][n+1]&&(e[i][n]=!1,e[i][n+1]=!1,e[i+1][n]=!1,e[i+1][n+1]=!1,o=2);const r=new z(this.eventEmitter,n*s,i*s,o);this.components.push(r)}8&o&&(this.playerInitialPosition={x:n*s+42.625,y:i*s+42.625})}}render(t){this.cleanScreen(t),this.components.forEach((e=>e.render(t)))}cleanScreen(t){this.backgroundColor?(t.beginPath(),t.fillStyle=this.backgroundColor,t.rect(0,0,d(this.width),d(this.height)),t.fill()):t.clearRect(0,0,e,i)}paintGrid(t){t.strokeStyle="#fff",t.lineWidth=1;for(let n=0;n<e;n+=s)t.beginPath(),t.moveTo(n,0),t.lineTo(n,i),t.stroke();for(let n=0;n<i;n+=s)t.beginPath(),t.moveTo(0,n),t.lineTo(e,n),t.stroke()}}B.any();class V extends c{constructor(t,e){super(t,e),this.buttonPause=new w(this.eventEmitter,10,10,60,30,"PAUSE"),this.buttonPause.backgroundColor="#00000000",this.buttonPause.textSize=20,this.buttonPause.listenerEvent(n,(()=>{this.currentGame.canPauseGame()&&(this.currentGame.pause(),this.showModal(W.getInstance().getScore(),!1))})),this.listenerEvent(r,this.keyDown.bind(this)),this.listenerEvent(h,this.keyUp.bind(this)),this.initGame()}initGame(){this.isModalShow=!1,this.currentGame&&this.currentGame.destroy(),this.level=new D(this.eventEmitter,0,0,e,i,"#000"),this.player=new S(this.eventEmitter,this.level.playerInitialPosition.x,this.level.playerInitialPosition.y,30,35),this.currentGame=new K(this.level.playerInitialPosition),this.currentGame.player.component=this.player,this.currentGame.level=this.level;const t=new E(this.eventEmitter,1014,10);t.backgroundColor="#00000000",this.currentGame.score=t,this.elements=[this.player,this.buttonPause],this.elements.push(t),this.playableElements=[this.player]}render(t){this.currentGame.play(),this.cleanCanvas(t),this.renderOrRemovePlayableElements(t);for(const e of this.elements)e.render(t)}keyDown(t){this.currentGame.directionKeys.addKey(t.key)}keyUp(t){this.currentGame.directionKeys.removeKey(t.key)}showModal(t,e=!0){if(!this.isModalShow){this.isModalShow=!0;const i=300,s=200,n=new P(this.eventEmitter,512-i/2,384-i/2,i,s);W.getInstance().saveScore(Math.max(W.getInstance().getScore(),t)),n.score=t,n.buttonPlay.listenerEvent("2",(()=>{n.buttonPlay.destroy.emit(),n.buttonShareRecord.destroy.emit(),n.buttonCredits.destroy.emit(),this.currentGame.unpause(),this.elements.pop(),this.isModalShow=!1,e&&this.initGame()})),this.elements.push(n)}}renderOrRemovePlayableElements(t){const e=new Set;for(const i of this.playableElements)this.isElementVisible(i)?i.render(t):e.add(i.id);this.playableElements=this.playableElements.filter((t=>!e.has(t.id)))}isElementVisible(t){return t.y-2*t.height<i}cleanCanvas(t){this.level.render(t)}}class O{constructor(t,i){this.gameWidth=e,this.gameHeght=768,this.sceneClasses=new Map,this.sceneClasses.set(1,V),this.scenesInstances=new Map,this.currentScene=null,i.on((t=>{this.currentScene.eventEmitter.emit(t),"8"===t.event&&t.dimension&&(this.gameWidth=t.dimension.w,this.gameHeght=t.dimension.h,this.updateGameDimensions())})),this.navigate(t)}navigate(t){this.scenesInstances.has(t)?this.currentScene=this.scenesInstances.get(t):this.sceneClasses.has(t)&&(this.scenesInstances.set(t,new(this.sceneClasses.get(t))(this,new a)),this.currentScene=this.scenesInstances.get(t)),this.updateGameDimensions()}updateGameDimensions(){this.currentScene&&(this.currentScene.width=this.gameWidth,this.currentScene.height=this.gameHeght)}}const R=1e3/30;let j=null;class H{constructor(){window.addEventListener("resize",this.resizeScreen.bind(this)),this.canvas=document.getElementById("game"),this.registerEvents(),this.eventEmitter=new a,this.context=this.canvas.getContext("2d"),this.navigatorRoot=new O(1,this.eventEmitter),this.loopStatus=3,this.lastTime=0,this.width=this.canvas.width,this.height=this.canvas.height,this.resizeScreen()}registerEvents(){this.registerKeyboardEvent("keydown",r),this.registerKeyboardEvent("keyup",h),this.registerKeyboardEvent("keypress","9"),this.registerClickEvent("click",n),this.registerClickEvent("mousedown","1"),this.registerClickEvent("mouseup","2"),this.registerClickEvent("mouseout",o),this.registerClickEvent("mouseleave","9"),this.registerClickEvent("mousemove","3"),this.registerTouchEvent("touchstart","4",!1),this.registerTouchEvent("touchend","5",!1),this.registerTouchEvent("touchcancel","7",!1),this.registerTouchEvent("touchmove","6",!1)}registerClickEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.clickEvent(t,e)),i)}registerTouchEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.touchEvent(t,e)),i)}registerKeyboardEvent(t,e,i=void 0){document.addEventListener(t,(t=>this.keyboardEvent(t,e)),i)}resizeScreen(){const i=window.innerWidth,s=window.innerHeight;let n=Math.min(e,i),o=n*t;o>s&&(o=s,n=s/t),this.canvas.width=n,this.canvas.height=o,window.currentWidth=n,this.eventEmitter.emit({event:"8",dimension:{w:n,h:o}})}touchEvent(t,e){this.emitPositionEvent({x:t?.targetTouches[0]?.pageX,y:t?.targetTouches[0]?.pageY},e)}clickEvent(t,e){this.emitPositionEvent({x:t?.clientX,y:t?.clientY},e)}keyboardEvent(t,e){this.eventEmitter.emit({event:e,key:t.key})}emitPositionEvent(t,e){const i=this.canvas.getBoundingClientRect();this.eventEmitter.emit({event:e,position:{x:u(t.x-i.left),y:u(t.y-i.top)}})}static getInstance(){return j||(j=new H),j}init(){this.loopStatus=1,requestAnimationFrame(this.loop.bind(this))}loop(t){1===this.loopStatus&&(1===this.loopStatus&&R<=t-this.lastTime&&(this.lastTime=t,this.navigatorRoot.currentScene.render(this.context)),requestAnimationFrame(this.loop.bind(this)))}}H.getInstance().init()})()})();
//# sourceMappingURL=main.js.map