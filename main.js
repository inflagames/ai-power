(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{const e=3/4,i=1024,s=768,n=85.25,o="0",r="8",h="10",a="11";class y{constructor(){this.subscriptions=[],this.open=!0}emit(t={}){for(let e=0;e<this.subscriptions.length;e++)this.callFunction(this.subscriptions[e],t)}async callFunction(t,e){t(e)}pipe(...t){let e=this;for(const i of t){const t=new y;e.on((e=>i(e,t))),e=t}return e}unsub(t){this.subscriptions=this.subscriptions.filter((e=>e!==t))}on(t){this.subscriptions.push(t)}}class x{constructor(e,i=0,s=0,n=0,o=0){this.destroy=new y,this.eventEmitter=e,this.x=i,this.y=s,this.width=n,this.height=o,this.lastMousePosition=null,this.isMouseHover=!1,void 0===t.g.idCount&&(t.g.idCount=0),this.id=t.g.idCount++}set eventEmitter(t){this._eventEmitter=t?t.pipe(function(t){let e=!1;const i=()=>{e=!0,t.unsub(i)};return t.on(i),(t,i)=>{e&&(i.subscriptions=[]),i.emit(t)}}(this.destroy)):t}get eventEmitter(){return this._eventEmitter}render(t){}listenerEvent(t,e){var i;this.eventEmitter.pipe((i=e=>e.event===t,(t,e)=>{i(t)&&e.emit(t)})).on((t=>{(t&&this.validateMouseEventPropagation(t.position,t.event)||this.validateKeyboardEventPropagation(t.event))&&e(t)}))}validateKeyboardEventPropagation(t){return t===h||t===a||"9"===t}validateMouseEventPropagation(t,e){return"5"===e||e===r||"7"===e||"9"===e||(this.isPositionInside(this.lastMousePosition)&&!this.isPositionInside(t)&&this.eventEmitter.emit({event:r}),this.lastMousePosition=t,this.isMouseHover=this.isPositionInside(t))}isPositionInside(t){return t&&t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}}class c extends x{constructor(t,e){super(e),this.navigator=t,this.backgroundColor="#f00",this.elements=[]}render(t){this.cleanCanvas(t);for(const e of this.elements)e.render(t)}cleanCanvas(t){t.rect(0,0,this.width,this.height),t.fillStyle=this.backgroundColor,t.fill()}validateEventPropagation(t,e){const i=super.validateEventPropagation(t,e);if(i)for(const i of this.elements)if(i.validateEventPropagation(t,e))return!1;return i}}function l(t,e){return{x:t.x+e.x,y:t.y+e.y}}function d(t,e,i){const s=function(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}(t,i);return{x:e.x+s.x,y:e.y-s.y}}function u(t){return t*window.currentWidth/i}function p(t){return t*i/window.currentWidth}function m(t,e=0){return Math.floor(Math.random()*t)+e}function g(t,e){if(t.length<3||e.length<3)return!1;const i=[...k(t),...k(e)];for(const s of i){const i=f(t,s),n=f(e,s);if(!(i.min>n.min&&i.min<n.max||i.max>n.min&&i.max<n.max||n.min>i.min&&n.min<i.max||n.max>i.min&&n.max<i.max||i.min===n.min&&i.max===n.max))return!1}return!0}function b(t){if(0===t.x&&0===t.y)return{x:0,y:0};const e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}}function k(t){if(t.length<=1)return[];const e=[];for(let i=1;i<t.length;i++)e.push({x:t[i].x-t[i-1].x,y:t[i-1].y-t[i].y});return e.push({x:t[0].x-t[t.length-1].x,y:t[t.length-1].y-t[0].y}),e}function f(t,e){let i=v(e,t[0]),s=i;for(let n=1;n<t.length;n++){const o=v(e,t[n]);i=Math.min(i,o),s=Math.max(s,o)}return{min:i,max:s}}function v(t,e){return(e.x*t.x+e.y*t.y)/(t.x*t.x+t.y*t.y)}class S extends x{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.backgroundColor="#00f",this.rotation=0,this.directionVector={x:1,y:0},this.scaleShape=3.3,this.brakedShape=null}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}render(t){const e=this.getProjection();for(const i of e){const e=i.points;if(0!==e.length){t.beginPath(),t.moveTo(u(e[0].x),u(e[0].y));for(let i=1;i<e.length;i++)t.lineTo(u(e[i].x),u(e[i].y));t.closePath(),t.fillStyle=i.background,Boolean(i.stroke)&&(t.stroke(),t.strokeStyle=i.stroke,t.lineWidth=5*i.strokeWidth),t.fill()}}}animate(){this.moveBrakedPiece()}brakeShapes(){const t=this.shipShape().shapes;this.brakedShape={shapes:[]};for(const e of t)this.brakedShape={shapes:[...this.brakedShape.shapes,...this.brakeShape(e)]};for(const t of this.brakedShape.shapes){const e=this.shapeCenter(t.points),i=(Math.random()+.5)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));t.vector={x:e.x*i,y:e.y*i}}}brakeShape(t){if(0===t.points.length)return t.points;const{min:e,max:i}=this.coverBox(t.points),s=[];let n=Math.ceil((i.x-e.x)*(i.y-e.y)/2);n=Math.min(n,150);for(let o=0;o<n;o++){const n={x:(i.x-e.x)*Math.random()+e.x,y:(i.y-e.y)*Math.random()+e.y};s.push({points:new Array(3).fill(null).map((()=>({x:n.x+2.5*Math.random(),y:n.y+2.5*Math.random()}))),background:t.background})}return s}shapeCenter(t){const{min:e,max:i}=this.coverBox(t);return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}coverBox(t){const e={x:t[0].x,y:t[0].y},i={...e};for(let s=1;s<t.length;s++)e.x=Math.min(e.x,t[s].x),e.y=Math.min(e.y,t[s].y),i.x=Math.max(i.x,t[s].x),i.y=Math.max(i.y,t[s].y);return{min:e,max:i}}moveBrakedPiece(){if(this.brakedShape)for(const t of this.brakedShape.shapes)t.points=t.points.map((e=>({x:e.x+t.vector.x,y:e.y+t.vector.y}))),t.background=this.reduceOpacity(t.background,30)}reduceOpacity(t,e){let i=this.getOpacity(t);return i=Math.min(255,Math.max(i-e,0)),i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getColorWithOpacity(t,e){let i=Math.min(255,Math.max(Math.floor(255*e),0));return i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getOpacity(t){return t.length>7?parseInt(t.substr(7,2),16):255}getProjection(t=void 0){const e=(i=this.directionVector,Math.atan2(i.y,i.x)+Math.PI/2);var i;const s=this.currentShape().shapes,n=this.getPosition(),o=[];for(const i of s){if(t&&i.id!==t)continue;const s=i.points.map((t=>({x:t.x*this.scaleShape,y:t.y*this.scaleShape})));for(let t=0;t<s.length;t++)s[t]=d(s[t],n,e);o.push({...i,points:s})}return o}getPosition(){return{x:this.x,y:this.y}}currentShape(){return{shapes:[]}}}const w=JSON.parse('{"shapes":[{"id":"foot-r","background":"#523e35","stroke":"#000000","strokeWidth":0.165,"points":[{"x":4.562043795620436,"y":-2.0072992700730055},{"x":3.892944038929425,"y":-5.900243309002441},{"x":5.109489051094872,"y":-7.116788321167892},{"x":7.299270072992698,"y":-7.116788321167892},{"x":8.941605839416084,"y":-6.690997566909989},{"x":9.610705596107024,"y":-5.474452554744541},{"x":9.24574209245744,"y":-3.345498783454996},{"x":8.759124087591225,"y":-1.3381995133820048},{"x":7.907542579075425,"y":2.250608272506067},{"x":5.109489051094872,"y":2.0681265206812505}]},{"id":"foot-l","background":"#523e35","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-4.805352798053512,"y":-2.0072992700730055},{"x":-4.136253041362501,"y":-5.900243309002441},{"x":-5.413625304136236,"y":-7.116788321167892},{"x":-7.542579075425774,"y":-7.116788321167892},{"x":-9.245742092457442,"y":-6.690997566909989},{"x":-9.914841849148385,"y":-5.474452554744541},{"x":-9.549878345498804,"y":-3.345498783454996},{"x":-9.002433090024297,"y":-1.3381995133820048},{"x":-8.211678832116785,"y":2.250608272506067},{"x":-5.352798053527948,"y":2.0681265206812505}]},{"id":"path132294-9","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.5547445255474734,"y":-19.282238442822386},{"x":-3.7712895377129207,"y":-20.74209245742093},{"x":-7.42092457420927,"y":-22.262773722627742},{"x":-13.017031630170294,"y":-22.445255474452555},{"x":-16.970802919708007,"y":-23.96593673965937},{"x":-17.822384428223806,"y":-25},{"x":-17.76155717761559,"y":-23.175182481751825},{"x":-16.60583941605836,"y":-21.411192214111924},{"x":-18.004866180048666,"y":-20.924574209245744},{"x":-16.05839416058392,"y":-20.012165450121657},{"x":-17.274939172749367,"y":-18.734793187347936},{"x":-15.936739659367415,"y":-17.82238442822385},{"x":-16.423357664233567,"y":-16.24087591240876},{"x":-12.22627737226278,"y":-15.81508515815086},{"x":-6.812652068126546,"y":-15.632603406326039},{"x":-2.1897810218978258,"y":-16.24087591240876}]},{"id":"path132294","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.1897810218978258,"y":-19.282238442822386},{"x":3.3454987834549854,"y":-20.74209245742093},{"x":7.0559610705596185,"y":-22.262773722627742},{"x":12.652068126520646,"y":-22.445255474452555},{"x":16.54501216545014,"y":-23.96593673965937},{"x":17.45742092457423,"y":-25},{"x":17.335766423357654,"y":-23.175182481751825},{"x":16.240875912408775,"y":-21.411192214111924},{"x":17.579075425790727,"y":-20.924574209245744},{"x":15.693430656934268,"y":-20.012165450121657},{"x":16.909975669099722,"y":-18.734793187347936},{"x":15.51094890510948,"y":-17.82238442822385},{"x":15.997566909975632,"y":-16.24087591240876},{"x":11.800486618004847,"y":-15.81508515815086},{"x":6.447688564476895,"y":-15.632603406326039},{"x":1.7639902676398869,"y":-16.24087591240876}]},{"id":"path70565","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":3.588807785888058,"y":-18.79562043795621},{"x":2.128953771289538,"y":-19.403892944038933},{"x":-0.3649635036496477,"y":-19.76885644768857},{"x":-2.7980535279805494,"y":-19.403892944038933},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-3.5888077858880614,"y":-18.187347931873482},{"x":-2.372262773722614,"y":-18.79562043795621},{"x":-0.3041362530413636,"y":-18.79562043795621},{"x":1.3990267639902427,"y":-17.944038929440396}]},{"id":"path166293-4","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":-20.49878345498785,"y":-5.048661800486631},{"x":-18.856447688564465,"y":-12.104622871046237},{"x":-18.79562043795618,"y":-14.233576642335773},{"x":-18.917274939172753,"y":-16.849148418491488},{"x":-19.221411192214113,"y":-18.187347931873482},{"x":-21.41119221411194,"y":-18.673965936739663},{"x":-22.992700729926966,"y":-17.639902676399032},{"x":-23.600973236009693,"y":-14.111922141119226},{"x":-23.78345498783455,"y":-10.401459854014607},{"x":-23.78345498783455,"y":-7.785888077858889},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path166293-4-5","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":20.49878345498785,"y":-5.9610705596107145},{"x":18.856447688564465,"y":-13.077858880778596},{"x":18.79562043795618,"y":-15.14598540145986},{"x":18.91727493917275,"y":-17.82238442822385},{"x":19.221411192214113,"y":-19.09975669099757},{"x":21.472019464720155,"y":-19.58637469586375},{"x":22.992700729926966,"y":-18.55231143552312},{"x":23.661800486617977,"y":-15.024330900243314},{"x":23.783454987834553,"y":-11.313868613138695},{"x":23.783454987834553,"y":-8.698296836982976},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165,"points":[{"x":17.396593673965945,"y":-5.231143552311444},{"x":18.004866180048666,"y":2.3114355231143406},{"x":21.046228710462287,"y":3.832116788321155},{"x":22.810218978102178,"y":3.1630170316301545},{"x":24.270072992700705,"y":1.399026763990257},{"x":25,"y":-2.128953771289545},{"x":24.513381995133777,"y":-4.68369829683699},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189-7","background":"#6e3d2e","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-17.39659367396594,"y":-4.31873479318736},{"x":-18.004866180048666,"y":3.2238442822384314},{"x":-21.046228710462287,"y":4.744525547445242},{"x":-22.810218978102178,"y":4.075425790754238},{"x":-24.2700729927007,"y":2.3114355231143406},{"x":-25,"y":-1.1557177615571916},{"x":-24.513381995133777,"y":-3.771289537712903},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path71384","background":"#7b7959","stroke":"#000000","strokeWidth":0.175779,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.90997566909972,"y":-13.321167883211686},{"x":-20.802919708029215,"y":-9.914841849148425},{"x":-21.77615571776152,"y":-6.690997566909989},{"x":-19.951338199513344,"y":4.562043795620426},{"x":-14.233576642335745,"y":8.515815085158138},{"x":-3.163017031630197,"y":11.800486618004847},{"x":6.5085158150851825,"y":11.43552311435522},{"x":15.024330900243328,"y":7.968369829683681},{"x":19.464720194647192,"y":4.379562043795605},{"x":21.59367396593673,"y":-6.447688564476898},{"x":19.951338199513344,"y":-11.009732360097333},{"x":16.42335766423357,"y":-13.38199513381996},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path71384-1","background":"#7b7959","stroke":"#000000","strokeWidth":0.160998,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.301703163016995,"y":-11.131386861313878},{"x":-18.673965936739677,"y":-8.819951338199523},{"x":-20.37712895377128,"y":-6.204379562043805},{"x":-18.61313868613139,"y":3.892944038929425},{"x":-13.321167883211658,"y":7.420924574209224},{"x":-2.9805352798053377,"y":10.340632603406313},{"x":6.082725060827247,"y":10.097323600973219},{"x":14.05109489051096,"y":6.934306569343047},{"x":18.187347931873454,"y":3.710462287104612},{"x":20.133819951338197,"y":-6.0218978102189915},{"x":17.94403892944038,"y":-9.610705596107064},{"x":15.328467153284691,"y":-11.982968369829688},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path65968-1","background":"#ba6560","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-16.24087591240878,"y":3.2238442822384314},{"x":-18.61313868613139,"y":2.3114355231143406},{"x":-19.951338199513344,"y":-7.105427357601002e-15},{"x":-19.82968369829684,"y":-3.2238442822384563},{"x":-18.004866180048666,"y":-5.231143552311444},{"x":-14.598540145985393,"y":-5.6569343065693545},{"x":-14.781021897810183,"y":3.4063260340632446}]},{"id":"path65968","background":"#ba6560","stroke":"#000000","strokeWidth":0.165,"points":[{"x":15.632603406326048,"y":3.2238442822384314},{"x":18.004866180048666,"y":2.3114355231143406},{"x":19.282238442822404,"y":-7.105427357601002e-15},{"x":19.221411192214113,"y":-3.2238442822384563},{"x":17.396593673965945,"y":-5.231143552311444},{"x":13.929440389294385,"y":-5.6569343065693545},{"x":14.172749391727457,"y":3.4063260340632446}]},{"id":"path63330-3","background":"#ab5552","stroke":"#000000","strokeWidth":0.100969,"points":[{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":6.326034063260323,"y":-19.221411192214116},{"x":10.462287104622888,"y":-17.639902676399032},{"x":12.226277372262778,"y":-15.328467153284675},{"x":12.591240875912426,"y":-11.982968369829688},{"x":11.070559610705615,"y":-8.51581508515816},{"x":6.630170316301687,"y":-6.630170316301715},{"x":3.1021897810219095,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171},{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":-6.630170316301687,"y":-19.221411192214116},{"x":-10.766423357664257,"y":-17.639902676399032},{"x":-12.530413625304144,"y":-15.328467153284675},{"x":-12.895377128953792,"y":-11.982968369829688},{"x":-11.435523114355197,"y":-8.51581508515816},{"x":-6.93430656934305,"y":-6.630170316301715},{"x":-3.406326034063273,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171}]},{"id":"path70563-6","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-12.895377128953792,"y":-18.24817518248176},{"x":-12.77372262773722,"y":-16.605839416058398},{"x":-3.5888077858880614,"y":-17.457420924574212},{"x":-3.7104622871046367,"y":-18.917274939172756}]},{"id":"path70563","background":"#3a3544","stroke":"#000000","strokeWidth":0.165,"points":[{"x":12.530413625304142,"y":-18.3698296836983},{"x":12.469586374695858,"y":-16.727493917274945},{"x":3.2238442822384137,"y":-17.396593673965945},{"x":3.3454987834549854,"y":-18.917274939172756}]},{"id":"path66083","background":"#c56057","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-3.2238442822384137,"y":-14.841849148418497},{"x":-4.501216545012149,"y":-16.90997566909976},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-2.7980535279805494,"y":-20.012165450121657},{"x":-2.493917274939186,"y":-21.411192214111924},{"x":-1.520681265206811,"y":-22.019464720194648},{"x":-0.3041362530413636,"y":-22.08029197080292},{"x":0.9124087591240908,"y":-22.019464720194648},{"x":1.8856447688564586,"y":-21.411192214111924},{"x":2.128953771289538,"y":-20.012165450121657},{"x":3.588807785888058,"y":-18.79562043795621},{"x":3.8321167883211373,"y":-16.90997566909976},{"x":2.55474452554747,"y":-14.841849148418497},{"x":-0.3041362530413636,"y":-14.598540145985409}]},{"id":"path119374","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.55474452554747,"y":-16.849148418491488},{"x":3.8321167883211373,"y":-18.430656934306572},{"x":7.116788321167903,"y":-18.30900243309003},{"x":9.732360097323593,"y":-18.065693430656935},{"x":10.827250608272472,"y":-18.430656934306572},{"x":9.732360097323593,"y":-17.03163017031631},{"x":6.934306569343047,"y":-16.66666666666667}]},{"id":"path119374-2","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.91970802919705,"y":-16.727493917274945},{"x":-4.257907542579073,"y":-18.3698296836983},{"x":-7.542579075425774,"y":-18.24817518248176},{"x":-10.15815085158153,"y":-18.004866180048666},{"x":-11.253041362530409,"y":-18.3698296836983},{"x":-10.15815085158153,"y":-16.970802919708035},{"x":-7.360097323600982,"y":-16.605839416058398}]},{"id":"path63330","background":"#ab5552","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":8.39416058394157,"y":-16.66666666666667},{"x":13.80778588807788,"y":-13.503649635036503},{"x":16.18004866180049,"y":-8.819951338199523},{"x":16.60583941605836,"y":-2.0681265206812753},{"x":14.65936739659368,"y":5.048661800486602},{"x":8.759124087591225,"y":8.880778588807772},{"x":4.1362530413625045,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113},{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":-8.637469586374717,"y":-16.66666666666667},{"x":-14.111922141119242,"y":-13.503649635036503},{"x":-16.423357664233567,"y":-8.819951338199523},{"x":-16.849148418491502,"y":-2.0681265206812753},{"x":-14.902676399026756,"y":5.048661800486602},{"x":-9.002433090024297,"y":8.880778588807772},{"x":-4.440389294403861,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113}]},{"id":"path132989","background":"#e2eac1","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-15.51094890510948,"y":-9.367396593673973},{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-3.5279805352797773,"y":-16.484184914841855},{"x":3.2846715328467013,"y":-16.484184914841855},{"x":9.24574209245744,"y":-14.781021897810225},{"x":14.963503649635044,"y":-9.063260340632612},{"x":16.484184914841855,"y":-2.6763990267640025},{"x":15.632603406326048,"y":2.433090024330891},{"x":12.591240875912426,"y":10.03649635036495},{"x":10.827250608272472,"y":14.051094890510932},{"x":9.48905109489052,"y":10.94890510948904},{"x":8.69829683698294,"y":12.652068126520668},{"x":7.968369829683709,"y":14.111922141119202},{"x":7.360097323600982,"y":15.571776155717743},{"x":5.9610705596106754,"y":13.564476885644751},{"x":5.352798053527952,"y":10.5839416058394},{"x":3.8321167883211373,"y":12.165450121654487},{"x":1.9464720194647462,"y":15.936739659367369},{"x":-0.9124087591240873,"y":10.827250608272486},{"x":-1.4598540145985233,"y":13.442822384428204},{"x":-2.372262773722614,"y":16.1192214111922},{"x":-4.379562043795644,"y":14.659367396593652},{"x":-4.683698296837008,"y":12.591240875912384},{"x":-5.47445255474452,"y":9.610705596107039},{"x":-6.386861313868611,"y":12.773722627737207},{"x":-7.603406326034058,"y":15.81508515815083},{"x":-8.698296836982937,"y":12.591240875912384},{"x":-9.245742092457442,"y":9.245742092457398},{"x":-9.914841849148385,"y":11.253041362530396},{"x":-11.800486618004847,"y":15.145985401459832},{"x":-12.469586374695856,"y":11.6788321167883},{"x":-14.29440389294403,"y":7.968369829683681},{"x":-16.90997566909972,"y":-2.128953771289545}]}]}');class E extends S{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.rotation=Math.PI/2,this.directionVector={x:0,y:1},this.scaleShape=1.5,this.shape={...w},this.time=(new Date).getTime(),this.animation=0,this.animationIsOn=!1,this.updateCoordinates()}updateCoordinates({x:t,y:e}={}){this.x=t||this.x,this.y=e||this.y}updateDirectionVector(t){this.directionVector=t}animate(){1&this.animation?(this.animationIsOn=!0,this.animateWalk()):this.animationIsOn&&(this.shape={...w})}animateWalk(){const t=-20*this.stepAnimationFunction();this.shape.shapes=w.shapes.map((e=>{if(e.id.startsWith("foot")){const i=e.id.endsWith("-l")?t:-t;return{...e,points:e.points.map((t=>({...t,y:t.y+i})))}}return{...e}}))}stepAnimationFunction(){const t=((new Date).getTime()-this.time)/500;return Math.sin(t*Math.PI)}currentShape(){return this.brakedShape||this.shape}}class P extends x{constructor(t,e,i){super(t,e,i),this.level=0,this.textSize=30,this.backgroundColor="#000",this.textColor="#fff",this.lastTime=0}render(t){t.font=`${u(this.textSize)}px Arial`;const e=`LEVEL ${this.level}`,i=t.measureText(e),s=i.width,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;t.beginPath(),t.rect(u(this.x-s-10),u(this.y),u(s+10),u(n+10)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${u(this.textSize)}px Arial`,t.fillStyle=this.textColor,t.fillText(e,u(this.x-s-5),u(this.y+n+5))}}class C extends x{constructor(t,e,i,s,n,o){super(t,e,i,s,n),this.text=o,this.textSize=10,this.backgroundColor="#000",this.textColor="#fff",this.textColorHover="#9a9a9a",this.listenerEvent("3",(t=>{this.isPositionInside(t.position)&&(document.body.style.cursor="pointer")})),this.listenerEvent(r,(t=>{document.body.style.cursor="default"}))}render(t){t.beginPath(),t.rect(u(this.x),u(this.y),u(this.width),u(this.height)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${u(this.textSize)}px Arial`;const e=t.measureText(this.text),i=p(e.width),s=p(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle=this.isMouseHover?this.textColorHover:this.textColor,t.fillText(this.text,u(this.x+this.width/2-i/2),u(this.y+this.height/2+s/2))}}class M extends x{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.textSize=90,this.text2Size=30,this.text="RECORD",this.score=1e3;const o=15;this.createCredits(this.x+o,this.y,40,30),this.createPlayButton(this.x+(this.width-40-120-o)/2,this.y+this.height-30-o,40,30),this.createShareButton(this.x+(this.width-40-120-o)/2+40+o,this.y+this.height-30-o,120,30)}createPlayButton(t,e,i,s){this.buttonPlay=new C(this.eventEmitter,t,e,i,s,"PLAY")}createCredits(t,e,i,s){this.buttonCredits=new C(this.eventEmitter,t,e,i,s,"@ggjnez92"),this.buttonCredits.backgroundColor="#00000000",this.buttonCredits.textColor="#000",this.buttonCredits.textColorHover="#0048ff",this.buttonCredits.listenerEvent(o,(()=>window.open("https://twitter.com/ggjnez92","_blank").focus()))}createShareButton(t,e,i,s){this.buttonShareRecord=new C(this.eventEmitter,t,e,i,s,"SHARE ON TWITTER"),this.buttonShareRecord.listenerEvent(o,(()=>{const t=`https://twitter.com/intent/tweet?text=${`I%20just%20make%20a%20new%20record%20of%20${this.score}%20points%20in%20the%20%23azetz%20%23game%20developed%20for%20the%20%40js13kGames%20competition.%0A%0A%23js13k%20%23gamedev%0A%0AIf%20you%20want%20to%20check%20it%20out%2C%20here%20is%20the%20link%20to%20the%20%23github%20repository%0Ahttps%3A%2F%2Fgithub.com%2Finflagames%2Fazetz`}`;window.open(t,"_blank").focus()}))}render(t){t.beginPath(),t.rect(0,0,u(i),u(s)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(u(this.x),u(this.y),u(this.width),u(this.height)),t.fillStyle=this.backgroundColor,t.fill(),this.buttonPlay.render(t),this.buttonCredits.render(t),this.buttonShareRecord.render(t),this.renderScore(t)}renderScore(t){t.beginPath(),t.font=`${u(this.textSize)}px Arial`;const e=t.measureText(this.score+""),i=p(e.width),s=p(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.score+"",u(this.x+this.width/2-i/2),u(this.y+this.height/2+s/2)),t.beginPath(),t.font=`${u(this.text2Size)}px Arial`;const n=t.measureText(this.text),o=p(n.width),r=p(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.text,u(this.x+this.width/2-o/2),u(this.y+this.height/2+s/2-s-r/2))}}const W="azetzv1_game_score";let I=null;class B{static getInstance(){return I||(I=new B),I}saveScore(t){localStorage.setItem(W,t+"")}getScore(){const t=localStorage.getItem(W);return t?+t:0}}const T={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return T.Android()||T.BlackBerry()||T.iOS()||T.Opera()||T.Windows()}};class A{constructor(){this.presedKeys=[]}clear(){this.presedKeys=[]}addKey(t){this.isDirectionKey(t)&&!this.presedKeys.includes(t)&&this.presedKeys.push(t)}removeKey(t){this.presedKeys=this.presedKeys.filter((e=>e!==t))}isDirectionKey(t){return"a"===t||"w"===t||"s"===t||"d"===t}hasPressedKeys(){return this.presedKeys.length>0}directionVector(){let t={x:0,y:0};const e=this.direction();return 1&e?t.y=-1:2&e&&(t.y=1),4&e?t.x=-1:8&e&&(t.x=1),b(t)}direction(){let t=0;if(this.presedKeys.length>0){t=this.directionMap(this.presedKeys[0]);let e=1;for(;e<this.presedKeys.length;){let i=this.consumeNextDirection(1,4,8,t,this.directionMap(this.presedKeys[e]));if(i|=this.consumeNextDirection(2,4,8,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(4,1,2,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(8,1,2,t,this.directionMap(this.presedKeys[e])),i){t|=i;break}e++}}return t}consumeNextDirection(t,e,i,s,n){return t!==s||n!==e&&n!==i?0:n}directionMap(t){return"w"===t?1:"s"===t?2:"a"===t?4:"d"===t?8:0}}class K{constructor(t){this.directionKeys=new A,this.level=null,this.player={position:t,rotation:Math.PI/2,directionVector:{x:0,y:1},expectedRotation:0,velocity:0,minVelocity:10,acceleration:20,deceleration:-1.5,status:["3"],component:void 0},this.enemies=[],this.objects=[],this.configs={}}destroy(){this.enemies.forEach((t=>t.component.destroy.emit())),this.objects.forEach((t=>t.component.destroy.emit())),this.player.component.destroy.emit()}play(){this.movePlayer(),this.animateComponents()}movePlayer(){if(this.directionKeys.hasPressedKeys()){const o=(i=this.player.directionVector,s=this.directionKeys.directionVector(),n=.95,{x:i.x+(s.x-i.x)*n,y:i.y+(s.y-i.y)*n});this.player.directionVector=(t=b(o),e=10,{x:t.x*e,y:t.y*e});const r=this.player.position;this.player.position=l(this.player.directionVector,this.player.position),this.checkCollisionWithMap()&&(this.player.position=r),this.player.component.animation|=1}else this.player.component.animation=0;var t,e,i,s,n;this.player.component.updateCoordinates(this.player.position),this.player.component.updateDirectionVector({...this.player.directionVector,y:-this.player.directionVector.y})}checkCollisionWithMap(){for(const t of this.level.tiles)if(this.checkCollisionInProjections(this.player.component.getProjection(),t.getProjection()))return!0;for(const t of this.level.finishLevelItem)if(this.checkCollisionInProjections(this.player.component.getProjection(),t.getProjection("center")))return this.levelComplete(),!1;return!1}canPauseGame(){return!0}animateComponents(){this.player.component.animate()}pause(){}unpause(){}updateSpaces(){}updateScore(){}getScore(){}checkCollision(){}checkCollisionInProjections(t,e){for(const i of t)for(const t of e)if(g(i.points,t.points))return!0;return!1}levelComplete(){console.log("Level complete")}}const G=JSON.parse('{"shapes":[{"id":"path40916-9-3","background":"#b85c54","stroke":"#000000","strokeWidth":0.115301,"points":[{"x":-25,"y":-0.9528130671506325},{"x":-25,"y":-23.729582577132486},{"x":-24.092558983666063,"y":-25},{"x":-11.388384754990923,"y":-25},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-11.388384754990923,"y":0.04537205081669882},{"x":-24.092558983666063,"y":0.04537205081669882}]},{"id":"path40916","background":"#c56057","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-24.909255898366606,"y":24.09255898366606},{"x":-24.909255898366606,"y":1.3157894736842088},{"x":-24.001814882032665,"y":0.04537205081669882},{"x":-1.0435571687840195,"y":0.04537205081669882},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-1.1343012704174242,"y":25},{"x":-24.274047186932844,"y":25}]},{"id":"path40916-9","background":"#be7063","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":0.6805807622504538,"y":0.04537205081669882},{"x":23.638838475499107,"y":0.04537205081669882},{"x":24.63702359346643,"y":1.3157894736842088},{"x":24.63702359346643,"y":24.09255898366606},{"x":23.548094373865702,"y":25},{"x":0.4083484573502787,"y":25}]},{"id":"path40916-9-7","background":"#c55f56","stroke":"#000000","strokeWidth":0.178584,"points":[{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-9.210526315789465,"y":-25},{"x":23.729582577132497,"y":-25},{"x":24.63702359346643,"y":-23.729582577132486},{"x":24.63702359346643,"y":-0.9528130671506325},{"x":23.638838475499107,"y":0.04537205081669882},{"x":-9.210526315789465,"y":0.04537205081669882}]}]}'),z=JSON.parse('{"shapes":[{"id":"path40916-0","background":"#c56057","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-25,"y":23.0072463768116},{"x":-25,"y":-22.463768115942017},{"x":-23.18840579710145,"y":-25},{"x":22.64492753623189,"y":-25},{"x":24.275362318840592,"y":-22.463768115942017},{"x":24.275362318840592,"y":23.0072463768116},{"x":22.463768115942045,"y":25},{"x":-23.73188405797101,"y":25}]}]}'),D=JSON.parse('{"shapes":[{"id":"path40916-9-3-3","background":"#b85c54","stroke":"#000000","strokeWidth":0.057048,"points":[{"x":-25,"y":-0.636363636363626},{"x":-25,"y":-23.181818181818183},{"x":-23.727272727272723,"y":-24.818181818181802},{"x":-11.181818181818178,"y":-25},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-10.090909090909086,"y":-0.636363636363626},{"x":-11.181818181818178,"y":0.27272727272728403},{"x":-23.727272727272723,"y":0.27272727272728403}]},{"id":"path40916-6","background":"#c56057","stroke":"#000000","strokeWidth":0.0874443,"points":[{"x":-25,"y":24.090909090909093},{"x":-25,"y":1.5454545454545325},{"x":-23.181818181818183,"y":0.27272727272728403},{"x":8.636363636363647,"y":0.27272727272728403},{"x":9.727272727272727,"y":1.5454545454545325},{"x":9.727272727272727,"y":24.090909090909093},{"x":8.454545454545453,"y":25},{"x":-23.727272727272723,"y":25}]},{"id":"path40916-9-1","background":"#be7063","stroke":"#000000","strokeWidth":0.0739228,"points":[{"x":9.727272727272727,"y":24.090909090909093},{"x":9.727272727272727,"y":1.5454545454545325},{"x":10.63636363636364,"y":0.27272727272728403},{"x":23.545454545454533,"y":0.27272727272728403},{"x":24.636363636363647,"y":1.5454545454545325},{"x":24.636363636363647,"y":24.090909090909093},{"x":23.545454545454533,"y":25},{"x":10.272727272727273,"y":25}]},{"id":"path40916-9-7-0","background":"#c55f56","stroke":"#000000","strokeWidth":0.0883588,"points":[{"x":-10.090909090909086,"y":-0.8181818181817988},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-8.999999999999993,"y":-24.818181818181802},{"x":23.727272727272734,"y":-24.818181818181802},{"x":24.636363636363647,"y":-23.363636363636353},{"x":24.636363636363647,"y":-0.8181818181817988},{"x":23.545454545454533,"y":0.27272727272728403},{"x":-8.999999999999993,"y":0.27272727272728403}]}]}'),O=["#b85c54","#c56057","#be7063","#c55f56"];class V extends S{constructor(t,e=0,i=0,s){super(t,e,i,s*n,s*n),this.directionVector=this.getRotation(),this.type=s,this.tileShape={...this.getShape(s)},this.positionCorrection={x:0,y:0},this.setupTile()}getShape(t){switch(t){case 1:return z;case 2:return G;default:return D}}getRotation(){switch(m(4)){case 0:return{x:1,y:0};case 1:return{x:0,y:1};case 2:return{x:-1,y:0};case 3:return{x:0,y:-1}}}setupTile(){let t={...this.tileShape.shapes[0].points[0]},e={...this.tileShape.shapes[0].points[0]};for(let i of this.tileShape.shapes)for(let s of i.points)s.x<t.x&&(t.x=s.x),s.y<t.y&&(t.y=s.y),s.x>e.x&&(e.x=s.x),s.y>e.y&&(e.y=s.y);const i=n*this.getGridSize()/((e.x-t.x)*this.scaleShape),s=n*this.getGridSize()/((e.y-t.y)*this.scaleShape);this.positionCorrection={x:n*this.getGridSize()*.5,y:n*this.getGridSize()*.5},this.tileShape.shapes=this.tileShape.shapes.map((t=>({...t,background:O[m(O.length)],points:t.points.map((t=>({x:t.x*i,y:t.y*s})))})))}getGridSize(){switch(this.type){case 1:case 3:return 1;case 2:return 2}}getPosition(){return l(super.getPosition(),this.positionCorrection)}currentShape(){return this.tileShape}animate(){}}const j=JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,0,0,2,1],[1,1,0,0,0,0,1,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,1,0,1],[1,0,0,0,1,1,1,0,1,1,0,1],[1,0,0,0,1,1,0,0,1,1,0,1],[1,0,8,0,0,0,0,0,0,0,0,1],[1,0,0,0,2,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]]}');class F extends S{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.scaleShape=0,this.lifeTime=0}render(t){this.calculateScale(),this.lifeTime++,t.beginPath(),t.fillStyle=this.getColorWithOpacity("#6c8d8eff",this.showAndHideFunction(this.getTimeFactor())),this.scaleShape=this.growBubbleFunction(this.getTimeFactor());const e=this.width*this.scaleShape,i=this.height*this.scaleShape;t.ellipse(this.x,this.y,e,i,0,0,2*Math.PI),t.fill()}calculateScale(){this.scaleShape=Math.sin(this.y/10)}getTimeFactor(){return Math.min(this.lifeTime/20,1)}showAndHideFunction(t){return Math.sin(t*Math.PI)/1.5}growBubbleFunction(t){return 1.4426950408889634*Math.log(t+1)}bubbleDead(){return this.lifeTime>20}}const R=JSON.parse('{"shapes":[{"id":"center","background":"#352835","points":[{"x":-15.52132701421802,"y":-17.417061611374375},{"x":-20.73459715639808,"y":-2.7251184834123343},{"x":-5.5687203791468995,"y":9.360189573459678},{"x":8.412322274881468,"y":1.777251184834121},{"x":8.175355450236935,"y":-12.440758293838849},{"x":-3.9099526066350805,"y":-21.208530805687154}]},{"id":"path187494","background":"#4e3b43","points":[{"x":-25,"y":-5.805687203791436},{"x":-23.578199052132682,"y":-11.018957345971566},{"x":-21.445497630331758,"y":-15.758293838862555},{"x":-17.890995260663516,"y":-20.260663507109008},{"x":-12.914691943127956,"y":-23.341232227488113},{"x":-5.094786729857827,"y":-25},{"x":2.4881516587677304,"y":-23.104265402843577},{"x":7.4644549763033226,"y":-19.075829383886262},{"x":11.96682464454971,"y":-11.966824644549778},{"x":12.440758293838847,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-9.834123222748817},{"x":0.5924170616113713,"y":-12.677725118483385},{"x":-2.4881516587677943,"y":-14.573459715639808},{"x":-7.701421800947859,"y":-14.810426540284343},{"x":-11.966824644549778,"y":-12.440758293838849},{"x":-14.810426540284343,"y":-8.175355450236932},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path187494-6","background":"#4e3b43","points":[{"x":-25,"y":-6.516587677725109},{"x":-23.578199052132682,"y":-0.3554502369668384},{"x":-21.445497630331758,"y":4.383886255924153},{"x":-17.890995260663516,"y":8.886255924170605},{"x":-12.914691943127956,"y":11.966824644549781},{"x":-5.094786729857827,"y":13.625592417061597},{"x":2.4881516587677304,"y":11.729857819905178},{"x":7.4644549763033226,"y":7.7014218009478626},{"x":11.96682464454971,"y":0.5924170616113713},{"x":12.440758293838847,"y":-6.516587677725109},{"x":2.7251184834123308,"y":-6.516587677725109},{"x":2.251184834123194,"y":-1.5402843601895881},{"x":0.5924170616113713,"y":1.3033175355450517},{"x":-2.4881516587677943,"y":3.199052132701407},{"x":-7.701421800947859,"y":3.4360189573459436},{"x":-11.966824644549778,"y":1.0663507109004442},{"x":-14.810426540284343,"y":-3.1990521327014037},{"x":-15.28436018957345,"y":-6.516587677725109}]},{"id":"path188158","background":"#1f1720","points":[{"x":-17.417061611374407,"y":-5.805687203791436},{"x":-16.943127962085303,"y":-9.36018957345968},{"x":-13.38862559241706,"y":-14.09952606635067},{"x":-7.701421800947859,"y":-17.417061611374375},{"x":-2.0142180094786575,"y":-16.943127962085303},{"x":2.7251184834123308,"y":-14.09952606635067},{"x":4.857819905213223,"y":-10.071090047393355},{"x":5.331753554502367,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-9.834123222748817},{"x":0.5924170616113713,"y":-12.677725118483385},{"x":-2.4881516587677943,"y":-14.573459715639808},{"x":-7.701421800947859,"y":-14.810426540284343},{"x":-11.966824644549778,"y":-12.440758293838849},{"x":-14.810426540284343,"y":-8.175355450236932},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path188158-3","background":"#1f1720","points":[{"x":-17.417061611374407,"y":-5.805687203791436},{"x":-16.943127962085303,"y":-2.0142180094786575},{"x":-13.38862559241706,"y":2.7251184834123308},{"x":-7.701421800947859,"y":5.805687203791436},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":2.7251184834123308,"y":2.7251184834123308},{"x":4.857819905213223,"y":-1.3033175355450481},{"x":5.331753554502367,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-1.5402843601895881},{"x":0.5924170616113713,"y":1.3033175355450517},{"x":-2.4881516587677943,"y":3.199052132701407},{"x":-7.701421800947859,"y":3.4360189573459436},{"x":-11.966824644549778,"y":1.0663507109004442},{"x":-14.810426540284343,"y":-3.1990521327014037},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path194589","background":"#697083","points":[{"x":-10.781990521327028,"y":2.962085308056867},{"x":-13.151658767772524,"y":4.85781990521329},{"x":-12.203791469194314,"y":6.753554502369646},{"x":-11.966824644549778,"y":12.677725118483387},{"x":-11.492890995260671,"y":20.73459715639808},{"x":-10.071090047393355,"y":22.15639810426537},{"x":-9.597156398104282,"y":13.862559241706137},{"x":-8.649289099526069,"y":14.573459715639807},{"x":-7.938388625592395,"y":25},{"x":-5.094786729857827,"y":24.526066350710863},{"x":-4.857819905213294,"y":18.127962085308056},{"x":-3.9099526066350805,"y":15.995260663507096},{"x":-2.4881516587677943,"y":23.578199052132646},{"x":-1.3033175355450481,"y":22.393364928909904},{"x":-2.0142180094786575,"y":15.04739336492888},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":-0.11848341232230197,"y":4.146919431279617},{"x":-0.3554502369668384,"y":2.4881516587677943},{"x":1.3033175355449842,"y":0.8293838862559078},{"x":0.3554502369668384,"y":-1.5402843601895881},{"x":-4.620853080568757,"y":0.11848341232230197},{"x":-10.308056872037923,"y":1.0663507109004442}]},{"id":"path202169","background":"#697083","points":[{"x":-10.781990521327028,"y":2.962085308056867},{"x":-11.018957345971566,"y":6.04265402843604},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":-0.3554502369668384,"y":2.4881516587677943}]}]}');class L extends S{constructor(t,e=0,i=0){super(t,e,i,0,0),this.directionVector={x:0,y:1},this.shape={...R},this.scaleShape=1.7}getPosition(){return{x:this.x-8,y:this.y+10}}currentShape(){return this.shape}}class H extends x{constructor(t,e=0,i=0,s=0,n=0,o=""){super(t,e,i,s,n),this.backgroundColor=o;this.newBubble();this.components=[],this.tiles=[],this.floor=[],this.bubbles=[],this.finishLevelItem=[],this.currentLevel={...j},this.playerInitialPosition={x:0,y:0},this.loadLevel(this.currentLevel)}loadLevel(t){this.backgroundColor=t.background;const e=t.map,i=new Array(e.length).fill(1).map((()=>new Array(e[0].length).fill(!0)));for(let t=0;t<e.length;t++)for(let s=0;s<e[t].length;s++){const o=e[t][s];if(i[t][s]&&1&o){let o=1;t+1<e.length&&s+1<e[t].length&&1&e[t][s+1]&&1&e[t+1][s]&&1&e[t+1][s+1]&&(i[t][s]=!1,i[t][s+1]=!1,i[t+1][s]=!1,i[t+1][s+1]=!1,o=2);const r=new V(this.eventEmitter,s*n,t*n,o);this.tiles.push(r),this.components.push(r)}else if(!(1&o)){const e=new V(this.eventEmitter,s*n,t*n,3);this.floor.push(e)}if(2&o){const e=new L(this.eventEmitter,s*n+42.625,t*n+42.625);this.finishLevelItem.push(e),this.components.push(e)}8&o&&(this.playerInitialPosition={x:s*n+42.625,y:t*n+42.625})}}pauseGame(){}unPauseGame(){}render(t){this.cleanScreen(t),this.floor.forEach((e=>e.render(t))),this.renderWatterColor(t),this.updateBubbles(),this.components.forEach((e=>e.render(t)))}updateBubbles(){const t=new Set;for(const e of this.bubbles)e.bubbleDead()&&t.add(e.id);if(this.bubbles=this.bubbles.filter((e=>!t.has(e.id))),this.components=this.components.filter((e=>!t.has(e.id))),this.bubbles.length<20&&1===m(2)){const t=this.newBubble();this.components.unshift(t),this.bubbles.push(t)}}newBubble(){const t=m(40,10),e=m(40,10),n=m(i),o=m(s);return new F(this.eventEmitter,n,o,t,e)}renderWatterColor(t){this.backgroundColor&&(t.beginPath(),t.fillStyle=this.backgroundColor,t.rect(0,0,u(this.width),u(this.height)),t.fill())}cleanScreen(t){t.clearRect(0,0,i,s)}}T.any();class N extends c{constructor(t,e){super(t,e),this.buttonPause=new C(this.eventEmitter,10,10,100,30,"SETTINGS"),this.buttonPause.backgroundColor="#00000000",this.buttonPause.textSize=20,this.buttonPause.listenerEvent(o,(()=>{this.currentGame.canPauseGame()&&(this.currentGame.pause(),this.showModal(B.getInstance().getScore(),!1))})),this.listenerEvent(h,this.keyDown.bind(this)),this.listenerEvent(a,this.keyUp.bind(this)),this.initGame()}initGame(){this.isModalShow=!1,this.currentGame&&this.currentGame.destroy(),this.level=new H(this.eventEmitter,0,0,i,s,"#000"),this.player=new E(this.eventEmitter,this.level.playerInitialPosition.x,this.level.playerInitialPosition.y,30,35),this.currentGame=new K(this.level.playerInitialPosition),this.currentGame.player.component=this.player,this.currentGame.level=this.level;const t=new P(this.eventEmitter,1014,10);t.backgroundColor="#00000000",this.currentGame.score=t,this.elements=[this.player,this.buttonPause],this.elements.push(t),this.playableElements=[this.player]}render(t){this.currentGame.play(),this.cleanCanvas(t),this.renderOrRemovePlayableElements(t);for(const e of this.elements)e.render(t)}keyDown(t){this.currentGame.directionKeys.addKey(t.key)}keyUp(t){this.currentGame.directionKeys.removeKey(t.key)}showModal(t,e=!0){if(!this.isModalShow){this.isModalShow=!0;const i=300,s=200,n=new M(this.eventEmitter,512-i/2,384-i/2,i,s);B.getInstance().saveScore(Math.max(B.getInstance().getScore(),t)),n.score=t,n.buttonPlay.listenerEvent("2",(()=>{n.buttonPlay.destroy.emit(),n.buttonShareRecord.destroy.emit(),n.buttonCredits.destroy.emit(),this.currentGame.unpause(),this.elements.pop(),this.isModalShow=!1,e&&this.initGame()})),this.elements.push(n)}}renderOrRemovePlayableElements(t){const e=new Set;for(const i of this.playableElements)this.isElementVisible(i)?i.render(t):e.add(i.id);this.playableElements=this.playableElements.filter((t=>!e.has(t.id)))}isElementVisible(t){return t.y-2*t.height<s}cleanCanvas(t){this.level.render(t)}}class ${constructor(t,e){this.gameWidth=i,this.gameHeght=768,this.sceneClasses=new Map,this.sceneClasses.set(1,N),this.scenesInstances=new Map,this.currentScene=null,e.on((t=>{this.currentScene.eventEmitter.emit(t),"8"===t.event&&t.dimension&&(this.gameWidth=t.dimension.w,this.gameHeght=t.dimension.h,this.updateGameDimensions())})),this.navigate(t)}navigate(t){this.scenesInstances.has(t)?this.currentScene=this.scenesInstances.get(t):this.sceneClasses.has(t)&&(this.scenesInstances.set(t,new(this.sceneClasses.get(t))(this,new y)),this.currentScene=this.scenesInstances.get(t)),this.updateGameDimensions()}updateGameDimensions(){this.currentScene&&(this.currentScene.width=this.gameWidth,this.currentScene.height=this.gameHeght)}}const J=1e3/30;let _=null;class q{constructor(){window.addEventListener("resize",this.resizeScreen.bind(this)),this.canvas=document.getElementById("game"),this.registerEvents(),this.eventEmitter=new y,this.context=this.canvas.getContext("2d"),this.navigatorRoot=new $(1,this.eventEmitter),this.loopStatus=3,this.lastTime=0,this.width=this.canvas.width,this.height=this.canvas.height,this.resizeScreen()}registerEvents(){this.registerKeyboardEvent("keydown",h),this.registerKeyboardEvent("keyup",a),this.registerKeyboardEvent("keypress","9"),this.registerClickEvent("click",o),this.registerClickEvent("mousedown","1"),this.registerClickEvent("mouseup","2"),this.registerClickEvent("mouseout",r),this.registerClickEvent("mouseleave","9"),this.registerClickEvent("mousemove","3"),this.registerTouchEvent("touchstart","4",!1),this.registerTouchEvent("touchend","5",!1),this.registerTouchEvent("touchcancel","7",!1),this.registerTouchEvent("touchmove","6",!1)}registerClickEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.clickEvent(t,e)),i)}registerTouchEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.touchEvent(t,e)),i)}registerKeyboardEvent(t,e,i=void 0){document.addEventListener(t,(t=>this.keyboardEvent(t,e)),i)}resizeScreen(){const t=window.innerWidth,s=window.innerHeight;let n=Math.min(i,t),o=n*e;o>s&&(o=s,n=s/e),this.canvas.width=n,this.canvas.height=o,window.currentWidth=n,this.eventEmitter.emit({event:"8",dimension:{w:n,h:o}})}touchEvent(t,e){this.emitPositionEvent({x:t?.targetTouches[0]?.pageX,y:t?.targetTouches[0]?.pageY},e)}clickEvent(t,e){this.emitPositionEvent({x:t?.clientX,y:t?.clientY},e)}keyboardEvent(t,e){this.eventEmitter.emit({event:e,key:t.key})}emitPositionEvent(t,e){const i=this.canvas.getBoundingClientRect();this.eventEmitter.emit({event:e,position:{x:p(t.x-i.left),y:p(t.y-i.top)}})}static getInstance(){return _||(_=new q),_}init(){this.loopStatus=1,requestAnimationFrame(this.loop.bind(this))}loop(t){1===this.loopStatus&&(1===this.loopStatus&&J<=t-this.lastTime&&(this.lastTime=t,this.navigatorRoot.currentScene.render(this.context)),requestAnimationFrame(this.loop.bind(this)))}}q.getInstance().init()})()})();
//# sourceMappingURL=main.js.map