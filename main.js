(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{const e=3/4,i=1024,s=768,n="0",o="8",r="10",h="11";class a{constructor(){this.subscriptions=[],this.open=!0}emit(t={}){for(let e=0;e<this.subscriptions.length;e++)this.callFunction(this.subscriptions[e],t)}async callFunction(t,e){t(e)}pipe(...t){let e=this;for(const i of t){const t=new a;e.on((e=>i(e,t))),e=t}return e}unsub(t){this.subscriptions=this.subscriptions.filter((e=>e!==t))}on(t){this.subscriptions.push(t)}}class y{constructor(e,i=0,s=0,n=0,o=0){this.destroy=new a,this.eventEmitter=e,this.x=i,this.y=s,this.width=n,this.height=o,this.lastMousePosition=null,this.isMouseHover=!1,void 0===t.g.idCount&&(t.g.idCount=0),this.id=t.g.idCount++}set eventEmitter(t){this._eventEmitter=t?t.pipe(function(t){let e=!1;const i=()=>{e=!0,t.unsub(i)};return t.on(i),(t,i)=>{e&&(i.subscriptions=[]),i.emit(t)}}(this.destroy)):t}get eventEmitter(){return this._eventEmitter}render(t){}listenerEvent(t,e){var i;this.eventEmitter.pipe((i=e=>e.event===t,(t,e)=>{i(t)&&e.emit(t)})).on((t=>{(t&&this.validateMouseEventPropagation(t.position,t.event)||this.validateKeyboardEventPropagation(t.event))&&e(t)}))}validateKeyboardEventPropagation(t){return t===r||t===h||"9"===t}validateMouseEventPropagation(t,e){return"5"===e||e===o||"7"===e||"9"===e||(this.isPositionInside(this.lastMousePosition)&&!this.isPositionInside(t)&&this.eventEmitter.emit({event:o}),this.lastMousePosition=t,this.isMouseHover=this.isPositionInside(t))}isPositionInside(t){return t&&t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}}class x extends y{constructor(t,e){super(e),this.navigator=t,this.backgroundColor="#f00",this.elements=[]}render(t){this.cleanCanvas(t);for(const e of this.elements)e.render(t)}cleanCanvas(t){t.rect(0,0,this.width,this.height),t.fillStyle=this.backgroundColor,t.fill()}validateEventPropagation(t,e){const i=super.validateEventPropagation(t,e);if(i)for(const i of this.elements)if(i.validateEventPropagation(t,e))return!1;return i}}function c(t){return Math.atan2(t.y,t.x)}function l(t,e){return{x:t.x+e.x,y:t.y+e.y}}function d(t,e,i){const s=u(t,i);return{x:e.x+s.x,y:e.y-s.y}}function u(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}const p=t=>t*t;function g(t){return t*window.currentWidth/i}function m(t){return t*i/window.currentWidth}function f(t,e=0){return Math.floor(Math.random()*t)+e}function b(t,e){if(t.length<3||e.length<3)return!1;const i=[...k(t),...k(e)];for(const s of i){const i=S(t,s),n=S(e,s);if(!(i.min>n.min&&i.min<n.max||i.max>n.min&&i.max<n.max||n.min>i.min&&n.min<i.max||n.max>i.min&&n.max<i.max||i.min===n.min&&i.max===n.max))return!1}return!0}function v(t){if(0===t.x&&0===t.y)return{x:0,y:0};const e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}}function k(t){if(t.length<=1)return[];const e=[];for(let i=1;i<t.length;i++)e.push({x:t[i].x-t[i-1].x,y:t[i-1].y-t[i].y});return e.push({x:t[0].x-t[t.length-1].x,y:t[t.length-1].y-t[0].y}),e}function S(t,e){let i=w(e,t[0]),s=i;for(let n=1;n<t.length;n++){const o=w(e,t[n]);i=Math.min(i,o),s=Math.max(s,o)}return{min:i,max:s}}function w(t,e){return(e.x*t.x+e.y*t.y)/(t.x*t.x+t.y*t.y)}class E extends y{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.backgroundColor="#00f",this.rotation=0,this.directionVector={x:1,y:0},this.scaleShape=3.3,this.brakedShape=null}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}render(t){const e=this.getProjection();for(const i of e){const e=i.points;if(0!==e.length){t.beginPath(),t.moveTo(g(e[0].x),g(e[0].y));for(let i=1;i<e.length;i++)t.lineTo(g(e[i].x),g(e[i].y));t.closePath(),t.fillStyle=i.background,Boolean(i.stroke)&&(t.stroke(),t.strokeStyle=i.stroke,t.lineWidth=5*i.strokeWidth),t.fill()}}}animate(){this.moveBrakedPiece()}brakeShapes(){const t=this.shipShape().shapes;this.brakedShape={shapes:[]};for(const e of t)this.brakedShape={shapes:[...this.brakedShape.shapes,...this.brakeShape(e)]};for(const t of this.brakedShape.shapes){const e=this.shapeCenter(t.points),i=(Math.random()+.5)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));t.vector={x:e.x*i,y:e.y*i}}}brakeShape(t){if(0===t.points.length)return t.points;const{min:e,max:i}=this.coverBox(t.points),s=[];let n=Math.ceil((i.x-e.x)*(i.y-e.y)/2);n=Math.min(n,150);for(let o=0;o<n;o++){const n={x:(i.x-e.x)*Math.random()+e.x,y:(i.y-e.y)*Math.random()+e.y};s.push({points:new Array(3).fill(null).map((()=>({x:n.x+2.5*Math.random(),y:n.y+2.5*Math.random()}))),background:t.background})}return s}shapeCenter(t){const{min:e,max:i}=this.coverBox(t);return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}coverBox(t){const e={x:t[0].x,y:t[0].y},i={...e};for(let s=1;s<t.length;s++)e.x=Math.min(e.x,t[s].x),e.y=Math.min(e.y,t[s].y),i.x=Math.max(i.x,t[s].x),i.y=Math.max(i.y,t[s].y);return{min:e,max:i}}moveBrakedPiece(){if(this.brakedShape)for(const t of this.brakedShape.shapes)t.points=t.points.map((e=>({x:e.x+t.vector.x,y:e.y+t.vector.y}))),t.background=this.reduceOpacity(t.background,30)}reduceOpacity(t,e){let i=this.getOpacity(t);return i=Math.min(255,Math.max(i-e,0)),i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getColorWithOpacity(t,e){let i=Math.min(255,Math.max(Math.floor(255*e),0));return i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getOpacity(t){return t.length>7?parseInt(t.substr(7,2),16):255}getProjection(t=void 0){const e=c(this.directionVector)+Math.PI/2,i=this.currentShape().shapes,s=this.getPosition(),n=[];for(const o of i){if(t&&o.id!==t)continue;const i=o.points.map((t=>({x:t.x*this.scaleShape,y:t.y*this.scaleShape})));for(let t=0;t<i.length;t++)i[t]=d(i[t],s,e);n.push({...o,points:i})}return n}getPosition(){return{x:this.x,y:this.y}}currentShape(){return{shapes:[]}}}const P=JSON.parse('{"shapes":[{"id":"foot-r","background":"#523e35ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":4.562043795620436,"y":-2.0072992700730055},{"x":3.892944038929425,"y":-5.900243309002441},{"x":5.109489051094872,"y":-7.116788321167892},{"x":7.299270072992698,"y":-7.116788321167892},{"x":8.941605839416084,"y":-6.690997566909989},{"x":9.610705596107024,"y":-5.474452554744541},{"x":9.24574209245744,"y":-3.345498783454996},{"x":8.759124087591225,"y":-1.3381995133820048},{"x":7.907542579075425,"y":2.250608272506067},{"x":5.109489051094872,"y":2.0681265206812505}]},{"id":"foot-l","background":"#523e35ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-4.805352798053512,"y":-2.0072992700730055},{"x":-4.136253041362501,"y":-5.900243309002441},{"x":-5.413625304136236,"y":-7.116788321167892},{"x":-7.542579075425774,"y":-7.116788321167892},{"x":-9.245742092457442,"y":-6.690997566909989},{"x":-9.914841849148385,"y":-5.474452554744541},{"x":-9.549878345498804,"y":-3.345498783454996},{"x":-9.002433090024297,"y":-1.3381995133820048},{"x":-8.211678832116785,"y":2.250608272506067},{"x":-5.352798053527948,"y":2.0681265206812505}]},{"id":"path132294-9","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.5547445255474734,"y":-19.282238442822386},{"x":-3.7712895377129207,"y":-20.74209245742093},{"x":-7.42092457420927,"y":-22.262773722627742},{"x":-13.017031630170294,"y":-22.445255474452555},{"x":-16.970802919708007,"y":-23.96593673965937},{"x":-17.822384428223806,"y":-25},{"x":-17.76155717761559,"y":-23.175182481751825},{"x":-16.60583941605836,"y":-21.411192214111924},{"x":-18.004866180048666,"y":-20.924574209245744},{"x":-16.05839416058392,"y":-20.012165450121657},{"x":-17.274939172749367,"y":-18.734793187347936},{"x":-15.936739659367415,"y":-17.82238442822385},{"x":-16.423357664233567,"y":-16.24087591240876},{"x":-12.22627737226278,"y":-15.81508515815086},{"x":-6.812652068126546,"y":-15.632603406326039},{"x":-2.1897810218978258,"y":-16.24087591240876}]},{"id":"path132294","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.1897810218978258,"y":-19.282238442822386},{"x":3.3454987834549854,"y":-20.74209245742093},{"x":7.0559610705596185,"y":-22.262773722627742},{"x":12.652068126520646,"y":-22.445255474452555},{"x":16.54501216545014,"y":-23.96593673965937},{"x":17.45742092457423,"y":-25},{"x":17.335766423357654,"y":-23.175182481751825},{"x":16.240875912408775,"y":-21.411192214111924},{"x":17.579075425790727,"y":-20.924574209245744},{"x":15.693430656934268,"y":-20.012165450121657},{"x":16.909975669099722,"y":-18.734793187347936},{"x":15.51094890510948,"y":-17.82238442822385},{"x":15.997566909975632,"y":-16.24087591240876},{"x":11.800486618004847,"y":-15.81508515815086},{"x":6.447688564476895,"y":-15.632603406326039},{"x":1.7639902676398869,"y":-16.24087591240876}]},{"id":"path70565","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":3.588807785888058,"y":-18.79562043795621},{"x":2.128953771289538,"y":-19.403892944038933},{"x":-0.3649635036496477,"y":-19.76885644768857},{"x":-2.7980535279805494,"y":-19.403892944038933},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-3.5888077858880614,"y":-18.187347931873482},{"x":-2.372262773722614,"y":-18.79562043795621},{"x":-0.3041362530413636,"y":-18.79562043795621},{"x":1.3990267639902427,"y":-17.944038929440396}]},{"id":"hand-l","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":-20.49878345498785,"y":-5.048661800486631},{"x":-18.856447688564465,"y":-12.104622871046237},{"x":-18.79562043795618,"y":-14.233576642335773},{"x":-18.917274939172753,"y":-16.849148418491488},{"x":-19.221411192214113,"y":-18.187347931873482},{"x":-21.41119221411194,"y":-18.673965936739663},{"x":-22.992700729926966,"y":-17.639902676399032},{"x":-23.600973236009693,"y":-14.111922141119226},{"x":-23.78345498783455,"y":-10.401459854014607},{"x":-23.78345498783455,"y":-7.785888077858889},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"hand-r","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":20.49878345498785,"y":-5.9610705596107145},{"x":18.856447688564465,"y":-13.077858880778596},{"x":18.79562043795618,"y":-15.14598540145986},{"x":18.91727493917275,"y":-17.82238442822385},{"x":19.221411192214113,"y":-19.09975669099757},{"x":21.472019464720155,"y":-19.58637469586375},{"x":22.992700729926966,"y":-18.55231143552312},{"x":23.661800486617977,"y":-15.024330900243314},{"x":23.783454987834553,"y":-11.313868613138695},{"x":23.783454987834553,"y":-8.698296836982976},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":17.396593673965945,"y":-5.231143552311444},{"x":18.004866180048666,"y":2.3114355231143406},{"x":21.046228710462287,"y":3.832116788321155},{"x":22.810218978102178,"y":3.1630170316301545},{"x":24.270072992700705,"y":1.399026763990257},{"x":25,"y":-2.128953771289545},{"x":24.513381995133777,"y":-4.68369829683699},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189-7","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-17.39659367396594,"y":-4.31873479318736},{"x":-18.004866180048666,"y":3.2238442822384314},{"x":-21.046228710462287,"y":4.744525547445242},{"x":-22.810218978102178,"y":4.075425790754238},{"x":-24.2700729927007,"y":2.3114355231143406},{"x":-25,"y":-1.1557177615571916},{"x":-24.513381995133777,"y":-3.771289537712903},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path71384","background":"#7b7959ff","stroke":"#000000","strokeWidth":0.175779,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.90997566909972,"y":-13.321167883211686},{"x":-20.802919708029215,"y":-9.914841849148425},{"x":-21.77615571776152,"y":-6.690997566909989},{"x":-19.951338199513344,"y":4.562043795620426},{"x":-14.233576642335745,"y":8.515815085158138},{"x":-3.163017031630197,"y":11.800486618004847},{"x":6.5085158150851825,"y":11.43552311435522},{"x":15.024330900243328,"y":7.968369829683681},{"x":19.464720194647192,"y":4.379562043795605},{"x":21.59367396593673,"y":-6.447688564476898},{"x":19.951338199513344,"y":-11.009732360097333},{"x":16.42335766423357,"y":-13.38199513381996},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path71384-1","background":"#7b7959ff","stroke":"#000000","strokeWidth":0.160998,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.301703163016995,"y":-11.131386861313878},{"x":-18.673965936739677,"y":-8.819951338199523},{"x":-20.37712895377128,"y":-6.204379562043805},{"x":-18.61313868613139,"y":3.892944038929425},{"x":-13.321167883211658,"y":7.420924574209224},{"x":-2.9805352798053377,"y":10.340632603406313},{"x":6.082725060827247,"y":10.097323600973219},{"x":14.05109489051096,"y":6.934306569343047},{"x":18.187347931873454,"y":3.710462287104612},{"x":20.133819951338197,"y":-6.0218978102189915},{"x":17.94403892944038,"y":-9.610705596107064},{"x":15.328467153284691,"y":-11.982968369829688},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path65968-1","background":"#ba6560ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-16.24087591240878,"y":3.2238442822384314},{"x":-18.61313868613139,"y":2.3114355231143406},{"x":-19.951338199513344,"y":-7.105427357601002e-15},{"x":-19.82968369829684,"y":-3.2238442822384563},{"x":-18.004866180048666,"y":-5.231143552311444},{"x":-14.598540145985393,"y":-5.6569343065693545},{"x":-14.781021897810183,"y":3.4063260340632446}]},{"id":"path65968","background":"#ba6560ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":15.632603406326048,"y":3.2238442822384314},{"x":18.004866180048666,"y":2.3114355231143406},{"x":19.282238442822404,"y":-7.105427357601002e-15},{"x":19.221411192214113,"y":-3.2238442822384563},{"x":17.396593673965945,"y":-5.231143552311444},{"x":13.929440389294385,"y":-5.6569343065693545},{"x":14.172749391727457,"y":3.4063260340632446}]},{"id":"path63330-3","background":"#ab5552ff","stroke":"#000000","strokeWidth":0.100969,"points":[{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":6.326034063260323,"y":-19.221411192214116},{"x":10.462287104622888,"y":-17.639902676399032},{"x":12.226277372262778,"y":-15.328467153284675},{"x":12.591240875912426,"y":-11.982968369829688},{"x":11.070559610705615,"y":-8.51581508515816},{"x":6.630170316301687,"y":-6.630170316301715},{"x":3.1021897810219095,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171},{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":-6.630170316301687,"y":-19.221411192214116},{"x":-10.766423357664257,"y":-17.639902676399032},{"x":-12.530413625304144,"y":-15.328467153284675},{"x":-12.895377128953792,"y":-11.982968369829688},{"x":-11.435523114355197,"y":-8.51581508515816},{"x":-6.93430656934305,"y":-6.630170316301715},{"x":-3.406326034063273,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171}]},{"id":"path70563-6","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-12.895377128953792,"y":-18.24817518248176},{"x":-12.77372262773722,"y":-16.605839416058398},{"x":-3.5888077858880614,"y":-17.457420924574212},{"x":-3.7104622871046367,"y":-18.917274939172756}]},{"id":"path70563","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":12.530413625304142,"y":-18.3698296836983},{"x":12.469586374695858,"y":-16.727493917274945},{"x":3.2238442822384137,"y":-17.396593673965945},{"x":3.3454987834549854,"y":-18.917274939172756}]},{"id":"path66083","background":"#c56057ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-3.2238442822384137,"y":-14.841849148418497},{"x":-4.501216545012149,"y":-16.90997566909976},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-2.7980535279805494,"y":-20.012165450121657},{"x":-2.493917274939186,"y":-21.411192214111924},{"x":-1.520681265206811,"y":-22.019464720194648},{"x":-0.3041362530413636,"y":-22.08029197080292},{"x":0.9124087591240908,"y":-22.019464720194648},{"x":1.8856447688564586,"y":-21.411192214111924},{"x":2.128953771289538,"y":-20.012165450121657},{"x":3.588807785888058,"y":-18.79562043795621},{"x":3.8321167883211373,"y":-16.90997566909976},{"x":2.55474452554747,"y":-14.841849148418497},{"x":-0.3041362530413636,"y":-14.598540145985409}]},{"id":"path119374","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.55474452554747,"y":-16.849148418491488},{"x":3.8321167883211373,"y":-18.430656934306572},{"x":7.116788321167903,"y":-18.30900243309003},{"x":9.732360097323593,"y":-18.065693430656935},{"x":10.827250608272472,"y":-18.430656934306572},{"x":9.732360097323593,"y":-17.03163017031631},{"x":6.934306569343047,"y":-16.66666666666667}]},{"id":"path119374-2","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.91970802919705,"y":-16.727493917274945},{"x":-4.257907542579073,"y":-18.3698296836983},{"x":-7.542579075425774,"y":-18.24817518248176},{"x":-10.15815085158153,"y":-18.004866180048666},{"x":-11.253041362530409,"y":-18.3698296836983},{"x":-10.15815085158153,"y":-16.970802919708035},{"x":-7.360097323600982,"y":-16.605839416058398}]},{"id":"path63330","background":"#ab5552ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":8.39416058394157,"y":-16.66666666666667},{"x":13.80778588807788,"y":-13.503649635036503},{"x":16.18004866180049,"y":-8.819951338199523},{"x":16.60583941605836,"y":-2.0681265206812753},{"x":14.65936739659368,"y":5.048661800486602},{"x":8.759124087591225,"y":8.880778588807772},{"x":4.1362530413625045,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113},{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":-8.637469586374717,"y":-16.66666666666667},{"x":-14.111922141119242,"y":-13.503649635036503},{"x":-16.423357664233567,"y":-8.819951338199523},{"x":-16.849148418491502,"y":-2.0681265206812753},{"x":-14.902676399026756,"y":5.048661800486602},{"x":-9.002433090024297,"y":8.880778588807772},{"x":-4.440389294403861,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113}]},{"id":"path132989","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-15.51094890510948,"y":-9.367396593673973},{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-3.5279805352797773,"y":-16.484184914841855},{"x":3.2846715328467013,"y":-16.484184914841855},{"x":9.24574209245744,"y":-14.781021897810225},{"x":14.963503649635044,"y":-9.063260340632612},{"x":16.484184914841855,"y":-2.6763990267640025},{"x":15.632603406326048,"y":2.433090024330891},{"x":12.591240875912426,"y":10.03649635036495},{"x":10.827250608272472,"y":14.051094890510932},{"x":9.48905109489052,"y":10.94890510948904},{"x":8.69829683698294,"y":12.652068126520668},{"x":7.968369829683709,"y":14.111922141119202},{"x":7.360097323600982,"y":15.571776155717743},{"x":5.9610705596106754,"y":13.564476885644751},{"x":5.352798053527952,"y":10.5839416058394},{"x":3.8321167883211373,"y":12.165450121654487},{"x":1.9464720194647462,"y":15.936739659367369},{"x":-0.9124087591240873,"y":10.827250608272486},{"x":-1.4598540145985233,"y":13.442822384428204},{"x":-2.372262773722614,"y":16.1192214111922},{"x":-4.379562043795644,"y":14.659367396593652},{"x":-4.683698296837008,"y":12.591240875912384},{"x":-5.47445255474452,"y":9.610705596107039},{"x":-6.386861313868611,"y":12.773722627737207},{"x":-7.603406326034058,"y":15.81508515815083},{"x":-8.698296836982937,"y":12.591240875912384},{"x":-9.245742092457442,"y":9.245742092457398},{"x":-9.914841849148385,"y":11.253041362530396},{"x":-11.800486618004847,"y":15.145985401459832},{"x":-12.469586374695856,"y":11.6788321167883},{"x":-14.29440389294403,"y":7.968369829683681},{"x":-16.90997566909972,"y":-2.128953771289545}]}]}');function M(t,e=void 0,n=void 0,o=void 0,r=void 0){e=e||f(i),n=n||f(s);const h=o||f(40,10),a=r||f(40,10);return new C(t,e,n,h,a)}class C extends E{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.scaleShape=0,this.lifeTime=0}render(t){this.calculateScale(),this.lifeTime++,t.beginPath(),t.fillStyle=this.getColorWithOpacity("#6c8d8eff",this.showAndHideFunction(this.getTimeFactor())),this.scaleShape=this.growBubbleFunction(this.getTimeFactor());const e=this.width*this.scaleShape,i=this.height*this.scaleShape;t.ellipse(this.x,this.y,e,i,0,0,2*Math.PI),t.fill()}calculateScale(){this.scaleShape=Math.sin(this.y/10)}getTimeFactor(){return Math.min(this.lifeTime/20,1)}showAndHideFunction(t){return Math.sin(t*Math.PI)/4}growBubbleFunction(t){return 1.4426950408889634*Math.log(t+1)}bubbleDead(){return this.lifeTime>20}}class I extends E{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.rotation=Math.PI/2,this.directionVector={x:0,y:1};this.scaleShape=.015578125*this.width,this.shape={...P},this.time=(new Date).getTime(),this.animation=0,this.animationIsOn=!1,this.bubblesIntervalToShow=3,this.bubblesCount=0,this.bubbles=[],this.updateCoordinates()}render(t){this.bubbles=this.bubbles.filter((t=>!t.bubbleDead())),this.bubbles.forEach((e=>e.render(t))),super.render(t)}updateCoordinates({x:t,y:e}={}){this.x=t||this.x,this.y=e||this.y}updateDirectionVector(t){this.directionVector=t}animate(){1&this.animation?(this.animationIsOn||(this.time=(new Date).getTime()),this.animationIsOn=!0,this.animateWalk()):this.animationIsOn&&(this.animationIsOn=!1,this.shape={...P})}animateWalk(){const t=-20*this.stepAnimationFunction(),e=this.handAnimationFunction();let i={x:1e3,y:1e3},s={x:-1e3,y:-1e3};this.shape.shapes.forEach((t=>t.points.forEach((t=>{i.y=Math.min(i.y,t.y),i.x=Math.min(i.x,t.x),s.y=Math.max(s.y,t.y),s.x=Math.max(s.x,t.x)}))));this.shape.shapes=P.shapes.map((i=>{if(i.id.startsWith("foot")){const e=i.id.endsWith("-l")?t:-t;return{...i,points:i.points.map((t=>({...t,y:t.y+e})))}}if(i.id.startsWith("hand")){const t=i.id.endsWith("-l")?1:-1;return{...i,points:i.points.map((i=>({...i,y:(i.y- -2)*e*t-2})))}}return{...i}})),0===this.bubblesCount&&this.newBubble(),this.bubblesCount++,this.bubblesCount>=this.bubblesIntervalToShow&&(this.bubblesCount=0)}newBubble(){const t=M(this.eventEmitter,this.x,this.y,50,50);t.lifeTime=5,this.bubbles.push(t)}stepAnimationFunction(){const t=((new Date).getTime()-this.time)/500;return Math.sin(t*Math.PI)}handAnimationFunction(){const t=((new Date).getTime()-this.time)/500;return Math.cos(t*Math.PI)}currentShape(){return this.brakedShape||this.shape}}class W extends y{constructor(t,e,i){super(t,e,i),this.level=0,this.textSize=20,this.backgroundColor="#000",this.textColor="#fff",this.lastTime=0}render(t){t.font=`${g(this.textSize)}px Arial`;const e=`LEVEL ${this.level}`,i=t.measureText(e),s=i.width,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;t.beginPath(),t.rect(g(this.x-s-10),g(this.y),g(s+10),g(n+10)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${g(this.textSize)}px Arial`,t.fillStyle=this.textColor,t.fillText(e,g(this.x-s-5),g(this.y+n+5))}}class A extends y{constructor(t,e,i,s,n,r){super(t,e,i,s,n),this.text=r,this.textSize=10,this.backgroundColor="#000",this.textColor="#fff",this.textColorHover="#9a9a9a",this.listenerEvent("3",(t=>{this.isPositionInside(t.position)&&(document.body.style.cursor="pointer")})),this.listenerEvent(o,(t=>{document.body.style.cursor="default"}))}render(t){t.beginPath(),t.rect(g(this.x),g(this.y),g(this.width),g(this.height)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${g(this.textSize)}px Arial`;const e=t.measureText(this.text),i=m(e.width),s=m(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle=this.isMouseHover?this.textColorHover:this.textColor,t.fillText(this.text,g(this.x+this.width/2-i/2),g(this.y+this.height/2+s/2))}}class T extends y{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.textSize=90,this.text2Size=30,this.text="FEAR THE WATER",this.score=1e3;const o=15;this.createCredits(this.x+o,this.y,70,30),this.createPlayButton(this.x+(this.width-70-120-o)/2,this.y+this.height-30-o,70,30),this.createShareButton(this.x+(this.width-70-120-o)/2+70+o,this.y+this.height-30-o,120,30)}createPlayButton(t,e,i,s){this.buttonPlay=new A(this.eventEmitter,t,e,i,s,"CONTINUE")}createCredits(t,e,i,s){this.buttonCredits=new A(this.eventEmitter,t,e,i,s,"@ggjnez92"),this.buttonCredits.backgroundColor="#00000000",this.buttonCredits.textColor="#000",this.buttonCredits.textColorHover="#0048ff",this.buttonCredits.listenerEvent(n,(()=>window.open("https://twitter.com/ggjnez92","_blank").focus()))}createShareButton(t,e,i,s){this.buttonShareRecord=new A(this.eventEmitter,t,e,i,s,"SHARE ON TWITTER"),this.buttonShareRecord.listenerEvent(n,(()=>{window.open("https://twitter.com/intent/tweet?text=I'm%20currently%20playing%20the%20game%20FEAR%20THE%20WATER%20developed%20for%20the%20%23gamedevjs%20jam.%0A%0A%23gamedev%0A%0AIf%20you%20want%20to%20check%20it%20out%2C%20here%20is%20the%20link%20to%20the%20%23github%20repository%0Ahttps%3A%2F%2Finflagames.github.io%2Ffear-the-water%2F","_blank").focus()}))}render(t){t.beginPath(),t.rect(0,0,g(i),g(s)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(g(this.x),g(this.y),g(this.width),g(this.height)),t.fillStyle=this.backgroundColor,t.fill(),this.buttonPlay.render(t),this.buttonCredits.render(t),this.buttonShareRecord.render(t),this.renderScore(t)}renderScore(t){t.beginPath(),t.font=`${g(this.text2Size)}px Arial`;const e=t.measureText(this.text),i=m(e.width);m(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle="#000",t.fillText(this.text,g(this.x+this.width/2-i/2),g(this.y+this.height/2))}}const z="azetzv1_game_score";let B=null;class D{static getInstance(){return B||(B=new D),B}saveScore(t){localStorage.setItem(z,t+"")}getScore(){const t=localStorage.getItem(z);return t?+t:0}}const K={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return K.Android()||K.BlackBerry()||K.iOS()||K.Opera()||K.Windows()}};class R{constructor(){this.presedKeys=[]}clear(){this.presedKeys=[]}addKey(t){this.isDirectionKey(t)&&!this.presedKeys.includes(t)&&this.presedKeys.push(t)}removeKey(t){this.presedKeys=this.presedKeys.filter((e=>e!==t))}isDirectionKey(t){return"a"===t||"w"===t||"s"===t||"d"===t}hasPressedKeys(){return this.presedKeys.length>0}directionVector(){let t={x:0,y:0};const e=this.direction();return 1&e?t.y=-1:2&e&&(t.y=1),4&e?t.x=-1:8&e&&(t.x=1),v(t)}direction(){let t=0;if(this.presedKeys.length>0){t=this.directionMap(this.presedKeys[0]);let e=1;for(;e<this.presedKeys.length;){let i=this.consumeNextDirection(1,4,8,t,this.directionMap(this.presedKeys[e]));if(i|=this.consumeNextDirection(2,4,8,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(4,1,2,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(8,1,2,t,this.directionMap(this.presedKeys[e])),i){t|=i;break}e++}}return t}consumeNextDirection(t,e,i,s,n){return t!==s||n!==e&&n!==i?0:n}directionMap(t){return"w"===t?1:"s"===t?2:"a"===t?4:"d"===t?8:0}}const V=JSON.parse('{"shapes":[{"id":"path40916-9-3","background":"#b85c54ff","stroke":"#000000","strokeWidth":0.115301,"points":[{"x":-25,"y":-0.9528130671506325},{"x":-25,"y":-23.729582577132486},{"x":-24.092558983666063,"y":-25},{"x":-11.388384754990923,"y":-25},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-11.388384754990923,"y":0.04537205081669882},{"x":-24.092558983666063,"y":0.04537205081669882}]},{"id":"path40916","background":"#c56057ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-24.909255898366606,"y":24.09255898366606},{"x":-24.909255898366606,"y":1.3157894736842088},{"x":-24.001814882032665,"y":0.04537205081669882},{"x":-1.0435571687840195,"y":0.04537205081669882},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-1.1343012704174242,"y":25},{"x":-24.274047186932844,"y":25}]},{"id":"path40916-9","background":"#be7063ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":0.6805807622504538,"y":0.04537205081669882},{"x":23.638838475499107,"y":0.04537205081669882},{"x":24.63702359346643,"y":1.3157894736842088},{"x":24.63702359346643,"y":24.09255898366606},{"x":23.548094373865702,"y":25},{"x":0.4083484573502787,"y":25}]},{"id":"path40916-9-7","background":"#c55f56ff","stroke":"#000000","strokeWidth":0.178584,"points":[{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-9.210526315789465,"y":-25},{"x":23.729582577132497,"y":-25},{"x":24.63702359346643,"y":-23.729582577132486},{"x":24.63702359346643,"y":-0.9528130671506325},{"x":23.638838475499107,"y":0.04537205081669882},{"x":-9.210526315789465,"y":0.04537205081669882}]}]}'),G=JSON.parse('{"shapes":[{"id":"path40916-0","background":"#c56057ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-25,"y":23.0072463768116},{"x":-25,"y":-22.463768115942017},{"x":-23.18840579710145,"y":-25},{"x":22.64492753623189,"y":-25},{"x":24.275362318840592,"y":-22.463768115942017},{"x":24.275362318840592,"y":23.0072463768116},{"x":22.463768115942045,"y":25},{"x":-23.73188405797101,"y":25}]}]}'),O=JSON.parse('{"shapes":[{"id":"path40916-9-3-3","background":"#b85c54ff","stroke":"#000000","strokeWidth":0.057048,"points":[{"x":-25,"y":-0.636363636363626},{"x":-25,"y":-23.181818181818183},{"x":-23.727272727272723,"y":-24.818181818181802},{"x":-11.181818181818178,"y":-25},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-10.090909090909086,"y":-0.636363636363626},{"x":-11.181818181818178,"y":0.27272727272728403},{"x":-23.727272727272723,"y":0.27272727272728403}]},{"id":"path40916-6","background":"#c56057ff","stroke":"#000000","strokeWidth":0.0874443,"points":[{"x":-25,"y":24.090909090909093},{"x":-25,"y":1.5454545454545325},{"x":-23.181818181818183,"y":0.27272727272728403},{"x":8.636363636363647,"y":0.27272727272728403},{"x":9.727272727272727,"y":1.5454545454545325},{"x":9.727272727272727,"y":24.090909090909093},{"x":8.454545454545453,"y":25},{"x":-23.727272727272723,"y":25}]},{"id":"path40916-9-1","background":"#be7063ff","stroke":"#000000","strokeWidth":0.0739228,"points":[{"x":9.727272727272727,"y":24.090909090909093},{"x":9.727272727272727,"y":1.5454545454545325},{"x":10.63636363636364,"y":0.27272727272728403},{"x":23.545454545454533,"y":0.27272727272728403},{"x":24.636363636363647,"y":1.5454545454545325},{"x":24.636363636363647,"y":24.090909090909093},{"x":23.545454545454533,"y":25},{"x":10.272727272727273,"y":25}]},{"id":"path40916-9-7-0","background":"#c55f56ff","stroke":"#000000","strokeWidth":0.0883588,"points":[{"x":-10.090909090909086,"y":-0.8181818181817988},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-8.999999999999993,"y":-24.818181818181802},{"x":23.727272727272734,"y":-24.818181818181802},{"x":24.636363636363647,"y":-23.363636363636353},{"x":24.636363636363647,"y":-0.8181818181817988},{"x":23.545454545454533,"y":0.27272727272728403},{"x":-8.999999999999993,"y":0.27272727272728403}]}]}'),L=["#b85c54","#c56057","#be7063","#c55f56"];class F extends E{constructor(t,e=0,i=0,s,n){super(t,e,i,s*n,s*n),this.directionVector=this.getRotation(),this.gridSize=n,this.type=s,this.tileShape={...this.getShape(s)},this.positionCorrection={x:0,y:0},this.setupTile()}getShape(t){switch(t){case 1:return G;case 2:return V;default:return O}}getRotation(){switch(f(4)){case 0:return{x:1,y:0};case 1:return{x:0,y:1};case 2:return{x:-1,y:0};case 3:return{x:0,y:-1}}}setupTile(){let t={...this.tileShape.shapes[0].points[0]},e={...this.tileShape.shapes[0].points[0]};for(let i of this.tileShape.shapes)for(let s of i.points)s.x<t.x&&(t.x=s.x),s.y<t.y&&(t.y=s.y),s.x>e.x&&(e.x=s.x),s.y>e.y&&(e.y=s.y);const i=this.gridSize*this.getGridSize()/((e.x-t.x)*this.scaleShape),s=this.gridSize*this.getGridSize()/((e.y-t.y)*this.scaleShape);this.positionCorrection={x:this.gridSize*this.getGridSize()*.5,y:this.gridSize*this.getGridSize()*.5},this.tileShape.shapes=this.tileShape.shapes.map((t=>({...t,background:L[f(L.length)],points:t.points.map((t=>({x:t.x*i,y:t.y*s})))})))}getGridSize(){switch(this.type){case 1:case 3:return 1;case 2:return 2}}getPosition(){return l(super.getPosition(),this.positionCorrection)}currentShape(){return this.tileShape}animate(){}}const N=JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,0,0,2,1],[1,1,0,0,0,0,1,0,1,0,0,1],[1,0,0,0,0,0,1,0,0,1,0,1],[1,0,0,0,1,1,1,0,1,1,0,1],[1,0,0,0,5,1,0,0,1,1,0,1],[1,0,8,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":0}]}'),j=JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,0,1,1,0,0,2,0,0,0,0,1],[1,1,0,0,0,0,1,0,1,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],[1,0,0,0,1,1,1,0,1,1,0,0,0,0,0,1],[1,0,4,0,1,5,0,0,1,1,0,0,0,0,0,1],[1,0,8,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,5],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":-0.5}]}'),H=JSON.parse('{"shapes":[{"id":"center","background":"#352835ff","points":[{"x":-15.52132701421802,"y":-17.417061611374375},{"x":-20.73459715639808,"y":-2.7251184834123343},{"x":-5.5687203791468995,"y":9.360189573459678},{"x":8.412322274881468,"y":1.777251184834121},{"x":8.175355450236935,"y":-12.440758293838849},{"x":-3.9099526066350805,"y":-21.208530805687154}]},{"id":"path187494","background":"#4e3b43ff","points":[{"x":-25,"y":-5.805687203791436},{"x":-23.578199052132682,"y":-11.018957345971566},{"x":-21.445497630331758,"y":-15.758293838862555},{"x":-17.890995260663516,"y":-20.260663507109008},{"x":-12.914691943127956,"y":-23.341232227488113},{"x":-5.094786729857827,"y":-25},{"x":2.4881516587677304,"y":-23.104265402843577},{"x":7.4644549763033226,"y":-19.075829383886262},{"x":11.96682464454971,"y":-11.966824644549778},{"x":12.440758293838847,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-9.834123222748817},{"x":0.5924170616113713,"y":-12.677725118483385},{"x":-2.4881516587677943,"y":-14.573459715639808},{"x":-7.701421800947859,"y":-14.810426540284343},{"x":-11.966824644549778,"y":-12.440758293838849},{"x":-14.810426540284343,"y":-8.175355450236932},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path187494-6","background":"#4e3b43ff","points":[{"x":-25,"y":-6.516587677725109},{"x":-23.578199052132682,"y":-0.3554502369668384},{"x":-21.445497630331758,"y":4.383886255924153},{"x":-17.890995260663516,"y":8.886255924170605},{"x":-12.914691943127956,"y":11.966824644549781},{"x":-5.094786729857827,"y":13.625592417061597},{"x":2.4881516587677304,"y":11.729857819905178},{"x":7.4644549763033226,"y":7.7014218009478626},{"x":11.96682464454971,"y":0.5924170616113713},{"x":12.440758293838847,"y":-6.516587677725109},{"x":2.7251184834123308,"y":-6.516587677725109},{"x":2.251184834123194,"y":-1.5402843601895881},{"x":0.5924170616113713,"y":1.3033175355450517},{"x":-2.4881516587677943,"y":3.199052132701407},{"x":-7.701421800947859,"y":3.4360189573459436},{"x":-11.966824644549778,"y":1.0663507109004442},{"x":-14.810426540284343,"y":-3.1990521327014037},{"x":-15.28436018957345,"y":-6.516587677725109}]},{"id":"path188158","background":"#1f1720ff","points":[{"x":-17.417061611374407,"y":-5.805687203791436},{"x":-16.943127962085303,"y":-9.36018957345968},{"x":-13.38862559241706,"y":-14.09952606635067},{"x":-7.701421800947859,"y":-17.417061611374375},{"x":-2.0142180094786575,"y":-16.943127962085303},{"x":2.7251184834123308,"y":-14.09952606635067},{"x":4.857819905213223,"y":-10.071090047393355},{"x":5.331753554502367,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-9.834123222748817},{"x":0.5924170616113713,"y":-12.677725118483385},{"x":-2.4881516587677943,"y":-14.573459715639808},{"x":-7.701421800947859,"y":-14.810426540284343},{"x":-11.966824644549778,"y":-12.440758293838849},{"x":-14.810426540284343,"y":-8.175355450236932},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path188158-3","background":"#1f1720ff","points":[{"x":-17.417061611374407,"y":-5.805687203791436},{"x":-16.943127962085303,"y":-2.0142180094786575},{"x":-13.38862559241706,"y":2.7251184834123308},{"x":-7.701421800947859,"y":5.805687203791436},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":2.7251184834123308,"y":2.7251184834123308},{"x":4.857819905213223,"y":-1.3033175355450481},{"x":5.331753554502367,"y":-5.805687203791436},{"x":2.7251184834123308,"y":-5.805687203791436},{"x":2.251184834123194,"y":-1.5402843601895881},{"x":0.5924170616113713,"y":1.3033175355450517},{"x":-2.4881516587677943,"y":3.199052132701407},{"x":-7.701421800947859,"y":3.4360189573459436},{"x":-11.966824644549778,"y":1.0663507109004442},{"x":-14.810426540284343,"y":-3.1990521327014037},{"x":-15.28436018957345,"y":-5.805687203791436}]},{"id":"path194589","background":"#697083dc","points":[{"x":-10.781990521327028,"y":2.962085308056867},{"x":-13.151658767772524,"y":4.85781990521329},{"x":-12.203791469194314,"y":6.753554502369646},{"x":-11.966824644549778,"y":12.677725118483387},{"x":-11.492890995260671,"y":20.73459715639808},{"x":-10.071090047393355,"y":22.15639810426537},{"x":-9.597156398104282,"y":13.862559241706137},{"x":-8.649289099526069,"y":14.573459715639807},{"x":-7.938388625592395,"y":25},{"x":-5.094786729857827,"y":24.526066350710863},{"x":-4.857819905213294,"y":18.127962085308056},{"x":-3.9099526066350805,"y":15.995260663507096},{"x":-2.4881516587677943,"y":23.578199052132646},{"x":-1.3033175355450481,"y":22.393364928909904},{"x":-2.0142180094786575,"y":15.04739336492888},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":-0.11848341232230197,"y":4.146919431279617},{"x":-0.3554502369668384,"y":2.4881516587677943},{"x":1.3033175355449842,"y":0.8293838862559078},{"x":0.3554502369668384,"y":-1.5402843601895881},{"x":-4.620853080568757,"y":0.11848341232230197},{"x":-10.308056872037923,"y":1.0663507109004442}]},{"id":"path202169","background":"#697083ff","points":[{"x":-10.781990521327028,"y":2.962085308056867},{"x":-11.018957345971566,"y":6.04265402843604},{"x":-2.0142180094786575,"y":5.568720379146903},{"x":-0.3554502369668384,"y":2.4881516587677943}]}]}');class $ extends E{constructor(t,e=0,i=0){super(t,e,i,0,0),this.directionVector={x:0,y:1},this.shape={...H},this.scaleShape=1.7}getPosition(){return{x:this.x-8,y:this.y+10}}currentShape(){return this.shape}}const J=JSON.parse('{"shapes":[{"id":"path261160","background":"#c5605700","points":[{"x":-24.818840579710155,"y":-25},{"x":24.637681159420282,"y":-24.818840579710155},{"x":24.637681159420282,"y":24.818840579710155},{"x":-25,"y":25}]},{"id":"path209313-1","background":"#99999957","points":[{"x":-8.69565217391304,"y":-20.289855072463777},{"x":-15.036231884057969,"y":-14.492753623188435},{"x":-18.478260869565226,"y":-6.884057971014489},{"x":-18.478260869565226,"y":6.884057971014489},{"x":-15.036231884057969,"y":15.217391304347814},{"x":-8.333333333333325,"y":20.652173913043463},{"x":-0.18115942028984477,"y":22.826086956521756},{"x":7.971014492753639,"y":20.652173913043463},{"x":14.673913043478251,"y":15.217391304347814},{"x":18.115942028985508,"y":6.884057971014489},{"x":18.115942028985508,"y":-6.884057971014489},{"x":14.673913043478251,"y":-14.492753623188435},{"x":8.333333333333329,"y":-20.289855072463777},{"x":-0.18115942028984477,"y":-22.82608695652176}]},{"id":"path209313","background":"#e3e1d6ff","points":[{"x":-6.521739130434774,"y":-16.48550724637683},{"x":-11.231884057971023,"y":-11.775362318840607},{"x":-13.76811594202898,"y":-5.434782608695681},{"x":-13.586956521739134,"y":5.79710144927537},{"x":-11.05072463768115,"y":12.499999999999986},{"x":-6.159420289855085,"y":17.02898550724636},{"x":-0.18115942028984477,"y":18.840579710144915},{"x":5.79710144927537,"y":17.02898550724636},{"x":10.869565217391312,"y":12.499999999999986},{"x":13.224637681159443,"y":5.79710144927537},{"x":13.405797101449288,"y":-5.434782608695681},{"x":10.869565217391312,"y":-11.775362318840607},{"x":6.159420289855085,"y":-16.48550724637683},{"x":-0.18115942028984477,"y":-18.478260869565226}]},{"id":"path214972-2","background":"#fab8aeff","points":[{"x":-5.434782608695656,"y":17.391304347826107},{"x":-8.876811594202909,"y":14.311594202898533},{"x":-10.326086956521745,"y":9.420289855072475},{"x":-8.876811594202909,"y":3.8043478260869747},{"x":-5.434782608695656,"y":0.1811594202898732},{"x":-0.18115942028984477,"y":-1.6304347826086811},{"x":5.072463768115938,"y":0.1811594202898732},{"x":8.514492753623195,"y":3.8043478260869747},{"x":9.963768115942031,"y":9.420289855072475},{"x":8.514492753623195,"y":14.311594202898533},{"x":5.072463768115938,"y":17.391304347826107},{"x":-0.18115942028984477,"y":18.840579710144915}]},{"id":"path214972","background":"#1f1d1dff","points":[{"x":-5.253623188405811,"y":17.391304347826107},{"x":-8.514492753623195,"y":14.492753623188378},{"x":-9.963768115942031,"y":9.782608695652165},{"x":-8.514492753623195,"y":4.347826086956509},{"x":-5.253623188405811,"y":0.9057971014492523},{"x":-0.18115942028984477,"y":-0.724637681159404},{"x":4.891304347826093,"y":0.9057971014492523},{"x":8.152173913043484,"y":4.347826086956509},{"x":9.60144927536232,"y":9.782608695652165},{"x":8.152173913043484,"y":14.492753623188378},{"x":4.891304347826093,"y":17.391304347826107},{"x":-0.18115942028984477,"y":18.840579710144915}]},{"id":"path232338","background":"#fab8aeff","points":[{"x":-4.347826086956534,"y":3.4420289855072355},{"x":-7.789855072463762,"y":4.891304347826093},{"x":-8.876811594202909,"y":3.9855072463768195},{"x":-6.702898550724644,"y":1.6304347826086811},{"x":-4.7101449275362235,"y":0.5434782608695627},{"x":-2.3550724637681135,"y":-0.3623188405797144},{"x":-0.18115942028984477,"y":-0.724637681159404},{"x":2.173913043478265,"y":-0.3623188405797144},{"x":4.347826086956534,"y":0.5434782608695627},{"x":6.3405797101449295,"y":1.6304347826086811},{"x":8.514492753623195,"y":3.9855072463768195},{"x":7.427536231884048,"y":4.891304347826093},{"x":3.9855072463768195,"y":3.4420289855072355},{"x":-0.18115942028984477,"y":2.898550724637701}]},{"id":"path232948","background":"#fab8aeff","points":[{"x":-2.536231884057983,"y":10.326086956521749},{"x":-3.4420289855072568,"y":12.499999999999986},{"x":-2.536231884057983,"y":14.492753623188378},{"x":-0.18115942028984477,"y":15.398550724637659},{"x":2.35507246376811,"y":14.492753623188378},{"x":3.079710144927546,"y":12.499999999999986},{"x":2.35507246376811,"y":10.326086956521749},{"x":-0.18115942028984477,"y":9.23913043478263}]},{"id":"path232948-0","background":"#252938ff","points":[{"x":-2.536231884057983,"y":10.688405797101439},{"x":-3.260869565217387,"y":12.499999999999986},{"x":-2.536231884057983,"y":14.311594202898533},{"x":-0.18115942028984477,"y":15.036231884057969},{"x":2.173913043478265,"y":14.311594202898533},{"x":2.8985507246376727,"y":12.499999999999986},{"x":2.173913043478265,"y":10.688405797101439},{"x":-0.18115942028984477,"y":9.60144927536232}]},{"id":"path232948-0-6","background":"#08070dff","points":[{"x":-1.2681159420289916,"y":11.594202898550712},{"x":-1.630434782608706,"y":12.499999999999986},{"x":-1.2681159420289916,"y":13.224637681159415},{"x":-0.18115942028984477,"y":13.586956521739104},{"x":0.9057971014492736,"y":13.224637681159415},{"x":1.2681159420289916,"y":12.499999999999986},{"x":0.9057971014492736,"y":11.594202898550712},{"x":-0.18115942028984477,"y":11.050724637681178}]}]}');class _ extends E{constructor(t,e=0,i=0,s,n,o,r,h=1){super(t,e,i,s,s),this.baseDirection=u({x:0,y:1},Math.PI*r),this.directionVector={x:0,y:1},this.shape={...J},this.distance=n;const a={...this.shape.shapes[0].points[0]},y={...this.shape.shapes[0].points[0]};this.shape.shapes.forEach((t=>t.points.forEach((t=>{a.x=Math.min(a.x,t.x),a.y=Math.min(a.y,t.y),y.x=Math.max(y.x,t.x),y.y=Math.max(y.y,t.y)})))),this.scaleShape=s/Math.max(y.x-a.x,y.y-a.y),this.maxRotation=Math.PI*h,this.initialTime=(new Date).getTime(),this.viewAngle=o,this.sawPlayer=!1}animate(){const t=(this.initialTime-(new Date).getTime())/1e3,e=Math.sin(t);this.directionVector=u(this.baseDirection,e*this.maxRotation*.5)}render(t){t.beginPath();const e=this.currentViewAngle();t.moveTo(this.x,this.y),t.arc(this.x,this.y,this.width*this.distance,e,e+Math.PI/this.viewAngle,!1),t.fillStyle=this.getVisionColor(),t.fill(),super.render(t)}getVisionColor(){return this.sawPlayer?"rgba(255, 0, 0, 0.1)":"rgba(0, 255, 0, 0.1)"}seeAnyPoint(t){for(const e of t)for(const t of e.points)if(this.seePoint(t))return!0;return!1}seePoint(t){if(e=t,i={x:this.x,y:this.y},p(i.x-e.x)+p(i.y-e.y)<=p(this.width*this.distance)){const e=c(function(t,e){return{x:e.x-t.x,y:e.y-t.y}}({x:this.x,y:this.y},t)),i=Math.PI/(2*this.viewAngle),s=this.currentViewAngle()+i;return Math.abs(e-s)<i||Math.abs(e-s+2*Math.PI)<i}var e,i;return!1}toDegree(t){return 180*t/Math.PI}currentViewAngle(){return c({x:-this.directionVector.x,y:this.directionVector.y})-Math.PI/(2*this.viewAngle)}getPosition(){return{x:this.x,y:this.y}}currentShape(){return this.shape}}class q extends y{constructor(t,e=0,i=0,s=0,n=0,o=""){super(t,e,i,s,n),this.backgroundColor=o,this.components=[],this.tiles=[],this.floor=[],this.bubbles=[],this.finishLevelItem=[],this.cameras=[],this.levels=[N,j],this.levelIndex=0,this.currentLevel={...N},this.playerInitialPosition={x:0,y:0},this.pause=!1,this.gridSize=85.25,this.loadLevel(this.currentLevel)}loadNextLevel(){return this.levelIndex++,!(this.levelIndex>=this.levels.length)&&(this.currentLevel={...this.levels[this.levelIndex]},this.loadLevel(this.currentLevel),!0)}loadLevel(t){this.components=[],this.tiles=[],this.floor=[],this.bubbles=[],this.finishLevelItem=[],this.cameras=[],this.backgroundColor=t.background,this.gridSize=s/t.map.length;const e=t.map;let i=0;const n=new Array(e.length).fill(1).map((()=>new Array(e[0].length).fill(!0)));for(let s=0;s<e.length;s++)for(let o=0;o<e[s].length;o++){const r=e[s][o];if(n[s][o]&&1&r){let t=1;s+1<e.length&&o+1<e[s].length&&1&e[s][o+1]&&1&e[s+1][o]&&1&e[s+1][o+1]&&(n[s][o]=!1,n[s][o+1]=!1,n[s+1][o]=!1,n[s+1][o+1]=!1,t=2);const i=new F(this.eventEmitter,o*this.gridSize,s*this.gridSize,t,this.gridSize);this.tiles.push(i),this.components.push(i)}else if(!(1&r)){const t=new F(this.eventEmitter,o*this.gridSize,s*this.gridSize,3,this.gridSize);this.floor.push(t)}if(4&r){const e=new _(this.eventEmitter,o*this.gridSize+.5*this.gridSize,s*this.gridSize+.5*this.gridSize,this.gridSize,t.cameras[i].viewDistance,t.cameras[i].viewAngle,t.cameras[i].initialRotation,t.cameras[i].maxRotation);i++,this.cameras.push(e)}if(2&r){const t=new $(this.eventEmitter,o*this.gridSize+.5*this.gridSize,s*this.gridSize+.5*this.gridSize);this.finishLevelItem.push(t),this.components.push(t)}8&r&&(this.playerInitialPosition={x:o*this.gridSize+.5*this.gridSize,y:s*this.gridSize+.5*this.gridSize})}}pauseGame(){this.pause=!0}unPauseGame(){this.pause=!1}render(t){this.cleanScreen(t),this.floor.forEach((e=>e.render(t))),this.renderWatterColor(t),this.pause||this.updateBubbles(),this.components.forEach((e=>e.render(t))),this.cameras.forEach((e=>e.render(t)))}updateBubbles(){const t=new Set;for(const e of this.bubbles)e.bubbleDead()&&t.add(e.id);if(this.bubbles=this.bubbles.filter((e=>!t.has(e.id))),this.components=this.components.filter((e=>!t.has(e.id))),this.bubbles.length<20&&1===f(2)){const t=M(this.eventEmitter);this.components.unshift(t),this.bubbles.push(t)}}renderWatterColor(t){this.backgroundColor&&(t.beginPath(),t.fillStyle=this.backgroundColor,t.rect(0,0,g(this.width),g(this.height)),t.fill())}cleanScreen(t){t.clearRect(0,0,i,s)}}class U{constructor(t,e){this.directionKeys=new R,this.level=t,this.score=e,this.player={},this.restartLevel()}destroy(){this.objects.forEach((t=>t.component.destroy.emit())),this.player.component.destroy.emit()}play(){1===this.player.status&&(this.movePlayer(),this.animateComponents(),this.checkCollisionWithRelevantElements())}movePlayer(){if(this.directionKeys.hasPressedKeys()){const o=(i=this.player.directionVector,s=this.directionKeys.directionVector(),n=.95,{x:i.x+(s.x-i.x)*n,y:i.y+(s.y-i.y)*n});this.player.directionVector=(t=v(o),e=10,{x:t.x*e,y:t.y*e});const r=this.player.position;this.player.position=l(this.player.directionVector,this.player.position),this.checkCollisionWithMap()&&(this.player.position=r),this.player.component.animation|=1}else this.player.component.animation=0;var t,e,i,s,n;this.player.component.updateCoordinates(this.player.position),this.player.component.updateDirectionVector({...this.player.directionVector,y:-this.player.directionVector.y})}checkCollisionWithMap(){const t=this.player.component.getProjection();for(const e of this.level.tiles)if(this.checkCollisionInProjections(t,e.getProjection()))return!0;return!1}checkCollisionWithRelevantElements(){const t=this.player.component.getProjection();for(const e of this.level.cameras)e.seeAnyPoint(t)?e.sawPlayer=!0:e.sawPlayer=!1;for(const e of this.level.finishLevelItem)if(this.checkCollisionInProjections(t,e.getProjection("center")))return this.levelComplete(),!1}canPauseGame(){return!0}animateComponents(){this.player.component.animate(),this.level.cameras.forEach((t=>t.animate()))}pause(){this.player.status=7,this.level.pauseGame()}unpause(){this.player.status=1,this.level.unPauseGame()}updateSpaces(){}updateScore(){}getScore(){}checkCollision(){}checkCollisionInProjections(t,e){for(const i of t)for(const t of e)if(b(i.points,t.points))return!0;return!1}levelComplete(){console.log("Level complete"),this.level.loadNextLevel(),this.restartLevel()}restartLevel(){this.player={...this.player,position:this.level.playerInitialPosition,rotation:Math.PI/2,directionVector:{x:0,y:1},expectedRotation:0,velocity:0,minVelocity:10,acceleration:20,deceleration:-1.5,status:1},this.objects=[],this.score.level=this.level.levelIndex+1}}K.any();class X extends x{constructor(t,e){super(t,e),this.buttonPause=new A(this.eventEmitter,10,10,100,30,"SETTINGS"),this.buttonPause.backgroundColor="#00000000",this.buttonPause.textSize=20,this.buttonPause.listenerEvent(n,(()=>{this.currentGame.canPauseGame()&&(this.currentGame.pause(),this.showModal(D.getInstance().getScore(),!1))})),this.listenerEvent(r,this.keyDown.bind(this)),this.listenerEvent(h,this.keyUp.bind(this)),this.initGame()}initGame(){this.isModalShow=!1,this.currentGame&&this.currentGame.destroy(),this.level=new q(this.eventEmitter,0,0,i,s,"#000");const t=new W(this.eventEmitter,1014,10);t.backgroundColor="#00000000",this.player=new I(this.eventEmitter,this.level.playerInitialPosition.x,this.level.playerInitialPosition.y,this.level.gridSize,this.level.gridSize),this.currentGame=new U(this.level,t),this.currentGame.player.component=this.player,this.elements=[this.player,this.buttonPause],this.elements.push(t),this.playableElements=[this.player]}render(t){this.currentGame.play(),this.cleanCanvas(t),this.renderOrRemovePlayableElements(t);for(const e of this.elements)e.render(t)}keyDown(t){this.currentGame.directionKeys.addKey(t.key)}keyUp(t){this.currentGame.directionKeys.removeKey(t.key)}showModal(t,e=!0){if(!this.isModalShow){this.isModalShow=!0;const i=300,s=200,n=new T(this.eventEmitter,512-i/2,384-i/2,i,s);D.getInstance().saveScore(Math.max(D.getInstance().getScore(),t)),n.score=t,n.buttonPlay.listenerEvent("2",(()=>{n.buttonPlay.destroy.emit(),n.buttonShareRecord.destroy.emit(),n.buttonCredits.destroy.emit(),this.currentGame.unpause(),this.elements.pop(),this.isModalShow=!1,e&&this.initGame()})),this.elements.push(n)}}renderOrRemovePlayableElements(t){const e=new Set;for(const i of this.playableElements)this.isElementVisible(i)?i.render(t):e.add(i.id);this.playableElements=this.playableElements.filter((t=>!e.has(t.id)))}isElementVisible(t){return t.y-2*t.height<s}cleanCanvas(t){this.level.render(t)}}class Y{constructor(t,e){this.gameWidth=i,this.gameHeght=768,this.sceneClasses=new Map,this.sceneClasses.set(1,X),this.scenesInstances=new Map,this.currentScene=null,e.on((t=>{this.currentScene.eventEmitter.emit(t),"8"===t.event&&t.dimension&&(this.gameWidth=t.dimension.w,this.gameHeght=t.dimension.h,this.updateGameDimensions())})),this.navigate(t)}navigate(t){this.scenesInstances.has(t)?this.currentScene=this.scenesInstances.get(t):this.sceneClasses.has(t)&&(this.scenesInstances.set(t,new(this.sceneClasses.get(t))(this,new a)),this.currentScene=this.scenesInstances.get(t)),this.updateGameDimensions()}updateGameDimensions(){this.currentScene&&(this.currentScene.width=this.gameWidth,this.currentScene.height=this.gameHeght)}}const Q=1e3/30;let Z=null;class tt{constructor(){window.addEventListener("resize",this.resizeScreen.bind(this)),this.canvas=document.getElementById("game"),this.registerEvents(),this.eventEmitter=new a,this.context=this.canvas.getContext("2d"),this.navigatorRoot=new Y(1,this.eventEmitter),this.loopStatus=3,this.lastTime=0,this.width=this.canvas.width,this.height=this.canvas.height,this.resizeScreen()}registerEvents(){this.registerKeyboardEvent("keydown",r),this.registerKeyboardEvent("keyup",h),this.registerKeyboardEvent("keypress","9"),this.registerClickEvent("click",n),this.registerClickEvent("mousedown","1"),this.registerClickEvent("mouseup","2"),this.registerClickEvent("mouseout",o),this.registerClickEvent("mouseleave","9"),this.registerClickEvent("mousemove","3"),this.registerTouchEvent("touchstart","4",!1),this.registerTouchEvent("touchend","5",!1),this.registerTouchEvent("touchcancel","7",!1),this.registerTouchEvent("touchmove","6",!1)}registerClickEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.clickEvent(t,e)),i)}registerTouchEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.touchEvent(t,e)),i)}registerKeyboardEvent(t,e,i=void 0){document.addEventListener(t,(t=>this.keyboardEvent(t,e)),i)}resizeScreen(){const t=window.innerWidth,s=window.innerHeight;let n=Math.min(i,t),o=n*e;o>s&&(o=s,n=s/e),this.canvas.width=n,this.canvas.height=o,window.currentWidth=n,this.eventEmitter.emit({event:"8",dimension:{w:n,h:o}})}touchEvent(t,e){this.emitPositionEvent({x:t?.targetTouches[0]?.pageX,y:t?.targetTouches[0]?.pageY},e)}clickEvent(t,e){this.emitPositionEvent({x:t?.clientX,y:t?.clientY},e)}keyboardEvent(t,e){this.eventEmitter.emit({event:e,key:t.key})}emitPositionEvent(t,e){const i=this.canvas.getBoundingClientRect();this.eventEmitter.emit({event:e,position:{x:m(t.x-i.left),y:m(t.y-i.top)}})}static getInstance(){return Z||(Z=new tt),Z}init(){this.loopStatus=1,requestAnimationFrame(this.loop.bind(this))}loop(t){1===this.loopStatus&&(1===this.loopStatus&&Q<=t-this.lastTime&&(this.lastTime=t,this.navigatorRoot.currentScene.render(this.context)),requestAnimationFrame(this.loop.bind(this)))}}tt.getInstance().init()})()})();
//# sourceMappingURL=main.js.map