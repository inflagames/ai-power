(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{const e=3/4,i=1024,s=768,n="0",a="8",o="10",r="11";class h{constructor(){this.subscriptions=[],this.open=!0}emit(t={}){for(let e=0;e<this.subscriptions.length;e++)this.callFunction(this.subscriptions[e],t)}async callFunction(t,e){t(e)}pipe(...t){let e=this;for(const i of t){const t=new h;e.on((e=>i(e,t))),e=t}return e}unsub(t){this.subscriptions=this.subscriptions.filter((e=>e!==t))}on(t){this.subscriptions.push(t)}}class y{constructor(e,i=0,s=0,n=0,a=0){this.destroy=new h,this.eventEmitter=e,this.x=i,this.y=s,this.width=n,this.height=a,this.lastMousePosition=null,this.isMouseHover=!1,void 0===t.g.idCount&&(t.g.idCount=0),this.id=t.g.idCount++}set eventEmitter(t){this._eventEmitter=t?t.pipe(function(t){let e=!1;const i=()=>{e=!0,t.unsub(i)};return t.on(i),(t,i)=>{e&&(i.subscriptions=[]),i.emit(t)}}(this.destroy)):t}get eventEmitter(){return this._eventEmitter}render(t){}listenerEvent(t,e){var i;this.eventEmitter.pipe((i=e=>e.event===t,(t,e)=>{i(t)&&e.emit(t)})).on((t=>{(t&&this.validateMouseEventPropagation(t.position,t.event)||this.validateKeyboardEventPropagation(t.event))&&e(t)}))}validateKeyboardEventPropagation(t){return t===o||t===r||"9"===t}validateMouseEventPropagation(t,e){return"5"===e||e===a||"7"===e||"9"===e||(this.isPositionInside(this.lastMousePosition)&&!this.isPositionInside(t)&&this.eventEmitter.emit({event:a}),this.lastMousePosition=t,this.isMouseHover=this.isPositionInside(t))}isPositionInside(t){return t&&t.x>=this.x&&t.x<=this.x+this.width&&t.y>=this.y&&t.y<=this.y+this.height}}class x extends y{constructor(t,e){super(e),this.navigator=t,this.backgroundColor="#f00",this.elements=[]}render(t){this.cleanCanvas(t);for(const e of this.elements)e.render(t)}cleanCanvas(t){t.rect(0,0,this.width,this.height),t.fillStyle=this.backgroundColor,t.fill()}validateEventPropagation(t,e){const i=super.validateEventPropagation(t,e);if(i)for(const i of this.elements)if(i.validateEventPropagation(t,e))return!1;return i}}function l(t){return Math.atan2(t.y,t.x)}function c(t,e){return{x:t.x+e.x,y:t.y+e.y}}function d(t,e,i){const s=u(t,i);return{x:e.x+s.x,y:e.y-s.y}}function u(t,e){return{x:t.x*Math.cos(e)-t.y*Math.sin(e),y:t.x*Math.sin(e)+t.y*Math.cos(e)}}const p=t=>t*t;function m(t){return t*window.currentWidth/i}function g(t){return t*i/window.currentWidth}function v(t,e=0){return Math.floor(Math.random()*t)+e}function f(t,e){if(t.length<3||e.length<3)return!1;const i=[...k(t),...k(e)];for(const s of i){const i=S(t,s),n=S(e,s);if(!(i.min>n.min&&i.min<n.max||i.max>n.min&&i.max<n.max||n.min>i.min&&n.min<i.max||n.max>i.min&&n.max<i.max||i.min===n.min&&i.max===n.max))return!1}return!0}function b(t,e){const i={...t[0]},s={...t[0]};for(const e of t)i.x=Math.min(i.x,e.x),i.y=Math.min(i.y,e.y),s.x=Math.max(s.x,e.x),s.y=Math.max(s.y,e.y);const n=.5*(s.x+i.x),a=.5*(s.y+i.y),o=Math.abs(e.x-n),r=Math.abs(e.y-a);if(o>.5*(s.x-i.x)+e.r||r>.5*(s.y-i.y)+e.r)return!1;if(o<=.5*(s.x-i.x)||r<=.5*(s.y-i.y))return!0;return p(o-.5*(s.x-i.x))+p(r-.5*(s.y-i.y))<=p(e.r)}function w(t){if(0===t.x&&0===t.y)return{x:0,y:0};const e=Math.sqrt(t.x*t.x+t.y*t.y);return{x:t.x/e,y:t.y/e}}function k(t){if(t.length<=1)return[];const e=[];for(let i=1;i<t.length;i++)e.push({x:t[i].x-t[i-1].x,y:t[i-1].y-t[i].y});return e.push({x:t[0].x-t[t.length-1].x,y:t[t.length-1].y-t[0].y}),e}function S(t,e){let i=D(e,t[0]),s=i;for(let n=1;n<t.length;n++){const a=D(e,t[n]);i=Math.min(i,a),s=Math.max(s,a)}return{min:i,max:s}}function D(t,e){return(e.x*t.x+e.y*t.y)/(t.x*t.x+t.y*t.y)}class R extends y{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.backgroundColor="#00f",this.rotation=0,this.directionVector={x:1,y:0},this.scaleShape=3.3,this.brakedShape=null}updateCoordinates(t,e){this.x=t||this.x,this.y=e||this.y}render(t){const e=this.getProjection();for(const i of e){const e=i.points;if(0!==e.length){t.beginPath(),t.moveTo(m(e[0].x),m(e[0].y));for(let i=1;i<e.length;i++)t.lineTo(m(e[i].x),m(e[i].y));t.closePath(),t.fillStyle=i.background,Boolean(i.stroke)&&(t.stroke(),t.strokeStyle=i.stroke,t.lineWidth=5*i.strokeWidth),t.fill()}}}animate(){this.moveBrakedPiece()}brakeShapes(){const t=this.currentShape().shapes;this.brakedShape={shapes:[]};for(const e of t)this.brakedShape={shapes:[...this.brakedShape.shapes,...this.brakeShape(e)]};for(const t of this.brakedShape.shapes){const e=this.shapeCenter(t.points),i=(Math.random()+.5)/Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2));t.vector={x:e.x*i,y:e.y*i}}}brakeShape(t){if(0===t.points.length)return t.points;const{min:e,max:i}=this.coverBox(t.points),s=[];let n=Math.ceil((i.x-e.x)*(i.y-e.y)/2);n=Math.min(n,150);for(let a=0;a<n;a++){const n={x:(i.x-e.x)*Math.random()+e.x,y:(i.y-e.y)*Math.random()+e.y};s.push({points:new Array(3).fill(null).map((()=>({x:n.x+2.5*Math.random(),y:n.y+2.5*Math.random()}))),background:t.background})}return s}shapeCenter(t){const{min:e,max:i}=this.coverBox(t);return{x:(i.x+e.x)/2,y:(i.y+e.y)/2}}coverBox(t){const e={x:t[0].x,y:t[0].y},i={...e};for(let s=1;s<t.length;s++)e.x=Math.min(e.x,t[s].x),e.y=Math.min(e.y,t[s].y),i.x=Math.max(i.x,t[s].x),i.y=Math.max(i.y,t[s].y);return{min:e,max:i}}moveBrakedPiece(){if(this.brakedShape)for(const t of this.brakedShape.shapes)t.points=t.points.map((e=>({x:e.x+t.vector.x,y:e.y+t.vector.y}))),t.background=this.reduceOpacity(t.background,30)}reduceOpacity(t,e){let i=this.getOpacity(t);return i=Math.min(255,Math.max(i-e,0)),i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getColorWithOpacity(t,e){let i=Math.min(255,Math.max(Math.floor(255*e),0));return i=i.toString(16),`#${t.substr(1,6)}${(i.length<2?"0":"")+i}`}getOpacity(t){return t.length>7?parseInt(t.substr(7,2),16):255}getProjection(t=void 0){const e=l(this.directionVector)+Math.PI/2,i=this.currentShape().shapes,s=this.getPosition(),n=[];for(const a of i){if(t&&a.id!==t)continue;const i=a.points.map((t=>({x:t.x*this.scaleShape,y:t.y*this.scaleShape})));for(let t=0;t<i.length;t++)i[t]=d(i[t],s,e);n.push({...a,points:i})}return n}getPosition(){return{x:this.x,y:this.y}}currentShape(){return{shapes:[]}}}const A=JSON.parse('{"shapes":[{"id":"foot-r","background":"#523e35ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":4.562043795620436,"y":-2.0072992700730055},{"x":3.892944038929425,"y":-5.900243309002441},{"x":5.109489051094872,"y":-7.116788321167892},{"x":7.299270072992698,"y":-7.116788321167892},{"x":8.941605839416084,"y":-6.690997566909989},{"x":9.610705596107024,"y":-5.474452554744541},{"x":9.24574209245744,"y":-3.345498783454996},{"x":8.759124087591225,"y":-1.3381995133820048},{"x":7.907542579075425,"y":2.250608272506067},{"x":5.109489051094872,"y":2.0681265206812505}]},{"id":"foot-l","background":"#523e35ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-4.805352798053512,"y":-2.0072992700730055},{"x":-4.136253041362501,"y":-5.900243309002441},{"x":-5.413625304136236,"y":-7.116788321167892},{"x":-7.542579075425774,"y":-7.116788321167892},{"x":-9.245742092457442,"y":-6.690997566909989},{"x":-9.914841849148385,"y":-5.474452554744541},{"x":-9.549878345498804,"y":-3.345498783454996},{"x":-9.002433090024297,"y":-1.3381995133820048},{"x":-8.211678832116785,"y":2.250608272506067},{"x":-5.352798053527948,"y":2.0681265206812505}]},{"id":"path132294-9","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.5547445255474734,"y":-19.282238442822386},{"x":-3.7712895377129207,"y":-20.74209245742093},{"x":-7.42092457420927,"y":-22.262773722627742},{"x":-13.017031630170294,"y":-22.445255474452555},{"x":-16.970802919708007,"y":-23.96593673965937},{"x":-17.822384428223806,"y":-25},{"x":-17.76155717761559,"y":-23.175182481751825},{"x":-16.60583941605836,"y":-21.411192214111924},{"x":-18.004866180048666,"y":-20.924574209245744},{"x":-16.05839416058392,"y":-20.012165450121657},{"x":-17.274939172749367,"y":-18.734793187347936},{"x":-15.936739659367415,"y":-17.82238442822385},{"x":-16.423357664233567,"y":-16.24087591240876},{"x":-12.22627737226278,"y":-15.81508515815086},{"x":-6.812652068126546,"y":-15.632603406326039},{"x":-2.1897810218978258,"y":-16.24087591240876}]},{"id":"path132294","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.1897810218978258,"y":-19.282238442822386},{"x":3.3454987834549854,"y":-20.74209245742093},{"x":7.0559610705596185,"y":-22.262773722627742},{"x":12.652068126520646,"y":-22.445255474452555},{"x":16.54501216545014,"y":-23.96593673965937},{"x":17.45742092457423,"y":-25},{"x":17.335766423357654,"y":-23.175182481751825},{"x":16.240875912408775,"y":-21.411192214111924},{"x":17.579075425790727,"y":-20.924574209245744},{"x":15.693430656934268,"y":-20.012165450121657},{"x":16.909975669099722,"y":-18.734793187347936},{"x":15.51094890510948,"y":-17.82238442822385},{"x":15.997566909975632,"y":-16.24087591240876},{"x":11.800486618004847,"y":-15.81508515815086},{"x":6.447688564476895,"y":-15.632603406326039},{"x":1.7639902676398869,"y":-16.24087591240876}]},{"id":"path70565","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":3.588807785888058,"y":-18.79562043795621},{"x":2.128953771289538,"y":-19.403892944038933},{"x":-0.3649635036496477,"y":-19.76885644768857},{"x":-2.7980535279805494,"y":-19.403892944038933},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-3.5888077858880614,"y":-18.187347931873482},{"x":-2.372262773722614,"y":-18.79562043795621},{"x":-0.3041362530413636,"y":-18.79562043795621},{"x":1.3990267639902427,"y":-17.944038929440396}]},{"id":"hand-l","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":-20.49878345498785,"y":-5.048661800486631},{"x":-18.856447688564465,"y":-12.104622871046237},{"x":-18.79562043795618,"y":-14.233576642335773},{"x":-18.917274939172753,"y":-16.849148418491488},{"x":-19.221411192214113,"y":-18.187347931873482},{"x":-21.41119221411194,"y":-18.673965936739663},{"x":-22.992700729926966,"y":-17.639902676399032},{"x":-23.600973236009693,"y":-14.111922141119226},{"x":-23.78345498783455,"y":-10.401459854014607},{"x":-23.78345498783455,"y":-7.785888077858889},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"hand-r","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165853,"points":[{"x":20.49878345498785,"y":-5.9610705596107145},{"x":18.856447688564465,"y":-13.077858880778596},{"x":18.79562043795618,"y":-15.14598540145986},{"x":18.91727493917275,"y":-17.82238442822385},{"x":19.221411192214113,"y":-19.09975669099757},{"x":21.472019464720155,"y":-19.58637469586375},{"x":22.992700729926966,"y":-18.55231143552312},{"x":23.661800486617977,"y":-15.024330900243314},{"x":23.783454987834553,"y":-11.313868613138695},{"x":23.783454987834553,"y":-8.698296836982976},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":17.396593673965945,"y":-5.231143552311444},{"x":18.004866180048666,"y":2.3114355231143406},{"x":21.046228710462287,"y":3.832116788321155},{"x":22.810218978102178,"y":3.1630170316301545},{"x":24.270072992700705,"y":1.399026763990257},{"x":25,"y":-2.128953771289545},{"x":24.513381995133777,"y":-4.68369829683699},{"x":23.47931873479319,"y":-6.630170316301715}]},{"id":"path149189-7","background":"#6e3d2eff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-17.39659367396594,"y":-4.31873479318736},{"x":-18.004866180048666,"y":3.2238442822384314},{"x":-21.046228710462287,"y":4.744525547445242},{"x":-22.810218978102178,"y":4.075425790754238},{"x":-24.2700729927007,"y":2.3114355231143406},{"x":-25,"y":-1.1557177615571916},{"x":-24.513381995133777,"y":-3.771289537712903},{"x":-23.47931873479319,"y":-5.717761557177628}]},{"id":"path71384","background":"#7b7959ff","stroke":"#000000","strokeWidth":0.175779,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.90997566909972,"y":-13.321167883211686},{"x":-20.802919708029215,"y":-9.914841849148425},{"x":-21.77615571776152,"y":-6.690997566909989},{"x":-19.951338199513344,"y":4.562043795620426},{"x":-14.233576642335745,"y":8.515815085158138},{"x":-3.163017031630197,"y":11.800486618004847},{"x":6.5085158150851825,"y":11.43552311435522},{"x":15.024330900243328,"y":7.968369829683681},{"x":19.464720194647192,"y":4.379562043795605},{"x":21.59367396593673,"y":-6.447688564476898},{"x":19.951338199513344,"y":-11.009732360097333},{"x":16.42335766423357,"y":-13.38199513381996},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path71384-1","background":"#7b7959ff","stroke":"#000000","strokeWidth":0.160998,"points":[{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-16.301703163016995,"y":-11.131386861313878},{"x":-18.673965936739677,"y":-8.819951338199523},{"x":-20.37712895377128,"y":-6.204379562043805},{"x":-18.61313868613139,"y":3.892944038929425},{"x":-13.321167883211658,"y":7.420924574209224},{"x":-2.9805352798053377,"y":10.340632603406313},{"x":6.082725060827247,"y":10.097323600973219},{"x":14.05109489051096,"y":6.934306569343047},{"x":18.187347931873454,"y":3.710462287104612},{"x":20.133819951338197,"y":-6.0218978102189915},{"x":17.94403892944038,"y":-9.610705596107064},{"x":15.328467153284691,"y":-11.982968369829688},{"x":9.24574209245744,"y":-14.781021897810225}]},{"id":"path65968-1","background":"#ba6560ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-16.24087591240878,"y":3.2238442822384314},{"x":-18.61313868613139,"y":2.3114355231143406},{"x":-19.951338199513344,"y":-7.105427357601002e-15},{"x":-19.82968369829684,"y":-3.2238442822384563},{"x":-18.004866180048666,"y":-5.231143552311444},{"x":-14.598540145985393,"y":-5.6569343065693545},{"x":-14.781021897810183,"y":3.4063260340632446}]},{"id":"path65968","background":"#ba6560ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":15.632603406326048,"y":3.2238442822384314},{"x":18.004866180048666,"y":2.3114355231143406},{"x":19.282238442822404,"y":-7.105427357601002e-15},{"x":19.221411192214113,"y":-3.2238442822384563},{"x":17.396593673965945,"y":-5.231143552311444},{"x":13.929440389294385,"y":-5.6569343065693545},{"x":14.172749391727457,"y":3.4063260340632446}]},{"id":"path63330-3","background":"#ab5552ff","stroke":"#000000","strokeWidth":0.100969,"points":[{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":6.326034063260323,"y":-19.221411192214116},{"x":10.462287104622888,"y":-17.639902676399032},{"x":12.226277372262778,"y":-15.328467153284675},{"x":12.591240875912426,"y":-11.982968369829688},{"x":11.070559610705615,"y":-8.51581508515816},{"x":6.630170316301687,"y":-6.630170316301715},{"x":3.1021897810219095,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171},{"x":-0.18248175182478832,"y":-19.58637469586375},{"x":-6.630170316301687,"y":-19.221411192214116},{"x":-10.766423357664257,"y":-17.639902676399032},{"x":-12.530413625304144,"y":-15.328467153284675},{"x":-12.895377128953792,"y":-11.982968369829688},{"x":-11.435523114355197,"y":-8.51581508515816},{"x":-6.93430656934305,"y":-6.630170316301715},{"x":-3.406326034063273,"y":-5.9610705596107145},{"x":-0.18248175182478832,"y":-5.839416058394171}]},{"id":"path70563-6","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-12.895377128953792,"y":-18.24817518248176},{"x":-12.77372262773722,"y":-16.605839416058398},{"x":-3.5888077858880614,"y":-17.457420924574212},{"x":-3.7104622871046367,"y":-18.917274939172756}]},{"id":"path70563","background":"#3a3544ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":12.530413625304142,"y":-18.3698296836983},{"x":12.469586374695858,"y":-16.727493917274945},{"x":3.2238442822384137,"y":-17.396593673965945},{"x":3.3454987834549854,"y":-18.917274939172756}]},{"id":"path66083","background":"#c56057ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-3.2238442822384137,"y":-14.841849148418497},{"x":-4.501216545012149,"y":-16.90997566909976},{"x":-4.257907542579073,"y":-18.79562043795621},{"x":-2.7980535279805494,"y":-20.012165450121657},{"x":-2.493917274939186,"y":-21.411192214111924},{"x":-1.520681265206811,"y":-22.019464720194648},{"x":-0.3041362530413636,"y":-22.08029197080292},{"x":0.9124087591240908,"y":-22.019464720194648},{"x":1.8856447688564586,"y":-21.411192214111924},{"x":2.128953771289538,"y":-20.012165450121657},{"x":3.588807785888058,"y":-18.79562043795621},{"x":3.8321167883211373,"y":-16.90997566909976},{"x":2.55474452554747,"y":-14.841849148418497},{"x":-0.3041362530413636,"y":-14.598540145985409}]},{"id":"path119374","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":2.55474452554747,"y":-16.849148418491488},{"x":3.8321167883211373,"y":-18.430656934306572},{"x":7.116788321167903,"y":-18.30900243309003},{"x":9.732360097323593,"y":-18.065693430656935},{"x":10.827250608272472,"y":-18.430656934306572},{"x":9.732360097323593,"y":-17.03163017031631},{"x":6.934306569343047,"y":-16.66666666666667}]},{"id":"path119374-2","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-2.91970802919705,"y":-16.727493917274945},{"x":-4.257907542579073,"y":-18.3698296836983},{"x":-7.542579075425774,"y":-18.24817518248176},{"x":-10.15815085158153,"y":-18.004866180048666},{"x":-11.253041362530409,"y":-18.3698296836983},{"x":-10.15815085158153,"y":-16.970802919708035},{"x":-7.360097323600982,"y":-16.605839416058398}]},{"id":"path63330","background":"#ab5552ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":8.39416058394157,"y":-16.66666666666667},{"x":13.80778588807788,"y":-13.503649635036503},{"x":16.18004866180049,"y":-8.819951338199523},{"x":16.60583941605836,"y":-2.0681265206812753},{"x":14.65936739659368,"y":5.048661800486602},{"x":8.759124087591225,"y":8.880778588807772},{"x":4.1362530413625045,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113},{"x":-0.12165450121657173,"y":-17.457420924574212},{"x":-8.637469586374717,"y":-16.66666666666667},{"x":-14.111922141119242,"y":-13.503649635036503},{"x":-16.423357664233567,"y":-8.819951338199523},{"x":-16.849148418491502,"y":-2.0681265206812753},{"x":-14.902676399026756,"y":5.048661800486602},{"x":-9.002433090024297,"y":8.880778588807772},{"x":-4.440389294403861,"y":10.218978102189766},{"x":-0.12165450121657173,"y":10.52311435523113}]},{"id":"path132989","background":"#e2eac1ff","stroke":"#000000","strokeWidth":0.165,"points":[{"x":-15.51094890510948,"y":-9.367396593673973},{"x":-9.489051094890518,"y":-14.781021897810225},{"x":-3.5279805352797773,"y":-16.484184914841855},{"x":3.2846715328467013,"y":-16.484184914841855},{"x":9.24574209245744,"y":-14.781021897810225},{"x":14.963503649635044,"y":-9.063260340632612},{"x":16.484184914841855,"y":-2.6763990267640025},{"x":15.632603406326048,"y":2.433090024330891},{"x":12.591240875912426,"y":10.03649635036495},{"x":10.827250608272472,"y":14.051094890510932},{"x":9.48905109489052,"y":10.94890510948904},{"x":8.69829683698294,"y":12.652068126520668},{"x":7.968369829683709,"y":14.111922141119202},{"x":7.360097323600982,"y":15.571776155717743},{"x":5.9610705596106754,"y":13.564476885644751},{"x":5.352798053527952,"y":10.5839416058394},{"x":3.8321167883211373,"y":12.165450121654487},{"x":1.9464720194647462,"y":15.936739659367369},{"x":-0.9124087591240873,"y":10.827250608272486},{"x":-1.4598540145985233,"y":13.442822384428204},{"x":-2.372262773722614,"y":16.1192214111922},{"x":-4.379562043795644,"y":14.659367396593652},{"x":-4.683698296837008,"y":12.591240875912384},{"x":-5.47445255474452,"y":9.610705596107039},{"x":-6.386861313868611,"y":12.773722627737207},{"x":-7.603406326034058,"y":15.81508515815083},{"x":-8.698296836982937,"y":12.591240875912384},{"x":-9.245742092457442,"y":9.245742092457398},{"x":-9.914841849148385,"y":11.253041362530396},{"x":-11.800486618004847,"y":15.145985401459832},{"x":-12.469586374695856,"y":11.6788321167883},{"x":-14.29440389294403,"y":7.968369829683681},{"x":-16.90997566909972,"y":-2.128953771289545}]}]}');function E(t,e=void 0,n=void 0,a=void 0,o=void 0){e=e||v(i),n=n||v(s);const r=a||v(40,10),h=o||v(40,10);return new P(t,e,n,r,h)}class P extends R{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n),this.scaleShape=0,this.lifeTime=0}render(t){this.calculateScale(),this.lifeTime++,t.beginPath(),t.fillStyle=this.getColorWithOpacity("#6c8d8eff",this.showAndHideFunction(this.getTimeFactor())),this.scaleShape=this.growBubbleFunction(this.getTimeFactor());const e=this.width*this.scaleShape,i=this.height*this.scaleShape;t.ellipse(this.x,this.y,e,i,0,0,2*Math.PI),t.fill()}calculateScale(){this.scaleShape=Math.sin(this.y/10)}getTimeFactor(){return Math.min(this.lifeTime/20,1)}showAndHideFunction(t){return Math.sin(t*Math.PI)/4}growBubbleFunction(t){return 1.4426950408889634*Math.log(t+1)}bubbleDead(){return this.lifeTime>20}}class C extends R{constructor(t,e=0,i=0,s){super(t,e,i,s,s),this.directionVector={x:0,y:1},this.calculateScale(),this.shape={...A},this.time=(new Date).getTime(),this.animation=0,this.animationIsOn=!1,this.bubblesIntervalToShow=3,this.bubblesCount=0,this.bubbles=[],this.updateCoordinates()}calculateScale(){this.scaleShape=.012578125*this.width}render(t){this.bubbles=this.bubbles.filter((t=>!t.bubbleDead())),this.bubbles.forEach((e=>e.render(t))),super.render(t)}getCollisionCircle(){return{x:this.x,y:this.y,r:this.width/3}}updateCoordinates({x:t,y:e}={}){this.x=t||this.x,this.y=e||this.y}updateDirectionVector(t){this.directionVector=t}animate(){super.animate(),1&this.animation?(this.animationIsOn||(this.time=(new Date).getTime()),this.animationIsOn=!0,this.animateWalk()):this.animationIsOn&&(this.animationIsOn=!1,this.shape={...A})}animateWalk(){const t=-20*this.stepAnimationFunction(),e=this.handAnimationFunction();let i={x:1e3,y:1e3},s={x:-1e3,y:-1e3};this.shape.shapes.forEach((t=>t.points.forEach((t=>{i.y=Math.min(i.y,t.y),i.x=Math.min(i.x,t.x),s.y=Math.max(s.y,t.y),s.x=Math.max(s.x,t.x)}))));this.shape.shapes=A.shapes.map((i=>{if(i.id.startsWith("foot")){const e=i.id.endsWith("-l")?t:-t;return{...i,points:i.points.map((t=>({...t,y:t.y+e})))}}if(i.id.startsWith("hand")){const t=i.id.endsWith("-l")?1:-1;return{...i,points:i.points.map((i=>({...i,y:(i.y- -2)*e*t-2})))}}return{...i}})),0===this.bubblesCount&&this.newBubble(),this.bubblesCount++,this.bubblesCount>=this.bubblesIntervalToShow&&(this.bubblesCount=0)}newBubble(){const t=E(this.eventEmitter,this.x,this.y,50,50);t.lifeTime=5,this.bubbles.push(t)}stepAnimationFunction(){const t=((new Date).getTime()-this.time)/500;return Math.sin(t*Math.PI)}handAnimationFunction(){const t=((new Date).getTime()-this.time)/500;return Math.cos(t*Math.PI)}currentShape(){return this.brakedShape||this.shape}}class M extends y{constructor(t,e,i,s){super(t,e,i),this.score=0,this.textSize=20,this.backgroundColor="#000",this.textColor="#fff",this.text=s,this.lastTime=0}render(t){t.font=`${m(this.textSize)}px Arial`;const e=`${this.text} ${this.score}`,i=t.measureText(e),s=i.width,n=i.actualBoundingBoxAscent+i.actualBoundingBoxDescent;t.beginPath(),t.rect(m(this.x-s-10),m(this.y),m(s+10),m(n+10)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${m(this.textSize)}px Arial`,t.fillStyle=this.textColor,t.fillText(e,m(this.x-s-5),m(this.y+n+5))}}class I extends y{constructor(t,e,i,s,n,o){super(t,e,i,s,n),this.text=o,this.textSize=10,this.backgroundColor="#000",this.textColor="#fff",this.textColorHover="#9a9a9a",this.listenerEvent("3",(t=>{this.isPositionInside(t.position)&&(document.body.style.cursor="pointer")})),this.listenerEvent(a,(t=>{document.body.style.cursor="default"})),this.visible=!0}hide(){this.visible=!1}render(t){if(!this.visible)return;t.beginPath(),t.rect(m(this.x),m(this.y),m(this.width),m(this.height)),t.fillStyle=this.backgroundColor,t.fill(),t.beginPath(),t.font=`${m(this.textSize)}px Arial`;const e=t.measureText(this.text),i=g(e.width),s=g(e.actualBoundingBoxAscent+e.actualBoundingBoxDescent);t.fillStyle=this.isMouseHover?this.textColorHover:this.textColor,t.fillText(this.text,m(this.x+this.width/2-i/2),m(this.y+this.height/2+s/2))}}const z="fearwater",T=`${z}_game_last_level`,B=`${z}_game_current_deaths`,W=`${z}_game_first_time`,K=`${z}_game_best_deaths`;let L=null;class O{static getInstance(){return L||(L=new O),L}saveBestDeaths(t){t<+(this.loadBestDeaths()||999999)&&this.saveData(K,t)}loadBestDeaths(){return this.getData(K)}isFirstTime(){const t=!this.getData(W);return this.saveData(W,"false"),t}saveDeaths(t){this.saveData(B,t)}loadDeaths(){return+(this.getData(B)||0)}saveLastLevel(t){this.saveData(T,t)}getLastLevel(){return+(this.getData(T)||0)}saveData(t,e){localStorage.setItem(t,e+"")}getData(t){return localStorage.getItem(t)}}class G extends y{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.textSize=90,this.text2Size=30,this.text="AI POWER",this.score=1e3,this.bestScore=O.getInstance().loadBestDeaths();const a=30,o=120;this.components=[],this.createPlayButton(this.x+(this.width-120)/2,this.y+this.height-150,120,a),this.createCredits(this.x,this.y,120,a),this.createRestartButton(this.x+(this.width-o)/2,this.y+this.height-100,o,a),this.createShareButton(this.x+(this.width-o-40)/2+20,this.y+this.height-a-20,o,a)}hidePlayButton(){this.buttonPlay.hide()}destroyComponents(){this.components.forEach((t=>t.destroy.emit()))}createPlayButton(t,e,i,s){this.buttonPlay=new I(this.eventEmitter,t,e,i,s,"CONTINUE"),this.components.push(this.buttonPlay)}createRestartButton(t,e,i,s){this.buttonRestart=new I(this.eventEmitter,t,e,i,s,"RESTART"),this.components.push(this.buttonRestart)}createCredits(t,e,i,s){this.buttonCredits=new I(this.eventEmitter,t,e,i,s,"@ggjnez92"),this.buttonCredits.backgroundColor="#00000000",this.buttonCredits.textColor="#000",this.buttonCredits.textColorHover="#0048ff",this.buttonCredits.listenerEvent(n,(()=>window.open("https://twitter.com/ggjnez92","_blank").focus())),this.components.push(this.buttonCredits)}createShareButton(t,e,i,s){this.buttonShareRecord=new I(this.eventEmitter,t,e,i,s,"SHARE ON TWITTER"),this.buttonShareRecord.listenerEvent(n,(()=>{let t="I'm currently playing the game AI POWER developed for the #gamedevjs jam.\n\n#gamedev\n\nIf you want to check it out, here is the link to the #github repository\nhttps://github.com/inflagames/ai-power";this.bestScore&&(t="I finish the game AI POWER with "+this.bestScore+" deaths. Can you beat me?\n\n#gamedevjs #gamedev\n\nIf you want to check it out, here is the link to the #github repository\nhttps://github.com/inflagames/ai-power");const e=`https://twitter.com/intent/tweet?text=${encodeURIComponent(t)}`;window.open(e,"_blank").focus()})),this.components.push(this.buttonShareRecord)}render(t){this.renderDialogBox(t),this.components.forEach((e=>e.render(t))),this.renderTitle(t),this.renderScore(t)}renderDialogBox(t){t.beginPath(),t.rect(0,0,m(i),m(s)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(m(this.x),m(this.y),m(this.width),m(this.height)),t.fillStyle=this.backgroundColor,t.fill()}renderScore(t){if(void 0!==this.bestScore&&null!==this.bestScore){t.beginPath(),t.font=`${m(20)}px Arial`;const e=`Best score: ${this.bestScore} deaths`,i=g(t.measureText(e).width);t.fillStyle="#000",t.fillText(e,m(this.x+this.width/2-i/2),m(this.y+110))}}renderTitle(t){t.beginPath(),t.font=`${m(this.text2Size)}px Arial`;const e=g(t.measureText(this.text).width);t.fillStyle="#000",t.fillText(this.text,m(this.x+this.width/2-e/2),m(this.y+70))}}const V={Android:function(){return navigator.userAgent.match(/Android/i)},BlackBerry:function(){return navigator.userAgent.match(/BlackBerry/i)},iOS:function(){return navigator.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return navigator.userAgent.match(/Opera Mini/i)},Windows:function(){return navigator.userAgent.match(/IEMobile/i)||navigator.userAgent.match(/WPDesktop/i)},any:function(){return V.Android()||V.BlackBerry()||V.iOS()||V.Opera()||V.Windows()}};class H{constructor(){this.presedKeys=[]}clear(){this.presedKeys=[]}addKey(t){this.isDirectionKey(t)&&!this.presedKeys.includes(t)&&this.presedKeys.push(t)}removeKey(t){this.presedKeys=this.presedKeys.filter((e=>e!==t))}isDirectionKey(t){return"a"===t||"w"===t||"s"===t||"d"===t}hasPressedKeys(){return this.presedKeys.length>0}directionVector(){let t={x:0,y:0};const e=this.direction();return 1&e?t.y=-1:2&e&&(t.y=1),4&e?t.x=-1:8&e&&(t.x=1),w(t)}direction(){let t=0;if(this.presedKeys.length>0){t=this.directionMap(this.presedKeys[0]);let e=1;for(;e<this.presedKeys.length;){let i=this.consumeNextDirection(1,4,8,t,this.directionMap(this.presedKeys[e]));if(i|=this.consumeNextDirection(2,4,8,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(4,1,2,t,this.directionMap(this.presedKeys[e])),i|=this.consumeNextDirection(8,1,2,t,this.directionMap(this.presedKeys[e])),i){t|=i;break}e++}}return t}consumeNextDirection(t,e,i,s,n){return t!==s||n!==e&&n!==i?0:n}directionMap(t){return"w"===t?1:"s"===t?2:"a"===t?4:"d"===t?8:0}}const N=JSON.parse('{"shapes":[{"id":"path40916-9-3","background":"#b85c54ff","stroke":"#000000","strokeWidth":0.115301,"points":[{"x":-25,"y":-0.9528130671506325},{"x":-25,"y":-23.729582577132486},{"x":-24.092558983666063,"y":-25},{"x":-11.388384754990923,"y":-25},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-11.388384754990923,"y":0.04537205081669882},{"x":-24.092558983666063,"y":0.04537205081669882}]},{"id":"path40916","background":"#c56057ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-24.909255898366606,"y":24.09255898366606},{"x":-24.909255898366606,"y":1.3157894736842088},{"x":-24.001814882032665,"y":0.04537205081669882},{"x":-1.0435571687840195,"y":0.04537205081669882},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-1.1343012704174242,"y":25},{"x":-24.274047186932844,"y":25}]},{"id":"path40916-9","background":"#be7063ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-0.22686025408348698,"y":24.09255898366606},{"x":-0.22686025408348698,"y":1.3157894736842088},{"x":0.6805807622504538,"y":0.04537205081669882},{"x":23.638838475499107,"y":0.04537205081669882},{"x":24.63702359346643,"y":1.3157894736842088},{"x":24.63702359346643,"y":24.09255898366606},{"x":23.548094373865702,"y":25},{"x":0.4083484573502787,"y":25}]},{"id":"path40916-9-7","background":"#c55f56ff","stroke":"#000000","strokeWidth":0.178584,"points":[{"x":-10.390199637023589,"y":-0.9528130671506325},{"x":-10.390199637023589,"y":-23.729582577132486},{"x":-9.210526315789465,"y":-25},{"x":23.729582577132497,"y":-25},{"x":24.63702359346643,"y":-23.729582577132486},{"x":24.63702359346643,"y":-0.9528130671506325},{"x":23.638838475499107,"y":0.04537205081669882},{"x":-9.210526315789465,"y":0.04537205081669882}]}]}'),F=JSON.parse('{"shapes":[{"id":"path40916-0","background":"#c56057ff","stroke":"#000000","strokeWidth":0.149407,"points":[{"x":-25,"y":23.0072463768116},{"x":-25,"y":-22.463768115942017},{"x":-23.18840579710145,"y":-25},{"x":22.64492753623189,"y":-25},{"x":24.275362318840592,"y":-22.463768115942017},{"x":24.275362318840592,"y":23.0072463768116},{"x":22.463768115942045,"y":25},{"x":-23.73188405797101,"y":25}]}]}'),$=JSON.parse('{"shapes":[{"id":"path40916-9-3-3","background":"#b85c54ff","stroke":"#000000","strokeWidth":0.057048,"points":[{"x":-25,"y":-0.636363636363626},{"x":-25,"y":-23.181818181818183},{"x":-23.727272727272723,"y":-24.818181818181802},{"x":-11.181818181818178,"y":-25},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-10.090909090909086,"y":-0.636363636363626},{"x":-11.181818181818178,"y":0.27272727272728403},{"x":-23.727272727272723,"y":0.27272727272728403}]},{"id":"path40916-6","background":"#c56057ff","stroke":"#000000","strokeWidth":0.0874443,"points":[{"x":-25,"y":24.090909090909093},{"x":-25,"y":1.5454545454545325},{"x":-23.181818181818183,"y":0.27272727272728403},{"x":8.636363636363647,"y":0.27272727272728403},{"x":9.727272727272727,"y":1.5454545454545325},{"x":9.727272727272727,"y":24.090909090909093},{"x":8.454545454545453,"y":25},{"x":-23.727272727272723,"y":25}]},{"id":"path40916-9-1","background":"#be7063ff","stroke":"#000000","strokeWidth":0.0739228,"points":[{"x":9.727272727272727,"y":24.090909090909093},{"x":9.727272727272727,"y":1.5454545454545325},{"x":10.63636363636364,"y":0.27272727272728403},{"x":23.545454545454533,"y":0.27272727272728403},{"x":24.636363636363647,"y":1.5454545454545325},{"x":24.636363636363647,"y":24.090909090909093},{"x":23.545454545454533,"y":25},{"x":10.272727272727273,"y":25}]},{"id":"path40916-9-7-0","background":"#c55f56ff","stroke":"#000000","strokeWidth":0.0883588,"points":[{"x":-10.090909090909086,"y":-0.8181818181817988},{"x":-10.090909090909086,"y":-23.363636363636353},{"x":-8.999999999999993,"y":-24.818181818181802},{"x":23.727272727272734,"y":-24.818181818181802},{"x":24.636363636363647,"y":-23.363636363636353},{"x":24.636363636363647,"y":-0.8181818181817988},{"x":23.545454545454533,"y":0.27272727272728403},{"x":-8.999999999999993,"y":0.27272727272728403}]}]}'),_=["#b85c54","#c56057","#be7063","#c55f56"];class J extends R{constructor(t,e=0,i=0,s,n){super(t,e,i,s*n,s*n),this.directionVector=this.getRotation(),this.gridSize=n,this.type=s,this.tileShape={...this.getShape(s)},this.positionCorrection={x:0,y:0},this.setupTile()}getShape(t){switch(t){case 1:return F;case 2:return N;default:return $}}getRotation(){switch(v(4)){case 0:return{x:1,y:0};case 1:return{x:0,y:1};case 2:return{x:-1,y:0};case 3:return{x:0,y:-1}}}setupTile(){let t={...this.tileShape.shapes[0].points[0]},e={...this.tileShape.shapes[0].points[0]};for(let i of this.tileShape.shapes)for(let s of i.points)s.x<t.x&&(t.x=s.x),s.y<t.y&&(t.y=s.y),s.x>e.x&&(e.x=s.x),s.y>e.y&&(e.y=s.y);const i=this.gridSize*this.getGridSize()/((e.x-t.x)*this.scaleShape),s=this.gridSize*this.getGridSize()/((e.y-t.y)*this.scaleShape);this.positionCorrection={x:this.gridSize*this.getGridSize()*.5,y:this.gridSize*this.getGridSize()*.5},this.tileShape.shapes=this.tileShape.shapes.map((t=>({...t,background:_[v(_.length)],points:t.points.map((t=>({x:t.x*i,y:t.y*s})))})))}getGridSize(){switch(this.type){case 1:case 3:return 1;case 2:return 2}}getPosition(){return c(super.getPosition(),this.positionCorrection)}currentShape(){return this.tileShape}animate(){}}const j=JSON.parse('{"shapes":[{"id":"path261160-5","background":"#c5605700","points":[{"x":-25,"y":-25},{"x":24.456521739130466,"y":-24.818840579710155},{"x":24.456521739130466,"y":24.818840579710155},{"x":-25,"y":25}]},{"id":"path266143","background":"#4b4b4cff","points":[{"x":-8.514492753623195,"y":-14.673913043478228},{"x":-14.855072463768124,"y":-8.514492753623195},{"x":-17.028985507246365,"y":-0.3623188405797144},{"x":-14.855072463768124,"y":9.057971014492786},{"x":-8.514492753623195,"y":14.67391304347828},{"x":-0.3623188405797144,"y":16.66666666666667},{"x":7.971014492753611,"y":14.67391304347828},{"x":14.130434782608688,"y":9.057971014492786},{"x":16.485507246376827,"y":-0.3623188405797144},{"x":14.130434782608688,"y":-8.514492753623195},{"x":7.971014492753611,"y":-14.673913043478228},{"x":-0.3623188405797144,"y":-16.84782608695652}]},{"id":"path266143-5-5","background":"#1e1a22ff","points":[{"x":-7.0652173913043335,"y":-12.499999999999986},{"x":-12.499999999999986,"y":-7.246376811594178},{"x":-14.492753623188383,"y":-0.3623188405797144},{"x":-12.499999999999986,"y":7.789855072463766},{"x":-7.0652173913043335,"y":12.68115942028988},{"x":2.842170943040401e-14,"y":14.31159420289859},{"x":6.884057971014489,"y":12.68115942028988},{"x":12.318840579710141,"y":7.789855072463766},{"x":14.311594202898533,"y":-0.3623188405797144},{"x":12.318840579710141,"y":-7.246376811594178},{"x":6.884057971014489,"y":-12.499999999999986},{"x":2.842170943040401e-14,"y":-14.311594202898538}]},{"id":"path266143-5","background":"#4b4b4cff","points":[{"x":-6.884057971014489,"y":-11.594202898550712},{"x":-11.775362318840557,"y":-6.884057971014489},{"x":-13.586956521739108,"y":-0.724637681159404},{"x":-11.775362318840557,"y":6.702898550724644},{"x":-6.884057971014489,"y":11.050724637681178},{"x":-0.5434782608695592,"y":12.500000000000036},{"x":5.79710144927537,"y":11.050724637681178},{"x":10.688405797101439,"y":6.702898550724644},{"x":12.499999999999986,"y":-0.724637681159404},{"x":10.688405797101439,"y":-6.884057971014489},{"x":5.79710144927537,"y":-11.594202898550712},{"x":-0.5434782608695592,"y":-13.405797101449263}]},{"id":"path266143-4-6","background":"#442937ff","points":[{"x":-4.166666666666664,"y":-6.884057971014489},{"x":-7.246376811594178,"y":-3.9855072463768195},{"x":-8.33333333333335,"y":-0.1811594202898199},{"x":-7.246376811594178,"y":4.347826086956559},{"x":-4.166666666666664,"y":7.065217391304387},{"x":-0.3623188405797144,"y":7.97101449275366},{"x":3.62318840579713,"y":7.065217391304387},{"x":6.702898550724644,"y":4.347826086956559},{"x":7.789855072463766,"y":-0.1811594202898199},{"x":6.702898550724644,"y":-3.9855072463768195},{"x":3.62318840579713,"y":-6.884057971014489},{"x":-0.3623188405797144,"y":-7.971014492753607}]},{"id":"path266143-4","background":"#4b4b4cff","points":[{"x":-4.166666666666664,"y":-6.884057971014489},{"x":-7.0652173913043335,"y":-3.9855072463768195},{"x":-8.152173913043452,"y":-0.3623188405797144},{"x":-7.0652173913043335,"y":3.8043478260869747},{"x":-4.166666666666664,"y":6.340579710144954},{"x":-0.5434782608695592,"y":7.2463768115942315},{"x":3.079710144927546,"y":6.340579710144954},{"x":5.978260869565215,"y":3.8043478260869747},{"x":7.065217391304337,"y":-0.3623188405797144},{"x":5.978260869565215,"y":-3.9855072463768195},{"x":3.079710144927546,"y":-6.884057971014489},{"x":-0.5434782608695592,"y":-7.789855072463762}]},{"id":"center","background":"#f93a33ff","points":[{"x":-3.0797101449275424,"y":-4.891304347826093},{"x":-5.072463768115938,"y":-2.898550724637648},{"x":-5.79710144927537,"y":-0.3623188405797144},{"x":-5.072463768115938,"y":2.5362318840580116},{"x":-3.0797101449275424,"y":4.347826086956559},{"x":-0.5434782608695592,"y":4.891304347826093},{"x":1.9927536231884204,"y":4.347826086956559},{"x":3.9855072463768195,"y":2.5362318840580116},{"x":4.710144927536248,"y":-0.3623188405797144},{"x":3.9855072463768195,"y":-2.898550724637648},{"x":1.9927536231884204,"y":-4.891304347826093},{"x":-0.5434782608695592,"y":-5.4347826086956275}]}]}');class U extends R{constructor(t,e=0,i=0,s){super(t,e,i,s,s),this.directionVector={x:-1,y:1},this.shape={...j},this.scaleShape=1.7*s/85,this.enable=!1}render(t){this.animate(),super.render(t)}animate(){super.animate(),this.shape.shapes.filter((t=>"center"===t.id)).forEach((t=>{const e=.2*(Math.sin((new Date).getTime()/200)+1)+.6;t.background=this.getColorWithOpacity(this.getCenterColor(),e)}))}getCenterColor(){return this.enable?"#2ea12e":"#b30f0f"}getPosition(){return{x:this.x,y:this.y}}currentShape(){return this.shape}}const q=JSON.parse('{"shapes":[{"id":"path261160","background":"#c5605700","points":[{"x":-24.818840579710155,"y":-25},{"x":24.637681159420282,"y":-24.818840579710155},{"x":24.637681159420282,"y":24.818840579710155},{"x":-25,"y":25}]},{"id":"path209313-1","background":"#99999957","points":[{"x":-8.69565217391304,"y":-20.289855072463777},{"x":-15.036231884057969,"y":-14.492753623188435},{"x":-18.478260869565226,"y":-6.884057971014489},{"x":-18.478260869565226,"y":6.884057971014489},{"x":-15.036231884057969,"y":15.217391304347814},{"x":-8.333333333333325,"y":20.652173913043463},{"x":-0.18115942028984477,"y":22.826086956521756},{"x":7.971014492753639,"y":20.652173913043463},{"x":14.673913043478251,"y":15.217391304347814},{"x":18.115942028985508,"y":6.884057971014489},{"x":18.115942028985508,"y":-6.884057971014489},{"x":14.673913043478251,"y":-14.492753623188435},{"x":8.333333333333329,"y":-20.289855072463777},{"x":-0.18115942028984477,"y":-22.82608695652176}]},{"id":"path209313","background":"#e3e1d6ff","points":[{"x":-6.521739130434774,"y":-16.48550724637683},{"x":-11.231884057971023,"y":-11.775362318840607},{"x":-13.76811594202898,"y":-5.434782608695681},{"x":-13.586956521739134,"y":5.79710144927537},{"x":-11.05072463768115,"y":12.499999999999986},{"x":-6.159420289855085,"y":17.02898550724636},{"x":-0.18115942028984477,"y":18.840579710144915},{"x":5.79710144927537,"y":17.02898550724636},{"x":10.869565217391312,"y":12.499999999999986},{"x":13.224637681159443,"y":5.79710144927537},{"x":13.405797101449288,"y":-5.434782608695681},{"x":10.869565217391312,"y":-11.775362318840607},{"x":6.159420289855085,"y":-16.48550724637683},{"x":-0.18115942028984477,"y":-18.478260869565226}]},{"id":"path214972-2","background":"#fab8aeff","points":[{"x":-5.434782608695656,"y":17.391304347826107},{"x":-8.876811594202909,"y":14.311594202898533},{"x":-10.326086956521745,"y":9.420289855072475},{"x":-8.876811594202909,"y":3.8043478260869747},{"x":-5.434782608695656,"y":0.1811594202898732},{"x":-0.18115942028984477,"y":-1.6304347826086811},{"x":5.072463768115938,"y":0.1811594202898732},{"x":8.514492753623195,"y":3.8043478260869747},{"x":9.963768115942031,"y":9.420289855072475},{"x":8.514492753623195,"y":14.311594202898533},{"x":5.072463768115938,"y":17.391304347826107},{"x":-0.18115942028984477,"y":18.840579710144915}]},{"id":"path214972","background":"#1f1d1dff","points":[{"x":-5.253623188405811,"y":17.391304347826107},{"x":-8.514492753623195,"y":14.492753623188378},{"x":-9.963768115942031,"y":9.782608695652165},{"x":-8.514492753623195,"y":4.347826086956509},{"x":-5.253623188405811,"y":0.9057971014492523},{"x":-0.18115942028984477,"y":-0.724637681159404},{"x":4.891304347826093,"y":0.9057971014492523},{"x":8.152173913043484,"y":4.347826086956509},{"x":9.60144927536232,"y":9.782608695652165},{"x":8.152173913043484,"y":14.492753623188378},{"x":4.891304347826093,"y":17.391304347826107},{"x":-0.18115942028984477,"y":18.840579710144915}]},{"id":"path232338","background":"#fab8aeff","points":[{"x":-4.347826086956534,"y":3.4420289855072355},{"x":-7.789855072463762,"y":4.891304347826093},{"x":-8.876811594202909,"y":3.9855072463768195},{"x":-6.702898550724644,"y":1.6304347826086811},{"x":-4.7101449275362235,"y":0.5434782608695627},{"x":-2.3550724637681135,"y":-0.3623188405797144},{"x":-0.18115942028984477,"y":-0.724637681159404},{"x":2.173913043478265,"y":-0.3623188405797144},{"x":4.347826086956534,"y":0.5434782608695627},{"x":6.3405797101449295,"y":1.6304347826086811},{"x":8.514492753623195,"y":3.9855072463768195},{"x":7.427536231884048,"y":4.891304347826093},{"x":3.9855072463768195,"y":3.4420289855072355},{"x":-0.18115942028984477,"y":2.898550724637701}]},{"id":"path232948","background":"#fab8aeff","points":[{"x":-2.536231884057983,"y":10.326086956521749},{"x":-3.4420289855072568,"y":12.499999999999986},{"x":-2.536231884057983,"y":14.492753623188378},{"x":-0.18115942028984477,"y":15.398550724637659},{"x":2.35507246376811,"y":14.492753623188378},{"x":3.079710144927546,"y":12.499999999999986},{"x":2.35507246376811,"y":10.326086956521749},{"x":-0.18115942028984477,"y":9.23913043478263}]},{"id":"path232948-0","background":"#252938ff","points":[{"x":-2.536231884057983,"y":10.688405797101439},{"x":-3.260869565217387,"y":12.499999999999986},{"x":-2.536231884057983,"y":14.311594202898533},{"x":-0.18115942028984477,"y":15.036231884057969},{"x":2.173913043478265,"y":14.311594202898533},{"x":2.8985507246376727,"y":12.499999999999986},{"x":2.173913043478265,"y":10.688405797101439},{"x":-0.18115942028984477,"y":9.60144927536232}]},{"id":"path232948-0-6","background":"#08070dff","points":[{"x":-1.2681159420289916,"y":11.594202898550712},{"x":-1.630434782608706,"y":12.499999999999986},{"x":-1.2681159420289916,"y":13.224637681159415},{"x":-0.18115942028984477,"y":13.586956521739104},{"x":0.9057971014492736,"y":13.224637681159415},{"x":1.2681159420289916,"y":12.499999999999986},{"x":0.9057971014492736,"y":11.594202898550712},{"x":-0.18115942028984477,"y":11.050724637681178}]}]}'),X={viewDistance:2,viewAngle:3,initialRotation:1,maxRotation:2,animationDelay:0,animateDistance:!1,speed:1e3};class Y extends R{constructor(t,e=0,i=0,s,n){super(t,e,i,s,s),this.options={...X,...n},this.baseDirection=u({x:0,y:1},Math.PI*this.options.initialRotation),this.baseDistance=this.options.viewDistance,this.directionVector={x:0,y:1},this.shape={...q};const a={...this.shape.shapes[0].points[0]},o={...this.shape.shapes[0].points[0]};this.shape.shapes.forEach((t=>t.points.forEach((t=>{a.x=Math.min(a.x,t.x),a.y=Math.min(a.y,t.y),o.x=Math.max(o.x,t.x),o.y=Math.max(o.y,t.y)})))),this.scaleShape=s/Math.max(o.x-a.x,o.y-a.y),this.options.maxRotation*=Math.PI,this.sawPlayer=!1}animate(){const t=((new Date).getTime()+this.options.animationDelay)/this.options.speed,e=Math.sin(t);if(this.directionVector=u(this.baseDirection,e*this.options.maxRotation*.5),this.options.animateDistance){const e=.5*(Math.sin(t)+1);this.options.viewDistance=e*this.baseDistance}}render(t){t.beginPath();const e=this.currentViewAngle();t.moveTo(m(this.x),m(this.y)),t.arc(m(this.x),m(this.y),m(this.width*this.options.viewDistance),e,e+Math.PI/this.options.viewAngle,!1),t.fillStyle=this.getVisionColor(),t.fill(),super.render(t)}getVisionColor(){return this.sawPlayer?"rgba(255, 0, 0, 0.1)":"rgba(0, 255, 0, 0.1)"}seeAnyPoint(t){for(const e of t)for(const t of e.points)if(this.seePoint(t))return!0;return!1}seePoint(t){if(e=t,i={x:this.x,y:this.y},p(i.x-e.x)+p(i.y-e.y)<=p(this.width*this.options.viewDistance)){const e=l(function(t,e){return{x:e.x-t.x,y:e.y-t.y}}({x:this.x,y:this.y},t)),i=Math.PI/(2*this.options.viewAngle),s=this.currentViewAngle()+i;return Math.abs(e-s)<i||Math.abs(e-s+2*Math.PI)<i}var e,i;return!1}currentViewAngle(){return l({x:-this.directionVector.x,y:this.directionVector.y})-Math.PI/(2*this.options.viewAngle)}getPosition(){return{x:this.x,y:this.y}}currentShape(){return this.shape}}const Q=JSON.parse('{"shapes":[{"id":"path968","background":"#8ba23dff","points":[{"x":-16.14785992217898,"y":19.260700389105054},{"x":-17.607003891050574,"y":20.330739299610897},{"x":-19.649805447470804,"y":20.525291828793776},{"x":-21.108949416342398,"y":19.844357976653697},{"x":-21.69260700389106,"y":18.871595330739297},{"x":-21.400778210116727,"y":17.60700389105059},{"x":-20.03891050583657,"y":14.980544747081716},{"x":-21.011673151750962,"y":14.494163424124515},{"x":-21.011673151750962,"y":13.813229571984436},{"x":-20.525291828793765,"y":12.840466926070036},{"x":-19.649805447470804,"y":11.478599221789878},{"x":-21.303501945525294,"y":12.743190661478607},{"x":-21.984435797665363,"y":13.91050583657588},{"x":-23.63813229571984,"y":13.715953307393},{"x":-24.31906614785992,"y":12.840466926070036},{"x":-23.83268482490272,"y":11.575875486381328},{"x":-22.27626459143969,"y":10.311284046692606},{"x":-21.108949416342398,"y":9.338521400778212},{"x":-23.540856031128406,"y":9.143968871595334},{"x":-24.708171206225682,"y":8.365758754863819},{"x":-25,"y":6.906614785992222},{"x":-24.708171206225682,"y":5.54474708171206},{"x":-23.34630350194552,"y":4.669260700389106},{"x":-22.373540856031127,"y":4.182879377431902},{"x":-23.735408560311285,"y":3.0155642023346303},{"x":-24.416342412451353,"y":2.042801556420237},{"x":-24.610894941634236,"y":0.5836575875486432},{"x":-23.83268482490272,"y":-0.3891050583657574},{"x":-22.859922178988324,"y":-1.1673151750972721},{"x":-21.498054474708162,"y":-0.5836575875486396},{"x":-20.719844357976662,"y":0.6809338521400754},{"x":-19.941634241245133,"y":1.0700389105058399},{"x":-19.163424124513604,"y":0.4863813229571967},{"x":-20.622568093385198,"y":-0.3891050583657574},{"x":-22.76264591439689,"y":-2.821011673151748},{"x":-22.568093385214006,"y":-5.933852140077821},{"x":-20.525291828793765,"y":-7.6848249027237365},{"x":-0.7782101167315219,"y":-10.31128404669261},{"x":4.961089494163428,"y":3.988326848249031},{"x":-6.712062256809336,"y":20.42801556420234},{"x":-9.727626459143965,"y":19.552529182879383},{"x":-11.186770428015558,"y":20.330739299610897},{"x":-12.937743190661486,"y":20.719844357976655},{"x":-14.299610894941619,"y":19.64980544747081},{"x":-14.688715953307382,"y":18.48249027237354}]},{"id":"path754","background":"#7d8c3bff","points":[{"x":-3.5019455252918164,"y":24.41634241245137},{"x":-2.042801556420219,"y":25},{"x":-0.4863813229571896,"y":25},{"x":0.5836575875486432,"y":24.610894941634243},{"x":1.4591439688716008,"y":23.346303501945528},{"x":2.2373540856031333,"y":24.41634241245137},{"x":3.2101167315175267,"y":25},{"x":4.6692607003891204,"y":24.610894941634243},{"x":5.642023346303521,"y":23.638132295719842},{"x":6.22568093385215,"y":22.47081712062257},{"x":7.003891050583654,"y":23.054474708171206},{"x":7.879377431906619,"y":23.15175097276265},{"x":8.852140077821012,"y":22.859922178988327},{"x":9.435797665369648,"y":22.47081712062257},{"x":9.922178988326849,"y":23.540856031128406},{"x":10.70038910505837,"y":24.0272373540856},{"x":11.9649805447471,"y":23.832684824902728},{"x":12.548638132295736,"y":22.66536964980545},{"x":13.326848249027236,"y":21.108949416342412},{"x":13.813229571984436,"y":20.233463035019454},{"x":14.591439688715965,"y":19.64980544747081},{"x":16.439688715953324,"y":19.357976653696504},{"x":17.704280155642024,"y":18.871595330739297},{"x":18.190661478599218,"y":17.704280155642024},{"x":17.996108949416353,"y":16.342412451361866},{"x":17.509727626459153,"y":15.175097276264594},{"x":18.968871595330747,"y":14.883268482490273},{"x":20.428015564202347,"y":14.591439688715958},{"x":21.498054474708177,"y":13.715953307393},{"x":22.17898832684827,"y":12.645914396887157},{"x":22.081712062256805,"y":11.284046692607006},{"x":21.20622568093387,"y":10.311284046692606},{"x":22.17898832684827,"y":9.922178988326849},{"x":22.568093385214006,"y":8.949416342412448},{"x":22.66536964980547,"y":7.3929961089494185},{"x":22.47081712062257,"y":6.031128404669257},{"x":21.498054474708177,"y":4.961089494163428},{"x":20.525291828793776,"y":3.988326848249031},{"x":19.747081712062275,"y":3.210116731517509},{"x":21.011673151750976,"y":2.237354085603112},{"x":22.37354085603114,"y":1.2645914396887115},{"x":23.15175097276267,"y":0.29182879377431803},{"x":23.346303501945535,"y":-1.0700389105058399},{"x":23.054474708171206,"y":-2.821011673151748},{"x":23.540856031128406,"y":-3.988326848249031},{"x":23.7354085603113,"y":-5.642023346303507},{"x":22.95719844357977,"y":-7.198443579766536},{"x":19.066147859922182,"y":-11.867704280155639},{"x":11.867704280155635,"y":-12.840466926070036},{"x":8.268482490272383,"y":-7.879377431906619},{"x":5.2529182879377565,"y":1.8482490272373546},{"x":-1.4591439688715866,"y":10.116731517509727},{"x":-5.350194552529178,"y":18.871595330739297},{"x":-4.474708171206217,"y":22.76264591439689},{"x":-3.9883268482490166,"y":23.638132295719842}]},{"id":"path705","background":"#a5b849ff","points":[{"x":-20.525291828793765,"y":-1.6536964980544724},{"x":-22.76264591439689,"y":-2.821011673151748},{"x":-24.31906614785992,"y":-4.377431906614792},{"x":-24.902723735408554,"y":-6.712062256809336},{"x":-24.027237354085603,"y":-8.75486381322958},{"x":-22.08171206225681,"y":-9.824902723735413},{"x":-19.260700389105065,"y":-10.116731517509727},{"x":-20.817120622568098,"y":-11.770428015564205},{"x":-21.011673151750962,"y":-13.424124513618683},{"x":-20.23346303501946,"y":-14.980544747081712},{"x":-19.066147859922168,"y":-16.14785992217899},{"x":-17.50972762645914,"y":-16.828793774319074},{"x":-15.66147859922178,"y":-16.828793774319074},{"x":-15.953307392996111,"y":-18.482490272373553},{"x":-15.66147859922178,"y":-19.747081712062265},{"x":-14.688715953307382,"y":-19.941634241245147},{"x":-14.007782101167317,"y":-19.163424124513618},{"x":-12.840466926070022,"y":-19.260700389105065},{"x":-11.77042801556419,"y":-17.898832684824903},{"x":-11.381322957198428,"y":-19.260700389105065},{"x":-10.505836575875493,"y":-20.52529182879378},{"x":-9.046692607003898,"y":-21.595330739299612},{"x":-7.198443579766536,"y":-21.88715953307394},{"x":-5.44747081712061,"y":-21.498054474708177},{"x":-4.1828793774319095,"y":-20.428015564202344},{"x":-3.3073929961089483,"y":-18.96887159533075},{"x":-1.8482490272373546,"y":-20.03891050583658},{"x":0.19455252918287158,"y":-20.52529182879378},{"x":2.6264591439688694,"y":-20.719844357976662},{"x":2.6264591439688694,"y":-22.178988326848255},{"x":2.72373540856033,"y":-23.540856031128406},{"x":3.2101167315175267,"y":-24.31906614785993},{"x":4.2801556420233595,"y":-25},{"x":5.2529182879377565,"y":-24.805447470817132},{"x":6.128404669260718,"y":-24.12451361867705},{"x":6.420233463035025,"y":-22.95719844357977},{"x":6.322957198443586,"y":-21.498054474708177},{"x":6.128404669260718,"y":-20.52529182879378},{"x":6.128404669260718,"y":-19.747081712062265},{"x":7.101167315175118,"y":-20.817120622568098},{"x":8.268482490272383,"y":-21.78988326848249},{"x":9.533073929961112,"y":-22.08171206225681},{"x":10.797665369649806,"y":-21.78988326848249},{"x":11.381322957198442,"y":-20.817120622568098},{"x":11.089494163424142,"y":-19.649805447470815},{"x":10.311284046692606,"y":-18.385214007782103},{"x":10.019455252918306,"y":-17.412451361867706},{"x":11.089494163424142,"y":-18.093385214007785},{"x":12.2568093385214,"y":-18.677042801556418},{"x":13.715953307393,"y":-18.579766536964986},{"x":14.591439688715965,"y":-17.80155642023347},{"x":14.980544747081723,"y":-16.536964980544756},{"x":14.49416342412453,"y":-14.88326848249028},{"x":16.634241245136188,"y":-14.299610894941631},{"x":19.066147859922182,"y":-13.326848249027236},{"x":21.108949416342412,"y":-11.770428015564205},{"x":21.984435797665377,"y":-9.727626459143979},{"x":21.40077821011674,"y":-8.268482490272383},{"x":19.64980544747081,"y":-7.879377431906619},{"x":18.09338521400778,"y":-9.046692607003898},{"x":16.634241245136188,"y":-9.630350194552529},{"x":16.731517509727624,"y":-11.673151750972771},{"x":14.591439688715965,"y":-8.560311284046698},{"x":12.840466926070036,"y":-7.3929961089494185},{"x":13.132295719844365,"y":-5.739299610894939},{"x":13.618677042801565,"y":-4.961089494163424},{"x":14.49416342412453,"y":-4.085603112840463},{"x":14.202334630350201,"y":-3.015564202334634},{"x":12.743190661478607,"y":-2.6264591439688694},{"x":11.9649805447471,"y":-0.48638132295720027},{"x":11.089494163424142,"y":0.19455252918287158},{"x":10.019455252918306,"y":0.5836575875486432},{"x":10.116731517509741,"y":1.7509727626459153},{"x":11.575875486381335,"y":3.210116731517509},{"x":11.867704280155635,"y":4.766536964980546},{"x":10.992217898832706,"y":5.739299610894943},{"x":9.338521400778212,"y":6.1284046692607},{"x":5.836575875486389,"y":6.031128404669257},{"x":4.377431906614792,"y":5.6420233463035},{"x":4.6692607003891204,"y":8.268482490272376},{"x":4.377431906614792,"y":10.505836575875485},{"x":3.793774319066163,"y":11.673151750972764},{"x":1.9455252918288046,"y":11.381322957198442},{"x":3.2101167315175267,"y":12.354085603112843},{"x":3.501945525291834,"y":13.91050583657588},{"x":2.3346303501945656,"y":14.883268482490273},{"x":0.9727626459144041,"y":14.883268482490273},{"x":-0.4863813229571896,"y":13.715953307393},{"x":-1.5564202334630224,"y":12.548638132295721},{"x":-3.7937743190661486,"y":14.78599221789883},{"x":-5.058365758754846,"y":16.342412451361866},{"x":-5.836575875486375,"y":18.57976653696499},{"x":-6.614785992217904,"y":20.914396887159533},{"x":-8.171206225680933,"y":22.27626459143969},{"x":-10.116731517509727,"y":22.568093385214006},{"x":-11.867704280155625,"y":21.984435797665377},{"x":-12.354085603112825,"y":20.817120622568098},{"x":-11.77042801556419,"y":19.163424124513618},{"x":-11.186770428015558,"y":17.023346303501945},{"x":-7.976653696498037,"y":14.202334630350201},{"x":-6.322957198443575,"y":11.08949416342412},{"x":-8.754863813229566,"y":12.645914396887157},{"x":-10.311284046692595,"y":13.132295719844365},{"x":-11.284046692606994,"y":12.548638132295721},{"x":-12.256809338521391,"y":10.505836575875485},{"x":-12.451361867704286,"y":9.143968871595334},{"x":-11.381322957198428,"y":7.684824902723733},{"x":-8.657587548638134,"y":5.058365758754864},{"x":-6.225680933852139,"y":3.0155642023346303},{"x":-4.280155642023345,"y":1.8482490272373546},{"x":-2.918287937743184,"y":1.0700389105058399},{"x":-1.8482490272373546,"y":-1.4591439688716008},{"x":-2.042801556420219,"y":-4.280155642023345},{"x":-3.9883268482490166,"y":-6.906614785992222},{"x":-6.031128404669246,"y":-5.933852140077821},{"x":-6.517509727626443,"y":-4.766536964980546},{"x":-6.906614785992208,"y":-3.4046692607003948},{"x":-8.463035019455237,"y":-2.0428015564202333},{"x":-9.435797665369632,"y":-0.9727626459144041},{"x":-11.77042801556419,"y":-1.3618677042801544},{"x":-14.396887159533081,"y":-3.112840466926066},{"x":-16.828793774319074,"y":-5.54474708171206},{"x":-18.190661478599207,"y":-7.295719844357983},{"x":-20.525291828793765,"y":-7.198443579766536},{"x":-21.78988326848249,"y":-6.614785992217904},{"x":-22.17898832684824,"y":-5.350194552529192},{"x":-21.69260700389106,"y":-4.571984435797663}]}]}');class Z extends R{constructor(t,e=0,i=0,s=0,n=0){super(t,e,i,s,n);const a=Math.random()*Math.PI*2;this.directionVector=u({x:0,y:1},a)}currentShape(){return Q}animate(){}}const tt=[JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,17,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,5,1,1,1,1,1,1,1],[1,8,0,0,0,0,0,0,0,0,2,1],[1,1,1,1,1,1,1,5,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,17,1,1],[1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,17,1,1,1,1,2,1],[1,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,1,5,1,1,1,1,1,0,1],[1,8,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,5,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,1,1,1,1,1,1,17,2,1],[1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,5,1,1,1,2,1],[1,8,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,5,1,1,1,5,1,0,1],[1,2,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,5,1,1,5,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,0,1],[1,1,1,17,1,1,1,1,1,1,2,1],[1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"animationDelay":600,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"animationDelay":-600,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"animationDelay":-700,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,0,8,1,17,1,0,0,0,1,0,2,1],[1,1,0,0,0,0,1,1,1,0,1,0,1,0,0,1],[5,0,0,0,0,0,1,1,1,0,1,0,0,0,0,1],[1,0,0,0,1,1,1,1,1,0,0,1,0,0,0,1],[1,0,0,1,1,5,0,1,1,1,0,1,1,1,1,1],[1,0,0,1,0,0,0,0,1,1,0,0,0,0,1,1],[1,0,0,1,0,0,1,0,0,1,1,0,0,0,0,5],[1,0,0,5,0,0,1,0,0,5,1,1,1,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,5,1,1,1,1,1,5,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":0.5},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":-0.5},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":-0.5},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"animationDelay":2000,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":1,"initialRotation":1,"animationDelay":2000}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,8,1,0,0,0,5,0,0,0,5,0,0,0,0,1],[1,0,0,0,5,0,0,0,5,0,0,0,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,0,0,0,0,5,0,0,0,5,0,0,0,1,0,1],[1,0,1,1,0,0,0,5,0,0,0,1,0,0,0,1],[1,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,5,0,0,0,5,0,0,0,5,0,0,0,0,1],[1,0,0,0,5,0,0,0,5,0,0,0,1,1,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1],[1,2,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":2,"viewAngle":3,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,8,0,0,0,0,0,0,0,0,0,0,0,0,2,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,5,5,5,5,5,5,5,5,5,5,5,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":0,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":0,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":0,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":0,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":0,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":0,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500},{"viewDistance":2,"viewAngle":6,"maxRotation":0,"initialRotation":1,"animateDistance":true,"speed":500},{"viewDistance":1,"viewAngle":6,"maxRotation":0.2,"initialRotation":1,"speed":500}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,8,0,0,0,0,0,0,0,0,0,0,0,0,2,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,0,4,0,0,4,0,0,4,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,0,4,0,0,4,0,0,4,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,4,0,0,0,4,0,0,4,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":1},{"viewDistance":2,"viewAngle":3,"maxRotation":2,"initialRotation":0}]}'),JSON.parse('{"name":"first level","background":"#756266c8","map":[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,2,1],[1,0,1,1,5,1,1,5,1,1,5,1,1,5,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,5,1,1,5,1,1,5,1,1,5,0,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,0,1,1,5,1,1,5,1,1,5,1,1,5,1,1],[1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,5,1,1,5,1,1,5,1,1,5,0,1],[1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]],"cameras":[{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":700},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":1400},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":2100},{"viewDistance":1.5,"viewAngle":3,"maxRotation":1,"initialRotation":1,"animationDelay":-700},{"viewDistance":1.5,"viewAngle":3,"maxRotation":1,"initialRotation":1,"animationDelay":0},{"viewDistance":1.5,"viewAngle":3,"maxRotation":1,"initialRotation":1,"animationDelay":700},{"viewDistance":1.5,"viewAngle":3,"maxRotation":1,"initialRotation":1,"animationDelay":1400},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":2800},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":3500},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":4200},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":1,"animationDelay":4800},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":0},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":0,"animationDelay":700},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":0,"animationDelay":1400},{"viewDistance":2,"viewAngle":3,"maxRotation":1.2,"initialRotation":0,"animationDelay":2100}]}')];class et extends y{constructor(t,e=0,i=0,s=0,n=0,a=""){super(t,e,i,s,n),this.backgroundColor=a,this.components=[],this.tiles=[],this.floor=[],this.bubbles=[],this.finishLevelItem=[],this.cameras=[],this.levels=tt,this.playerInitialPosition={x:0,y:0},this.pause=!1,this.gridSize=85.25,this.loadLastLevel()}hasMoreLevels(){return this.levelIndex+1<this.levels.length}loadLastLevel(){this.levelIndex=O.getInstance().getLastLevel(),this.loadLevel()}loadFirstLevel(){this.levelIndex=0,this.loadLevel()}loadNextLevel(){return this.levelIndex++,!(this.levelIndex>=this.levels.length)&&(this.loadLevel(),!0)}loadLevel(){this.currentLevel={...this.levels[this.levelIndex]},this.components=[],this.decorations=[],this.tiles=[],this.floor=[],this.bubbles=[],this.finishLevelItem=[],this.cameras=[],this.backgroundColor=this.currentLevel.background,this.gridSize=s/this.currentLevel.map.length;const t=this.currentLevel.map;let e=0;const i=new Array(t.length).fill(1).map((()=>new Array(t[0].length).fill(!0)));for(let s=0;s<t.length;s++)for(let n=0;n<t[s].length;n++){const a=t[s][n];if(i[s][n]&&1&a){let e=1;s+1<t.length&&n+1<t[s].length&&1&t[s][n+1]&&1&t[s+1][n]&&1&t[s+1][n+1]&&(i[s][n]=!1,i[s][n+1]=!1,i[s+1][n]=!1,i[s+1][n+1]=!1,e=2);const a=new J(this.eventEmitter,n*this.gridSize,s*this.gridSize,e,this.gridSize);this.tiles.push(a),this.components.push(a)}else if(!(1&a)){const t=new J(this.eventEmitter,n*this.gridSize,s*this.gridSize,3,this.gridSize);this.floor.push(t)}if(4&a){const t=new Y(this.eventEmitter,n*this.gridSize+.5*this.gridSize,s*this.gridSize+.5*this.gridSize,this.gridSize,this.currentLevel.cameras[e]);e++,this.cameras.push(t)}if(2&a){const t=new U(this.eventEmitter,n*this.gridSize+.5*this.gridSize,s*this.gridSize+.5*this.gridSize,this.gridSize);this.finishLevelItem.push(t),this.components.push(t)}if(16&a){const t=new Z(this.eventEmitter,n*this.gridSize+.5*this.gridSize,s*this.gridSize+.5*this.gridSize);this.decorations.push(t)}8&a&&(this.playerInitialPosition={x:n*this.gridSize+.5*this.gridSize,y:s*this.gridSize+.5*this.gridSize})}O.getInstance().saveLastLevel(this.levelIndex)}pauseGame(){this.pause=!0}unPauseGame(){this.pause=!1}render(t){this.cleanScreen(t),this.floor.forEach((e=>e.render(t))),this.renderWatterColor(t),this.pause||this.updateBubbles(),this.components.forEach((e=>e.render(t))),this.decorations.forEach((e=>e.render(t))),this.cameras.forEach((e=>e.render(t)))}updateBubbles(){const t=new Set;for(const e of this.bubbles)e.bubbleDead()&&t.add(e.id);if(this.bubbles=this.bubbles.filter((e=>!t.has(e.id))),this.components=this.components.filter((e=>!t.has(e.id))),this.bubbles.length<20&&1===v(2)){const t=E(this.eventEmitter);this.components.unshift(t),this.bubbles.push(t)}}renderWatterColor(t){this.backgroundColor&&(t.beginPath(),t.fillStyle=this.backgroundColor,t.rect(0,0,m(this.width),m(this.height)),t.fill())}cleanScreen(t){t.clearRect(0,0,i,s)}}class it{constructor(t,e,i){this.directionKeys=new H,this.level=t,this.score=e,this.scoreDeaths=i,this.player={},this.restartLevel(),this.sideAnimation=0,this.showSettings=()=>{}}destroy(){this.player.component.destroy.emit()}play(){1===this.player.status?(this.movePlayer(),this.animateComponents(),this.checkCollisionWithRelevantElements()):5===this.player.status&&(this.animateComponents(),(new Date).getTime()-this.sideAnimation>3e3&&this.restartLevel())}movePlayer(){if(this.directionKeys.hasPressedKeys()){const a=(i=this.player.directionVector,s=this.directionKeys.directionVector(),n=.95,{x:i.x+(s.x-i.x)*n,y:i.y+(s.y-i.y)*n});this.player.directionVector=(t=w(a),e=10,{x:t.x*e,y:t.y*e}),this.checkCollisionAndSlide(),this.player.component.animation|=1}else this.player.component.animation=0;var t,e,i,s,n;this.player.component.updateCoordinates(this.player.position),this.player.component.updateDirectionVector({...this.player.directionVector,y:-this.player.directionVector.y})}checkCollisionAndSlide(){const t=[{...this.player.directionVector},{x:this.player.directionVector.x,y:0},{x:0,y:this.player.directionVector.y}],e={...this.player.position};for(const i of t){this.player.position=c(i,e);const t=this.player.component.getCollisionCircle();if(t.x=this.player.position.x,t.y=this.player.position.y,!this.checkCollisionWithMapRecursive(t))return!1}return this.player.position=e,!0}checkCollisionWithMapRecursive(t){for(const e of this.level.tiles){const i=e.getProjection();for(const e of i)if(b(e.points,t))return!0}return!1}checkCollisionWithRelevantElements(){const t=this.player.component.getProjection();for(const e of this.level.cameras){if(e.seeAnyPoint(t))return e.sawPlayer=!0,this.gameOver(),!0;e.sawPlayer=!1}let e=0;for(const i of this.level.finishLevelItem)this.checkCollisionInProjections(t,i.getProjection("center"))&&(i.enable=!0),i.enable&&e++;if(e===this.level.finishLevelItem.length)return this.levelComplete(),!1}checkCollisionInProjections(t,e){for(const i of t)for(const t of e)if(f(i.points,t.points))return!0;return!1}gameOver(){this.player.deaths++,O.getInstance().saveDeaths(this.player.deaths),this.player.status=5,this.player.component.animation=0,this.player.component.brakeShapes(),this.sideAnimation=(new Date).getTime()}canPauseGame(){return!0}animateComponents(){this.player.component.animate(),this.level.cameras.forEach((t=>t.animate()))}pause(){this.player.status=7,this.level.pauseGame()}unpause(){this.player.status=1,this.level.unPauseGame()}levelComplete(){this.level.hasMoreLevels()?(this.level.loadNextLevel(),this.restartLevel()):(O.getInstance().saveBestDeaths(this.player.deaths),O.getInstance().saveDeaths(0),this.showSettings(!0)),this.updateDeathScore()}finishGame(){this.loadFirstLevel()}loadFirstLevel(){this.level.loadFirstLevel(),O.getInstance().saveDeaths(0),this.restartLevel()}restartLevel(){this.player={...this.player,position:this.level.playerInitialPosition,directionVector:{x:0,y:1},expectedRotation:0,velocity:0,deaths:O.getInstance().loadDeaths(),minVelocity:10,acceleration:20,deceleration:-1.5,status:1},this.player.component&&(this.player.component.brakedShape=null,this.player.component.width=this.level.gridSize,this.player.component.calculateScale()),this.score.score=this.level.levelIndex+1,this.updateDeathScore()}updateDeathScore(){this.scoreDeaths.score=this.player.deaths}}class st extends y{constructor(t,e,i,s,n){super(t,e,i,s,n),this.backgroundColor="#fff",this.padding=10,this.keysSize=40,this.keysTextSize=10,this.keysInfoTextSize=15,this.keyboardPosition={x:30,y:.5*this.height},this.enemySize=60,this.enemyPosition={x:e+.5*this.width,y:i+.5*this.height};const a=new Y(this.eventEmitter,this.enemyPosition.x,this.enemyPosition.y,this.enemySize,{viewDistance:2,viewAngle:2,initialRotation:2,maxRotation:.5});this.winPosition={x:e+s-this.padding-110,y:i+.5*n};const o=new U(this.eventEmitter,this.winPosition.x,this.winPosition.y,70);this.closeHelpButton=new I(this.eventEmitter,e+s-this.padding-40,i+this.padding,40,40,"x"),this.closeHelpButton.backgroundColor="#ff000000",this.closeHelpButton.textColor="#000",this.closeHelpButton.textSize=20,this.components=[a,o,this.closeHelpButton]}destroyComponents(){this.components.forEach((t=>t.destroy.emit()))}render(t){this.renderDialogBox(t),this.renderKeyboard(t,this.keyboardPosition.x,this.keyboardPosition.y),this.renderEnemyInfo(t,this.enemyPosition.x,this.enemyPosition.y),this.renderWinGameInfo(t,this.winPosition.x,this.winPosition.y),this.components.forEach((t=>t.animate&&t.animate())),this.components.forEach((e=>e.render(t)))}renderWinGameInfo(t,e,i){this.renderText(t,e-90,i-97,"Reach all the switches to\nwin the level",this.keysInfoTextSize,"#000")}renderEnemyInfo(t,e,i){this.renderText(t,e-105,i-97,"Avoid being seen by the camera\nor you will be killed",this.keysInfoTextSize,"#000")}renderKeyboard(t,e,i){this.renderKeyboardKey(t,e,i+10,"A"),this.renderKeyboardKey(t,e+this.keysSize+this.padding,i+10,"S"),this.renderKeyboardKey(t,e+2*this.keysSize+2*this.padding,i+10,"D"),this.renderKeyboardKey(t,e+this.keysSize+this.padding,i-this.keysSize-this.padding+10,"W"),this.renderKeyboardInfo(t,e-10,i-2*this.keysSize-3*this.padding)}renderKeyboardInfo(t,e,i){const s=this.x+this.padding,n=this.y+this.padding;this.renderText(t,s+e,n+i,"Use the keyboard to move\nthe player around the map\nand avoid the cameras",this.keysInfoTextSize,"#000")}renderKeyboardKey(t,e,i,s){const n=this.x+this.padding,a=this.y+this.padding;t.beginPath(),t.rect(m(n+e),m(a+i),m(this.keysSize),m(this.keysSize)),t.fillStyle="#000",t.fill(),t.beginPath(),t.font=`${m(this.keysTextSize)}px Arial`;const o=t.measureText(s),r=g(o.width),h=g(o.actualBoundingBoxAscent+o.actualBoundingBoxDescent);t.fillStyle="#fff",t.fillText(s,m(n+e+this.keysSize/2-r/2),m(a+i+this.keysSize/2+h/2))}renderDialogBox(t){t.beginPath(),t.rect(0,0,m(i),m(s)),t.fillStyle="rgba(0,0,0,0.82)",t.fill(),t.beginPath(),t.rect(m(this.x),m(this.y),m(this.width),m(this.height)),t.fillStyle=this.backgroundColor,t.fill()}renderText(t,e,i,s,n,a){let o=0;const r=s.split("\n");for(let s of r){t.beginPath(),t.font=`${m(n)}px Arial`;const r=t.measureText(n),h=g(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent);t.fillStyle=a,t.fillText(s,m(e),m(i+o)),o+=h+10}}}V.any();const nt=10;class at extends x{constructor(t,e){super(t,e),this.createSettingsButton(),this.createHelpButton(),this.listenerEvent(o,this.keyDown.bind(this)),this.listenerEvent(r,this.keyUp.bind(this)),this.initGame()}createSettingsButton(){this.buttonPause=new I(this.eventEmitter,nt,nt,100,30,"SETTINGS"),this.buttonPause.backgroundColor="#00000000",this.buttonPause.textSize=20,this.buttonPause.listenerEvent(n,(()=>{this.currentGame.canPauseGame()&&(this.currentGame.pause(),this.showSettings(!1))}))}createHelpButton(){this.buttonHelp=new I(this.eventEmitter,nt+this.buttonPause.width,nt,100,30,"HELP"),this.buttonHelp.backgroundColor="#00000000",this.buttonHelp.textSize=20,this.buttonHelp.listenerEvent(n,(()=>{this.showHelp()}))}initGame(){this.isModalShow=!1,this.currentGame&&this.currentGame.destroy(),this.level=new et(this.eventEmitter,0,0,i,s,"#000");const t=new M(this.eventEmitter,1014,nt,"LEVEL");t.backgroundColor="#00000000";const e=new M(this.eventEmitter,552,nt,"DEATHS");e.backgroundColor="#00000000",this.player=new C(this.eventEmitter,this.level.playerInitialPosition.x,this.level.playerInitialPosition.y,this.level.gridSize),this.currentGame=new it(this.level,t,e),this.currentGame.player.component=this.player,this.currentGame.showSettings=this.showSettings.bind(this),this.elements=[this.player,this.buttonPause,this.buttonHelp,t,e],this.playableElements=[this.player],O.getInstance().isFirstTime()&&this.showHelp()}render(t){this.currentGame.play(),this.cleanCanvas(t),this.renderOrRemovePlayableElements(t);for(const e of this.elements)e.render(t)}keyDown(t){this.currentGame.directionKeys.addKey(t.key)}keyUp(t){this.currentGame.directionKeys.removeKey(t.key)}showSettings(t=!0){if(!this.isModalShow){this.isModalShow=!0;const e=300,i=300,s=new G(this.eventEmitter,512-e/2,384-i/2,e,i);t&&s.hidePlayButton(),s.buttonPlay.listenerEvent("2",(()=>{this.hideModal(s),t&&this.currentGame.finishGame()})),s.buttonRestart.listenerEvent(n,(()=>{this.hideModal(s),this.currentGame.loadFirstLevel()})),this.elements.push(s)}}showHelp(){if(!this.isModalShow){this.isModalShow=!0;const t=819.2,e=384,i=new st(this.eventEmitter,512-t/2,384-e/2,t,e);i.closeHelpButton.listenerEvent("2",(()=>{this.hideModal(i)})),this.elements.push(i)}}hideModal(t){t.destroyComponents(),t.destroy.emit(),this.currentGame.unpause(),this.elements.pop(),this.isModalShow=!1}renderOrRemovePlayableElements(t){const e=new Set;for(const i of this.playableElements)this.isElementVisible(i)?i.render(t):e.add(i.id);this.playableElements=this.playableElements.filter((t=>!e.has(t.id)))}isElementVisible(t){return t.y-2*t.height<s}cleanCanvas(t){this.level.render(t)}}class ot{constructor(t,e){this.gameWidth=i,this.gameHeght=768,this.sceneClasses=new Map,this.sceneClasses.set(1,at),this.scenesInstances=new Map,this.currentScene=null,e.on((t=>{this.currentScene.eventEmitter.emit(t),"8"===t.event&&t.dimension&&(this.gameWidth=t.dimension.w,this.gameHeght=t.dimension.h,this.updateGameDimensions())})),this.navigate(t)}navigate(t){this.scenesInstances.has(t)?this.currentScene=this.scenesInstances.get(t):this.sceneClasses.has(t)&&(this.scenesInstances.set(t,new(this.sceneClasses.get(t))(this,new h)),this.currentScene=this.scenesInstances.get(t)),this.updateGameDimensions()}updateGameDimensions(){this.currentScene&&(this.currentScene.width=this.gameWidth,this.currentScene.height=this.gameHeght)}}const rt=1e3/30;let ht=null;class yt{constructor(){window.addEventListener("resize",this.resizeScreen.bind(this)),this.canvas=document.getElementById("game"),this.registerEvents(),this.eventEmitter=new h,this.context=this.canvas.getContext("2d"),this.navigatorRoot=new ot(1,this.eventEmitter),this.loopStatus=3,this.lastTime=0,this.width=this.canvas.width,this.height=this.canvas.height,this.resizeScreen()}registerEvents(){this.registerKeyboardEvent("keydown",o),this.registerKeyboardEvent("keyup",r),this.registerKeyboardEvent("keypress","9"),this.registerClickEvent("click",n),this.registerClickEvent("mousedown","1"),this.registerClickEvent("mouseup","2"),this.registerClickEvent("mouseout",a),this.registerClickEvent("mouseleave","9"),this.registerClickEvent("mousemove","3"),this.registerTouchEvent("touchstart","4",!1),this.registerTouchEvent("touchend","5",!1),this.registerTouchEvent("touchcancel","7",!1),this.registerTouchEvent("touchmove","6",!1)}registerClickEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.clickEvent(t,e)),i)}registerTouchEvent(t,e,i=void 0){this.canvas.addEventListener(t,(t=>this.touchEvent(t,e)),i)}registerKeyboardEvent(t,e,i=void 0){document.addEventListener(t,(t=>this.keyboardEvent(t,e)),i)}resizeScreen(){const t=window.innerWidth,s=window.innerHeight;let n=Math.min(i,t),a=n*e;a>s&&(a=s,n=s/e),this.canvas.width=n,this.canvas.height=a,window.currentWidth=n,this.eventEmitter.emit({event:"8",dimension:{w:n,h:a}})}touchEvent(t,e){this.emitPositionEvent({x:t?.targetTouches[0]?.pageX,y:t?.targetTouches[0]?.pageY},e)}clickEvent(t,e){this.emitPositionEvent({x:t?.clientX,y:t?.clientY},e)}keyboardEvent(t,e){this.eventEmitter.emit({event:e,key:t.key})}emitPositionEvent(t,e){const i=this.canvas.getBoundingClientRect();this.eventEmitter.emit({event:e,position:{x:g(t.x-i.left),y:g(t.y-i.top)}})}static getInstance(){return ht||(ht=new yt),ht}init(){this.loopStatus=1,requestAnimationFrame(this.loop.bind(this))}loop(t){1===this.loopStatus&&(1===this.loopStatus&&rt<=t-this.lastTime&&(this.lastTime=t,this.navigatorRoot.currentScene.render(this.context)),requestAnimationFrame(this.loop.bind(this)))}}yt.getInstance().init()})()})();
//# sourceMappingURL=main.js.map